!function(e){function t(t){for(var i,o,l=t[0],s=t[1],c=t[2],d=0,m=[];d<l.length;d++)o=l[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);for(u&&u(t);m.length;)m.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,l=1;l<n.length;l++){var s=n[l];0!==a[s]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={mapIndex:0},r=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="https://static.allhistory.com/online/";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;r.push(["6a51","base","common","mapBase"]),n()}({"0030":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <li class="per-marker-content" data-did="'+e.escapeExpression(e.lambda(null!=(l=null!=t?c(t,"properties"):t)?c(l,"id"):l,t))+'">\n          <div class="cluster-title">\n            '+(null!=(l=a(n("fcbf")).call(s,null!=(l=null!=t?c(t,"properties"):t)?c(l,"title"):l,"title",{name:"xss",hash:{},data:o,loc:{start:{line:14,column:12},end:{line:14,column:46}}}))?l:"")+'\n          </div>\n          <div class="cluster-marker-second-title">\n            '+(null!=(l=a(n("fcbf")).call(s,null!=(l=null!=t?c(t,"properties"):t)?c(l,"timeLocation"):l,"title",{name:"xss",hash:{},data:o,loc:{start:{line:17,column:12},end:{line:17,column:53}}}))?l:"")+"\n          </div>\n        </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="detail-list-cluster-markers" data-mid="'+c(s(null!=(l=null!=t?d(t,"data"):t)?d(l,"id"):l,t))+'-cluster">\n  <div class="marker-content cp">\n    <div class="normal-marker-icon active">\n\n    </div>\n    <div class="active-marker-icon node-icon '+c(s(null!=t?d(t,"iconUrl"):t,t))+'">\n\n    </div>\n    <div class="active-cluster-marker-right">\n      <ul class="marker-list">\n'+(null!=(l=d(i,"each").call(u,null!=t?d(t,"children"):t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:11,column:8},end:{line:20,column:17}}}))?l:"")+'      </ul>\n    </div>\n\n    <div class="bottom-text bottomText" title="'+c(a(n("691b")).call(u,null!=(l=null!=t?d(t,"data"):t)?d(l,"title"):l,{name:"clean",hash:{},data:o,loc:{start:{line:24,column:47},end:{line:24,column:67}}}))+'">\n      '+(null!=(l=a(n("fcbf")).call(u,null!=(l=null!=t?d(t,"data"):t)?d(l,"title"):l,"clean",{name:"xss",hash:{},data:o,loc:{start:{line:25,column:6},end:{line:25,column:34}}}))?l:"")+"\n    </div>\n  </div>\n</div>"},useData:!0})},"00b8":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=l(n("96ef"));function l(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{active:!0},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)({itemName:this.data.itemName,id:this.data.id,active:this.data.active,isCluster:!!this.data.isCluster,iconClassName:this.data.iconClassName,type:"nodeDetail"})),this._bind()}},{key:"_bind",value:function(){}},{key:"getElement",value:function(){return this.$html[0]}},{key:"fadeInMarkerItem",value:function(){this.$html.find(".marker-item").addClass("fade-in")}}]),e}();t.default=s,e.exports=t.default},"013d":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div class="avatar cp" onclick="window.open(\'/relation?id='+o(r(null!=t?l(t,"entryID"):t,t))+"')\" style=\"background-image:url('"+o(r(null!=t?l(t,"entryAvatar"):t,t))+"')\"></div>\n"},3:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div class="avatar avatar-word" onclick="window.open(\'/relation?id='+o(r(null!=t?l(t,"entryID"):t,t))+"')\">"+o(r(null!=t?l(t,"firstLetter"):t,t))+"</div>\n"},5:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <li data-index="'+o(r(a&&l(a,"index"),t))+'" data-name="'+o(r(null!=t?l(t,"cateName"):t,t))+'" data-color="'+o(r(null!=t?l(t,"color"):t,t))+'" style="background-color:'+o(r(null!=t?l(t,"color"):t,t))+'">\n          '+o(r(null!=t?l(t,"cateName"):t,t))+'\n          <div class="circle" style="border-color:'+o(r(null!=t?l(t,"color"):t,t))+'"></div>\n        </li>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="map-entry-comp-pop-box pop-box-mask">\n  <div class="pop-content page-comp-relation-graph">\n    <div class="icon-close-big pop-close"></div>\n    <div class="box-title"><a target="_Blank" href="/relation?id='+c(s(null!=t?d(t,"entryID"):t,t))+'">'+c(a(n("dfab")).call(u,"relationGraph",{name:"lang",hash:{},data:o,loc:{start:{line:4,column:78},end:{line:4,column:102}}}))+'</a></div>\n\n    <div class="read-more cp" onclick="window.open(\'/relation?id='+c(s(null!=t?d(t,"entryID"):t,t))+"')\">"+c(a(n("dfab")).call(u,"readdetail",{name:"lang",hash:{},data:o,loc:{start:{line:23,column:80},end:{line:23,column:101}}}))+'\n      <div class="icon icon-arrow-right"></div>\n    </div>\n    <div class="cycle-selector">\n      <div class="cycle-selector-center">\n'+(null!=(l=d(i,"if").call(u,null!=t?d(t,"entryAvatar"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(3,o,0),data:o,loc:{start:{line:29,column:8},end:{line:33,column:15}}}))?l:"")+'      </div>\n      <div class="cycle-selected-area"></div>\n\n      <ul class="cate-items">\n'+(null!=(l=d(i,"each").call(u,null!=t?d(t,"relationList"):t,{name:"each",hash:{},fn:e.program(5,o,0),inverse:e.noop,data:o,loc:{start:{line:40,column:8},end:{line:45,column:17}}}))?l:"")+'      </ul>\n    </div>\n    <div class="icon icon-middle-arrow"></div>\n    <div class="relation-list">\n\n    </div>\n  </div>\n</div>'},useData:!0})},"0172":function(e,t,n){},"0280":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkerIconNameByTitle=t.activeMarkerClickState=t.getIconClassName=void 0;var i,a=n("9b57"),r=(i=a)&&i.__esModule?i:{default:i},o=n("d99f"),l=n("a7c7");var s=[{key:"birth",list:"出生",types:["出生","出生于","幼年","降生"]},{key:"arrested",list:"被捕",types:["禁锢于","被捕","俘虏","被捕于"]},{key:"create",list:"创造",types:["重大突破","证明","发表","研究","发现","出版","设计","制作","改进","发明重大突破","证明","发表","研究","发现","出版","设计","制作","改进","创造","发展","写作","发明","著作","创立","创作","作品","提出","论证","解释","开创","贡献","建立","记录","参与创作","修撰","仿作","临摹","撰写","创建","著有","制造","整理翻译","最后的晚餐","绘画"]},{key:"resign",list:"辞职",types:["辞职","辞去"]},{key:"assassinate",list:"刺杀",types:["杀害","杀死","刺杀","被杀","射杀","被刺杀","诛杀"]},{key:"defeat",list:"挫败",types:["败于","挫败","崩溃","失败","惨败"]},{key:"settled",list:"定居",types:["生活于","移居","定居","逗留","住在","迁住","搬到","居住"]},{key:"discover",list:"发现",types:["重大突破","证明","发表","研究","发现","出版","设计","制作","改进","发明重大突破","证明","发表","研究","发现","出版","设计","制作","改进","创造","发展","写作","发明","著作","创立","创作","作品","提出","论证","解释","开创","贡献","建立","记录","参与创作","修撰","仿作","临摹","撰写","创建","著有","制造","整理翻译"]},{key:"oppose",list:"反对",types:["争论","批评","攻击","反对","争执","怀疑和否定","竞争"]},{key:"job",list:"工作",types:["工作","担任","就职","任命","任职","协助","出任","聘请","聘用","任职于","工作于","同事","任教于","部门","打工"]},{key:"cooperation",list:"合作",types:["合作","指导","监制"]},{key:"sicken",list:"患病",types:["患病","生病","暴病","医治"]},{key:"gain",list:"获得",types:["获得","共同获奖","共同获得","获奖"]},{key:"join",list:"加入",types:["加入","选入","入选","当选","参与","成员","会员","涉嫌参与","参加","入参"]},{key:"professor",list:"教授",types:["教授","执教","任教","当选院士","讲学","教导"]},{key:"marry",list:"结婚",types:["结婚","再婚","结亲","迎娶","爱上"]},{key:"consort",list:"结交",types:["会见","结识","交流","拜访","访问","遇到","结交","至交","相遇","朋友","邀请","来访","相恋","首晤","应召","奉召"]},{key:"attend",list:"就读",types:["就读","就学","学习","师承","师从","师法","拜师","入学","研读","学习于","学徒","同门","毕业","就读于","毕业于","研究","读书","学堂"]},{key:"divorce",list:"离婚",types:["离婚"]},{key:"witness",list:"目击",types:["目击"]},{key:"plagiarize",list:"剽窃",types:["剽窃"]},{key:"evaluate",list:"评价",types:["评价"]},{key:"signed",list:"签订",types:["签订","签订协议","签署"]},{key:"judge",list:"审判",types:["审判"]},{key:"beneficiary",list:"受封",types:["受封","受封于","封爵","获任","中","升任","进献"]},{key:"death",list:"死亡",types:["死亡","逝世","葬于","病逝","逝世于","死亡于","死于","病逝于","去世","坟墓","归葬"]},{key:"escapes",list:"逃亡",types:["逃亡","出走","押解","流放","逃往"]},{key:"communication",list:"通信",types:["讨论","通信","上书"]},{key:"govern",list:"统治",types:["加冕为","成为","继承","统治","当选","即位","首相","加封","太子"]},{key:"prison-break",list:"脱狱",types:["脱狱","越狱"]},{key:"writing",list:"写作",types:["写作","从文"]},{key:"declare-war",list:"宣战",types:["平定","终结","打败","统一","攻打","入侵","宣战","对战"]},{key:"examination",list:"应试",types:["应试"]},{key:"travel",list:"游历",types:["周游","游历","前往","返回","重返","逃回","旅行","回到","受邀返回","到达","旅访","迁往","移民","留学","接回","调遣","回乡","回"]},{key:"battle",list:"战役",types:["战役","之战","进攻","战争","一战","二战","世界大战","对战","受难"]},{key:"support",list:"支持",types:["支持","跟随","赞赏","影响"]},{key:"famous-works",list:"知名作品",types:["代表","得名","知名作品","知名于"]},{key:"command",list:"指挥",types:["领导","指挥"]},{key:"subsidize",list:"资助",types:["援助","资助","赞助","招揽"]},{key:"events",list:"事件",types:["事件"]},{key:"museum",list:"博物馆",types:["博物馆"]},{key:"hospital",list:"医院",types:["医院","医学院","医学","住院"]},{key:"study-medicine",list:"学医",types:["学医","治疗","治病","医","医生"]},{key:"soldier",list:"军人",types:["军人","参军"]},{key:"weather",list:"天气",types:["天气","过冬"]},{key:"politics",list:"政治",types:["政治","会议","内阁"]},{key:"catholicism",list:"天主教",types:["天主教","受洗","洗礼","道成肉身","显现"]},{key:"preside",list:"主持",types:["主持"]},{key:"preach",list:"传道",types:["传道"]},{key:"resurgence",list:"复活",types:["复活"]}];t.getIconClassName=function(e,t){var n=t;if(!Array.isArray(e))return n;var i=(0,o.getFilterTags)(),a=[];return i.forEach((function(e){a=[].concat((0,r.default)(a),(0,r.default)(e.data))})),e.forEach((function(e){e=""+e;var t=a.find((function(t){return t.id===e}));t&&(n=t.iconClassName)})),n},t.activeMarkerClickState=function(){l.MAB_STATE.update("markerClickState",!0),setTimeout((function(){l.MAB_STATE.update("markerClickState",!1)}),320)},t.getMarkerIconNameByTitle=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default-icon";if(!e)return t;var n=s.find((function(t){return!!t.types.find((function(t){return-1!=e.indexOf(t)}))}));return n?n.key:t}},"0308":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,i,r,o){var l=null!=t?t:e.nullContext||{},s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="empty-content">\n      <div class="empty-title">\n        '+s(a(n("dfab")).call(l,"notFindEntry","search",{name:"lang",hash:{},data:o,loc:{start:{line:5,column:8},end:{line:5,column:40}}}))+"“<span>"+s(e.lambda(null!=t?c(t,"safeKeyword"):t,t))+'</span>”\n      </div>\n      <div class="empty-tips">\n        <div class="text">'+s(a(n("dfab")).call(l,"welcomeToCreate","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:8,column:26},end:{line:8,column:62}}}))+'</div>\n        <div class="create-btn createBtn">'+s(a(n("dfab")).call(l,"IWillCreate","search",{name:"lang",hash:{},data:o,loc:{start:{line:9,column:42},end:{line:9,column:73}}}))+"</div>\n      </div>\n    </div>\n"},5:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="result-list-wrap resultListWrap">\n'+(null!=(l=c(i,"if").call(s,null!=t?c(t,"timeMapEntryFirst"):t,{name:"if",hash:{},fn:e.program(6,o,0),inverse:e.program(8,o,0),data:o,loc:{start:{line:14,column:6},end:{line:49,column:13}}}))?l:"")+(null!=(l=a(n("d930")).call(s,null!=t?c(t,"queryType"):t,"!=","2",{name:"ifcond",hash:{},fn:e.program(19,o,0),inverse:e.noop,data:o,loc:{start:{line:50,column:6},end:{line:78,column:17}}}))?l:"")+(null!=(l=c(i,"if").call(s,null!=t?c(t,"timeMapEntryFirst"):t,{name:"if",hash:{},fn:e.program(8,o,0),inverse:e.noop,data:o,loc:{start:{line:79,column:6},end:{line:113,column:13}}}))?l:"")+(null!=(l=a(n("d930")).call(s,null!=t?c(t,"queryType"):t,"===","2",{name:"ifcond",hash:{},fn:e.program(28,o,0),inverse:e.noop,data:o,loc:{start:{line:114,column:6},end:{line:144,column:17}}}))?l:"")+"    </div>\n"},6:function(e,t,n,i,a){return""},8:function(e,t,i,r,o){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=a(n("d930")).call(null!=t?t:e.nullContext||{},null!=t?s(t,"queryType"):t,"===","3",{name:"ifcond",hash:{},fn:e.program(9,o,0),inverse:e.noop,data:o,loc:{start:{line:16,column:8},end:{line:48,column:19}}}))?l:""},9:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=(r=null!=t?o(t,"pureEntry"):t)?o(r,"totalCount"):r,{name:"if",hash:{},fn:e.program(10,a,0),inverse:e.noop,data:a,loc:{start:{line:17,column:10},end:{line:47,column:17}}}))?r:""},10:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'          <section class="pure-entries-list">\n            <header class="title-row">\n              '+c(a(n("dfab")).call(s,"noSpatioResult","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:20,column:14},end:{line:20,column:51}}}))+" "+c(e.lambda(null!=(l=null!=t?u(t,"pureEntry"):t)?u(l,"totalCount"):l,t))+" "+c(a(n("dfab")).call(s,"supplementaAddition","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:20,column:77},end:{line:20,column:119}}}))+'\n              <div class="more-info moreInfo">\n                '+c(a(n("dfab")).call(s,"more",{name:"lang",hash:{},data:o,loc:{start:{line:22,column:16},end:{line:22,column:33}}}))+'\n              </div>\n            </header>\n            <ul class="entries-list">\n'+(null!=(l=u(i,"each").call(s,null!=(l=null!=t?u(t,"pureEntry"):t)?u(l,"list"):l,{name:"each",hash:{},fn:e.program(11,o,0),inverse:e.noop,data:o,loc:{start:{line:26,column:14},end:{line:44,column:23}}}))?l:"")+"            </ul>\n          </section>\n"},11:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <li class="entry-item entryItem" data-id="'+c(s(null!=t?d(t,"id"):t,t))+'" data-type="'+c(s(null!=t?d(t,"type"):t,t))+'">\n                  <div class="base-info">\n                    <div class="title">\n                      <span class="icon '+c(s(null!=t?d(t,"type"):t,t))+'"></span><span class="name">'+c(a(n("fcbf")).call(u,null!=t?d(t,"title"):t,"title","true",{name:"xss",hash:{},data:o,loc:{start:{line:30,column:76},end:{line:30,column:104}}}))+'</span>\n                    </div>\n                    <div class="summary">'+(null!=(l=a(n("691b")).call(u,null!=t?d(t,"summary"):t,{name:"clean",hash:{},fn:e.program(6,o,0),inverse:e.noop,data:o,loc:{start:{line:32,column:41},end:{line:32,column:69}}}))?l:"")+"</div>\n                  </div>\n"+(null!=(l=d(i,"if").call(u,null!=t?d(t,"imageUrl"):t,{name:"if",hash:{},fn:e.program(12,o,0),inverse:e.program(14,o,0),data:o,loc:{start:{line:34,column:18},end:{line:42,column:25}}}))?l:"")+"                </li>\n"},12:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <div class="avatar" style="background-image:url('+e.escapeExpression(e.lambda(null!=t?r(t,"imageUrl"):t,t))+')"></div>\n'},14:function(e,t,i,r,o){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=a(n("d930")).call(null!=t?t:e.nullContext||{},null!=t?s(t,"type"):t,"===","book",{name:"ifcond",hash:{},fn:e.program(15,o,0),inverse:e.program(17,o,0),data:o,loc:{start:{line:37,column:20},end:{line:41,column:31}}}))?l:""},15:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                      <div class="avatar book">'+e.escapeExpression(e.lambda(null!=t?r(t,"firstCharOfName"):t,t))+"</div>\n"},17:function(e,t,n,i,a){return'                      <div class="avatar"></div>\n'},19:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <section class="time-map-entries-list">\n          <header class="title-row">\n            '+e.escapeExpression(a(n("dfab")).call(s,"relatedResult","timemap",null!=t?c(t,"safeKeyword"):t,null!=(l=null!=t?c(t,"timeMapEntry"):t)?c(l,"totalCount"):l,{name:"lang",hash:{},data:o,loc:{start:{line:54,column:12},end:{line:54,column:82}}}))+'\n          </header>\n          <ul class="entries-list">\n'+(null!=(l=c(i,"each").call(s,null!=(l=null!=t?c(t,"timeMapEntry"):t)?c(l,"list"):l,{name:"each",hash:{},fn:e.program(20,o,0),inverse:e.noop,data:o,loc:{start:{line:57,column:12},end:{line:75,column:21}}}))?l:"")+"          </ul>\n        </section>\n"},20:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'              <li class="entry-item entryItem" data-id="'+c(s(null!=t?d(t,"id"):t,t))+'" data-type="'+c(s(null!=t?d(t,"type"):t,t))+'">\n                <div class="base-info">\n                  <div class="title">\n                    <span class="icon '+c(s(null!=t?d(t,"type"):t,t))+'"></span><span class="name">'+c(a(n("fcbf")).call(u,null!=t?d(t,"title"):t,"title","true",{name:"xss",hash:{},data:o,loc:{start:{line:61,column:74},end:{line:61,column:102}}}))+'</span>\n                  </div>\n                  <div class="summary">'+(null!=(l=a(n("691b")).call(u,null!=t?d(t,"summary"):t,{name:"clean",hash:{},fn:e.program(6,o,0),inverse:e.noop,data:o,loc:{start:{line:63,column:39},end:{line:63,column:67}}}))?l:"")+"</div>\n                </div>\n"+(null!=(l=d(i,"if").call(u,null!=t?d(t,"imageUrl"):t,{name:"if",hash:{},fn:e.program(21,o,0),inverse:e.program(23,o,0),data:o,loc:{start:{line:65,column:16},end:{line:73,column:23}}}))?l:"")+"              </li>\n"},21:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                  <div class="avatar" style="background-image:url('+e.escapeExpression(e.lambda(null!=t?r(t,"imageUrl"):t,t))+')"></div>\n'},23:function(e,t,i,r,o){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=a(n("d930")).call(null!=t?t:e.nullContext||{},null!=t?s(t,"type"):t,"===","book",{name:"ifcond",hash:{},fn:e.program(24,o,0),inverse:e.program(26,o,0),data:o,loc:{start:{line:68,column:18},end:{line:72,column:29}}}))?l:""},24:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <div class="avatar book">'+e.escapeExpression(e.lambda(null!=t?r(t,"firstCharOfName"):t,t))+"</div>\n"},26:function(e,t,n,i,a){return'                    <div class="avatar"></div>\n'},28:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <section class="back-link-text backLink">\n          '+c(a(n("dfab")).call(s,"backAllResultList","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:116,column:10},end:{line:116,column:50}}}))+'\n        </section>\n        <section class="pure-entries-list">\n          <header class="title-row">\n            '+c(a(n("dfab")).call(s,"noSpatioResult","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:120,column:12},end:{line:120,column:49}}}))+" "+c(e.lambda(null!=(l=null!=t?u(t,"pureEntry"):t)?u(l,"totalCount"):l,t))+" "+c(a(n("dfab")).call(s,"supplementaAddition","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:120,column:75},end:{line:120,column:117}}}))+'\n          </header>\n          <ul class="entries-list">\n'+(null!=(l=u(i,"each").call(s,null!=(l=null!=t?u(t,"pureEntry"):t)?u(l,"list"):l,{name:"each",hash:{},fn:e.program(20,o,0),inverse:e.noop,data:o,loc:{start:{line:123,column:12},end:{line:141,column:21}}}))?l:"")+"          </ul>\n        </section>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="result-list-component '+(null!=(r=l(n,"if").call(o,null!=t?l(t,"active"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:34},end:{line:1,column:61}}}))?r:"")+'">\n'+(null!=(r=l(n,"if").call(o,null!=t?l(t,"showEmptyOptions"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.program(5,a,0),data:a,loc:{start:{line:2,column:2},end:{line:146,column:9}}}))?r:"")+'\n  <section class="nodes-options nodesOptions">\n  </section>\n</div>'},useData:!0})},"0319":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="home-page homePage">\n  <div class="components-container">\n    <div class="controller-btn controllerBtn display-none"></div>\n    <div class="search-container searchContainer"></div>\n    <div class="filter-container filterContainer"></div>\n    <div class="right-info-container">\n      <div class="territory-info-container territoryInfoContainer"></div>\n    </div>\n  </div>\n  <div class="plugins-container pluginsContainer"></div>\n</div>'},useData:!0})},"03be":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("7675"),r=(i=a)&&i.__esModule?i:{default:i};t.default={calcUnitBySelectedOffset:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=0,o=e.startOffsetPx,l=e.endOffsetPx,s=l+o;i&&(s=i);var c=n-t,u=s/e.startUnitWidth,d=u*e.startUnitTime,m=(0,r.default)(c/d);return{selectedWidth:s,startUnitNumber:u,n:m,newUnitTime:a=e.startUnitTime*Math.pow(2,Math.ceil(m)),newUnitWidth:e.startUnitWidth*(u*a/c),selectedDuration:c}}},e.exports=t.default},"05d2":function(e,t,n){},"098c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPeriodTimeArea=t.getPeriods=t.initPeriods=void 0;var i=n("a7c7");t.initPeriods=function(){var e=[{id:"1",name:_L_("Chalcolithic","timemap"),descTime:"3760BC - 2500BC",desc:_L_("CopperAgeDesc","timemap"),start:"-3760-00-00",end:"-2501-12-31",startYear:-3760,endYear:-2500},{id:"2",name:_L_("BronzeAge","timemap"),descTime:"2500BC - 1200BC",desc:_L_("BronzeAgeDesc","timemap"),start:"-2500-00-00",end:"-1201-12-31",startYear:-2500,endYear:-1200},{id:"3",name:_L_("IronAge","timemap"),descTime:"1200BC - 1468",desc:_L_("IronAgeDesc","timemap"),start:"-1200-00-00",end:"1468-12-31",startYear:-1200,endYear:1468},{id:"4",name:_L_("AgeOfDiscovery","timemap"),descTime:"1469 - 1764",desc:_L_("AgeOfDiscoveryDesc","timemap"),start:"1469-00-00",end:"1763-12-31",startYear:1469,endYear:1764},{id:"5",name:_L_("AgeOfSteam","timemap"),descTime:"1764 - 1869",desc:_L_("AgeOfSteamDesc","timemap"),start:"1764-00-00",end:"1869-12-31",startYear:1764,endYear:1869},{id:"6",name:_L_("AgeOfElectricity","timemap"),descTime:"1870 - 1941",desc:_L_("AgeOfElectricityDesc","timemap"),start:"1870-00-00",end:"1944-12-31",startYear:1870,endYear:1941},{id:"7",name:_L_("ContemporaryHistory","timemap"),descTime:"1945 - "+(new Date).getFullYear(),desc:_L_("ContemporaryHistoryDesc","timemap"),start:"1945-00-00",end:"2019-12-31",startYear:1945,endYear:(new Date).getFullYear()}];i.MAB_STATE.update("periodsData",e)},t.getPeriods=function(){return i.MAB_STATE.get("periodsData")},t.getPeriodTimeArea=function(e){var t=e.periodId,n=e.def,a=void 0===n?{start:0,end:0}:n;if(!t)return a;var r=i.MAB_STATE.get("periodsData").find((function(e){return e.id===t}));return r?{start:r.startYear,end:r.endYear}:a}},"0dbf":function(e,t,n){},1488:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba"));n("bd43");var o=l(n("7544"));function l(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:null,id:"",status:!1,title:"测试文字",onChange:function(){}},t),this.init(),this.bind()}return(0,r.default)(e,[{key:"init",value:function(){this.$html=$((0,o.default)({status:this.status,title:this.title})),this.$container.append(this.$html)}},{key:"bind",value:function(){var e=this;this.$html.on("click",(function(t){e.$html.toggleClass("active"),e.status=e.$html.hasClass("active"),e.onChange(e.status)}))}},{key:"destroy",value:function(){this.$html.destroy()}}]),e}();t.default=s,e.exports=t.default},1505:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n("aec1");var i=l(n("5ec4")),a=l(n("8faf")),r=l(n("452a")),o=l(n("364a"));function l(e){return e&&e.__esModule?e:{default:e}}t.default={showArticle:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];new a.default({entry:e,setEntryCompCardsState:t})},showSummary:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];new r.default({entry:e,setEntryCompCardsState:t})},showRelation:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];new i.default({entry:e,setEntryCompCardsState:t})},showProductMedia:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];new o.default({entry:e,setEntryCompCardsState:t})}},e.exports=t.default},1635:function(e,t,n){},"16bf":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="multi-marker-child multiMarkerChild multi-single-marker display-none" data-mid="'+s("function"==typeof(r=null!=(r=c(n,"id")||(null!=t?c(t,"id"):t))?r:l)?r.call(o,{name:"id",hash:{},data:a,loc:{start:{line:1,column:92},end:{line:1,column:98}}}):r)+'">\n  <div class="marker-icon subMultiMarkerIcon '+s("function"==typeof(r=null!=(r=c(n,"iconClassName")||(null!=t?c(t,"iconClassName"):t))?r:l)?r.call(o,{name:"iconClassName",hash:{},data:a,loc:{start:{line:2,column:45},end:{line:2,column:62}}}):r)+'">\n  </div>\n  <div class="marker-title subMultiMarkerTitle" title="'+s("function"==typeof(r=null!=(r=c(n,"itemName")||(null!=t?c(t,"itemName"):t))?r:l)?r.call(o,{name:"itemName",hash:{},data:a,loc:{start:{line:4,column:55},end:{line:4,column:67}}}):r)+'">\n    '+s("function"==typeof(r=null!=(r=c(n,"itemName")||(null!=t?c(t,"itemName"):t))?r:l)?r.call(o,{name:"itemName",hash:{},data:a,loc:{start:{line:5,column:4},end:{line:5,column:16}}}):r)+"\n  </div>\n</div>"},useData:!0})},1737:function(e,t,n){},1840:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("3f6b")),a=d(n("8827")),r=d(n("57ba")),o=d(n("983e"));n("1bb8");var l=d(n("c7be")),s=d(n("fd4f")),c=d(n("bdd3")),u=d(n("52b4"));function d(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:$("body"),active:!0,controller:!0,showDivision:!0,scalable:!0,draggable:!0,type:"area",minYear:-3760,maxYear:(new Date).getFullYear(),divisions:[{start:-3760,end:-2500,name:_L_("Chalcolithic","timemap"),className:"division-bg-1"},{start:-2500,end:-1200,name:_L_("BronzeAge","timemap"),className:"division-bg-2"},{start:-1200,end:1468,name:_L_("IronAge","timemap"),className:"division-bg-3"},{start:1468,end:1469,name:"",className:"division-bg-none"},{start:1469,end:1764,name:_L_("AgeOfDiscovery","timemap"),className:"division-bg-4"},{start:1764,end:1869,name:_L_("AgeOfSteam","timemap"),className:"division-bg-5"},{start:1869,end:1870,name:"",className:"division-bg-none"},{start:1870,end:1941,name:_L_("AgeOfElectricity","timemap"),className:"division-bg-6"},{start:1941,end:1945,name:"",className:"division-bg-none"},{start:1945,end:(new Date).getFullYear(),name:_L_("ContemporaryHistory","timemap"),className:"division-bg-7"}],startOffset:100,endOffset:100,markers:[],onChange:function(){},onDivisionClick:function(){},onMarkerClick:function(){}},t),this.$divisions=[],this.createContainer(),this.createBar(),this.createDivisions(),this.updatePosition(),this._createController(),this._createMarkerController(),this._bind(),this.update()}return(0,r.default)(e,[{key:"createBar",value:function(){var e=this;this.ruler=new l.default({container:this.$html[0],minYear:this.minYear,maxYear:this.maxYear,startOffsetPx:this.startOffset,endOffsetPx:this.endOffset,scalable:this.scalable,draggable:this.draggable,onRender:function(t){e.updatePosition()}})}},{key:"createContainer",value:function(){this.$html=$((0,o.default)()),this.$container.append(this.$html)}},{key:"createDivisions",value:function(){var e=this;this.divisions.forEach((function(t){var n=$('\n      <div id="division-'+t.id+'"\n        data-start="'+t.start+'"\n        data-end="'+t.end+'"\n        data-name="'+t.name+'"\n        class="division-item '+t.className+'">\n        <div class="text">'+t.name+"</div>\n        </div>");e.$divisions.push(n),e.$html.find(".division-bar").append(n)}))}},{key:"_createController",value:function(){this.controller=new s.default({timebar:this,startOffset:this.startOffset,endOffset:this.endOffset}),this.pointController=new c.default({timebar:this})}},{key:"_createMarkerController",value:function(){this.markerController=new u.default({timebar:this})}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch((0,i.default)(this,e),this.$html.find(".division-bar").toggleClass("active",this.showDivision),this.pointController.hide(),this.controller.hide(),this.type){case"point":this.pointController.show();break;case"area":this.controller.show()}this.markerController.update(this.markers),this.markerController.onClick=this.markerOnClick,this.ruler.scalable=this.scalable,this.ruler.draggable=this.draggable}},{key:"updatePosition",value:function(){var e=this,t=null;this.$divisions.forEach((function(n){t||(t=e.ruler.getScreenXbyTime(i));var i=n.data("start"),a=n.data("end"),r=e.ruler.getScreenXbyTime(i),o=e.ruler.getScreenXbyTime(a);Math.abs(a-i)<2&&(r=t-2),n.css({left:r,width:o-r}),t=o,e._updateTextPosition(),e.onChange()}))}},{key:"_updateTextPosition",value:function(){var e=this;this.$divisions.forEach((function(t){var n,i=t.find(".text"),a=parseInt(t.find(".text").width()),r=parseInt(t.width()),o=parseInt(t.css("left")),l=o+r,s=e.$html.width()-0;if(!(o>s||l<0)){var c,u;c=Math.max(o,0);var d=a<(n=Math.min(l,s)-c);u=-o+c+n/2-a/2,i.css({left:u,opacity:d?1:0})}}))}},{key:"_onDivisionClick",value:function(e){var t=e.currentTarget.dataset,n=t.start,i=t.end;this.ruler.setTimeByOffset(parseInt(n),parseInt(i),.5),this.onDivisionClick(e)}},{key:"_bind",value:function(){this.$html.on("click",".division-item",this._onDivisionClick.bind(this))}},{key:"setDivision",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.division=e,this.$divisions=[],this.$html.empty(),this.createDivisions(),this.updatePosition()}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}}]),e}();t.default=m,e.exports=t.default},"1ad2":function(e,t,n){},"1b6c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n("3f6b")),a=m(n("8827")),r=m(n("57ba")),o=m(n("5537a"));n("5a47");var l=m(n("19c0")),s=n("97a7"),c=(m(n("1e9f")),m(n("a87f"))),u=m(n("93c3")),d=n("98cf");function m(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,show:!0,userInfo:null,redirectUrl:"",loginUrl:"/user/login",menu:[{name:_L_("myContent"),url:"/user/usercenter#/mycontent"},{name:_L_("myFavor"),url:"/user/usercenter#/favor"},{name:_L_("userInfo"),url:"/user/usercenter#/setting/myself-message"},{name:_L_("myDrafts"),url:"/user/usercenter#/mycontent/mydrafts"},{name:_L_("accountSecurity"),url:"https://www.wanmeiaccount.com"},{name:_L_("logout"),url:!1,event:"logout"}],onLogout:function(){window.location.href="/user/login"},onDestroyed:function(){}},t),new c.default,this._init()}return(0,r.default)(e,[{key:"_init",value:function(){this.userInfo||(this.userInfo=window.userInfo),this.userInfo&&(this.userInfo.image&&"//pic.evatlas.com/img"!==this.userInfo.avatar||(this.userInfo.image=u.default),this.userInfo.image=(0,s.setUrlParam)(this.userInfo.image,"w",80)),this._render()}},{key:"_render",value:function(){this.$container&&(this.$html=$((0,o.default)({show:this.show,items:this.menu,user:this.userInfo,loginUrl:this.loginUrl})),this.emptyBeforeAppend&&this.$container.empty(),this.$container.append(this.$html),this._bind())}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".userMenuItem",(function(t){var n=$(t.currentTarget).data("index"),i=e.menu[n];i.url&&window.open(i.url,"_blank"),i.event&&e._fireEvent(i.event)})),this.$html.on("click",".login-link",(function(e){e.preventDefault(),(0,d.toWanMeiAccount)()})),this.$html.on("click",".userAvatar",(function(){e.$html.find(".userMenu").toggle()})),$(document).on("click",(function(t){$(document).find(".userAvatar:hover").length<=0&&e.$html.find(".userMenu").hide()}))}},{key:"_fireEvent",value:function(e){var t=this;switch(e){case"logout":l.default.logout().then((function(e){t.onLogout()}))}}},{key:"update",value:function(e){(0,i.default)(this,e),this.emptyBeforeAppend=!0,this._render()}},{key:"destroy",value:function(){this.$container&&(this.$container.empty(),this.onDestroyed())}}]),e}();t.default=h,e.exports=t.default},"1bb8":function(e,t,n){},"1f10":function(e,t,n){},"20e3":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,r){var o,l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="desc-viewer-component '+(null!=(o=c(i,"if").call(s,null!=t?c(t,"active"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:34},end:{line:1,column:61}}}))?o:"")+'">\n  <div class="desc-content">\n    '+(null!=(o=(l=n("fcbf"),l&&(l.__esModule?l.default:l)).call(s,null!=t?c(t,"desc"):t,"content","true",{name:"xss",hash:{},data:r,loc:{start:{line:3,column:4},end:{line:3,column:35}}}))?o:"")+"\n  </div>\n</div>\n\n"},useData:!0})},"24d8":function(e,t,n){"use strict";e.exports={subDateForYear:function(e){if(""===e)return"";if(-1===e.toString().indexOf("-"))return e;var t=e.split("-");return""===t[0]?"公元前"+parseInt(t[1]):parseInt(t[0])},GUID:function(){var e=function(){return Math.floor(65536*Math.random()).toString(16)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}},2627:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l=null!=t?t:e.nullContext||{},s=e.escapeExpression;return'<div class="dls-timebar-controller">\n  <button class="prev"></button>\n  <div class="time-select-form">\n    <p class="time-select-title">事件时间</p>\n    <div class="time-selector left-selector">\n      <input type="text" placeholder="'+s(a(n("dfab")).call(l,"PleaseEnterTheYear","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:9,column:38},end:{line:9,column:77}}}))+'" data-name="start">\n      <span class="adbc">AD</span>\n    </div>\n    <div class="time-selector right-selector">\n      <input type="text" placeholder="'+s(a(n("dfab")).call(l,"PleaseEnterTheYear","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:13,column:38},end:{line:13,column:77}}}))+'" data-name="end">\n      <span class="adbc">AD</span>\n    </div>\n  </div>\n  <button class="next"></button>\n</div>'},useData:!0})},"268e":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=(r=null!=(r=null!=t?o(t,"data"):t)?o(r,"node"):r)?o(r,"yearDesc"):r,t))},5:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=(r=null!=(r=null!=t?o(t,"data"):t)?o(r,"node"):r)?o(r,"locationDesc"):r,t))},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lambda,u=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="entry-card-component entryCardComponent '+(null!=(l=d(i,"if").call(s,null!=t?d(t,"active"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:52},end:{line:1,column:79}}}))?l:"")+'" data-entry-id="'+u(c(null!=(l=null!=t?d(t,"data"):t)?d(l,"id"):l,t))+'">\n  <span class="icon icon-close iconClose"></span>\n  <section class="entry-base-info">\n    <section class="base-info">\n      <div class="entry-avatar">\n        <img src="'+u(c(null!=(l=null!=t?d(t,"data"):t)?d(l,"avatar"):l,t))+'" alt="">\n      </div>\n      <div class="text-info">\n        <div class="entry-name">\n          '+u(c(null!=(l=null!=t?d(t,"data"):t)?d(l,"name"):l,t))+'\n        </div>\n        <div class="entry-desc entryDesc">\n          '+(null!=(l=a(n("fcbf")).call(s,null!=(l=null!=t?d(t,"data"):t)?d(l,"desc"):l,"title","true",{name:"xss",hash:{},data:o,loc:{start:{line:13,column:10},end:{line:13,column:44}}}))?l:"")+'\n        </div>\n      </div>\n    </section>\n\n    <ul class="more-info">\n      <li class="loading">\n        <span class="l-1"></span>\n        <span class="l-2"></span>\n        <span class="l-3"></span>\n        <span class="l-4"></span>\n        <span class="l-5"></span>\n        <span class="l-6"></span>\n      </li>\n    </ul>\n\n  </section>\n  <section class="entry-nodes">\n    <div class="nodes-list">\n      <div class="node-item nodeItem">\n        <div class="title">\n          '+(null!=(l=a(n("fcbf")).call(s,null!=(l=null!=(l=null!=t?d(t,"data"):t)?d(l,"node"):l)?d(l,"title"):l,"title","true",{name:"xss",hash:{},data:o,loc:{start:{line:34,column:10},end:{line:34,column:50}}}))?l:"")+'\n        </div>\n        <div class="sub-title">\n          <div class="time">'+(null!=(l=d(i,"if").call(s,null!=(l=null!=(l=null!=t?d(t,"data"):t)?d(l,"node"):l)?d(l,"yearDesc"):l,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:37,column:28},end:{line:37,column:83}}}))?l:"")+'</div>\n          <div class="address">'+(null!=(l=d(i,"if").call(s,null!=(l=null!=(l=null!=t?d(t,"data"):t)?d(l,"node"):l)?d(l,"locationDesc"):l,{name:"if",hash:{},fn:e.program(5,o,0),inverse:e.noop,data:o,loc:{start:{line:38,column:31},end:{line:38,column:94}}}))?l:"")+'</div>\n        </div>\n        <div class="desc descWrap">\n          '+(null!=(l=a(n("fcbf")).call(s,null!=(l=null!=(l=null!=t?d(t,"data"):t)?d(l,"node"):l)?d(l,"desc"):l,"title","true",{name:"xss",hash:{},data:o,loc:{start:{line:41,column:10},end:{line:41,column:49}}}))?l:"")+"\n        </div>\n      </div>\n    </div>\n  </section>\n</div>"},useData:!0})},"27dc":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMurmurHash=t.getFitBounds=t.getSubtractYear=t.getLifeLineYears=t.getMinAndMax=t.getBirthToDead=t.getLocation=t.getImageUrlByName=void 0;var i=s(n("8034")),a=n("feb7"),r=s(n("a316")),o=n("2cc3"),l=s(n("b2a5"));function s(e){return e&&e.__esModule?e:{default:e}}t.getImageUrlByName=function(e){var t="其他";if(!e)return""+t;var n=["出生","被捕","创造","辞职","刺杀","挫败","定居","发现","反对","工作","合作","患病","获得","加入","教授","结婚","结交","就读","离婚","目击","剽窃","评价","签订","审判","受封","死亡","去世","逃亡","通信","统治","脱狱","写作","宣战","应试","游历","战役","支持","知名作品","指挥","资助","事件","博物馆","医院","学医","军人","天气","政治","天主教","主持","传道","复活"];return[["出生","出生于","幼年","降生"],["禁锢于","被捕","俘虏","被捕于","受困"],["重大突破","证明","发表","研究","发现","出版","设计","制作","改进","发明重大突破","证明","发表","研究","发现","出版","设计","制作","改进","创造","发展","写作","发明","著作","创立","创作","作品","提出","论证","解释","开创","贡献","建立","记录","参与创作","修撰","仿作","临摹","撰写","创建","著有","制造","整理翻译","最后的晚餐","绘画","创办"],["辞职","辞去"],["杀害","杀死","刺杀","被杀","射杀","被刺杀","诛杀"],["败于","挫败","崩溃","失败","惨败"],["生活于","移居","定居","逗留","住在","迁住","搬到","居住"],["重大突破","证明","发表","研究","发现","出版","设计","制作","改进","发明重大突破","证明","发表","研究","发现","出版","设计","制作","改进","创造","发展","写作","发明","著作","创立","创作","作品","提出","论证","解释","开创","贡献","建立","记录","参与创作","修撰","仿作","临摹","撰写","创建","著有","制造","整理翻译"],["争论","批评","攻击","反对","争执","怀疑和否定","竞争"],["工作","担任","就职","任命","任职","仕","协助","出任","聘请","聘用","任职于","工作于","同事","任教于","部门","打工"],["合作","指导","监制"],["患病","生病","暴病","医治"],["获得","共同获奖","共同获得","获奖"],["加入","选入","入选","当选","参与","成员","会员","涉嫌参与","参加","入参"],["教授","执教","任教","当选院士","讲学","教导"],["结婚","再婚","结亲","迎娶","爱上","娶妻"],["会见","结识","交流","拜访","访问","遇到","结交","拜见","至交","相遇","朋友","邀请","来访","相恋","首晤","应召","奉召"],["就读","就学","学习","师承","师从","师法","拜师","入学","研读","学习于","学徒","同门","毕业","就读于","毕业于","研究","读书","学堂"],["离婚"],["目击"],["剽窃"],["评价"],["签订","签订协议","签署"],["审判"],["受封","受封于","封爵","获任","中","升任","进献"],["死亡","逝世","葬于","病逝","逝世于","死亡于","死于","病逝于","去世","坟墓","归葬"],["死亡","逝世","葬于","病逝","逝世于","死亡于","死于","病逝于","去世"],["逃亡","出走","押解","流放","逃往"],["讨论","通信","上书"],["加冕为","成为","继承","统治","当选","即位","首相","加封","太子"],["脱狱","越狱"],["写作","从文"],["平定","终结","打败","统一","攻打","入侵","宣战","对战"],["应试"],["周游","游历","前往","出游","返回","重返","逃回","旅行","回到","受邀返回","到达","旅访","迁往","移民","留学","接回","调遣","回乡","回"],["战役","之战","进攻","战争","一战","二战","世界大战","对战","受难"],["支持","跟随","赞赏","影响"],["代表","得名","知名作品","知名于"],["领导","指挥"],["援助","资助","赞助","招揽"],["事件"],["博物馆"],["医院","医学院","医学","住院"],["学医","治疗","治病","医","医生"],["军人","参军"],["天气","过冬"],["政治","会议","内阁"],["天主教","受洗","洗礼","道成肉身","显现"],["主持"],["传道"],["复活"]].forEach((function(i,a){i.forEach((function(i){if(-1!=e.indexOf(i))return t=n[a],"去世"===i&&(t="死亡"),!1}))})),""+t},t.getLocation=function(e){var t=[];switch(e.type){case"Point":t=e.coordinates;break;case"LineString":t=e.coordinates[0];break;case"Polygon":e.coordinates.push(e.coordinates[0]);var n=(0,a.polygon)([e.coordinates]);t=(0,r.default)(n).geometry.coordinates}return t},t.getBirthToDead=function(e){var t=[],n=1/0;return e.forEach((function(e){"number"==typeof e.time&&e.time<n&&(n=e.time)})),e.forEach((function(e){"number"==typeof e.time?t.push(e.time-n):t.push(null)})),t},t.getMinAndMax=function(e){var t=1/0,n=-1/0;return e.forEach((function(e){"number"==typeof e&&e<t&&(t=e),"number"==typeof e&&e>n&&(n=e)})),{min:t,max:n}},t.getLifeLineYears=function(e,t,n){var i=[];if(null!=t)var a=(0,o.dateParser)(t),r=a.year*a.abdcType;return e.forEach((function(e){if(e.timeInfo)if(null!=t&&(0,o.compareTime)(e.timeInfo,t)<0)i.push("出生前");else if(null!=n&&(0,o.compareTime)(e.timeInfo,n)>0)i.push("去世后");else if(null!=t&&null!=n){var a=c(t,e.timeInfo);i.push(0==a?1:a)}else if(null!=t&&null==n&&r>1899)if((0,o.compareTime)(e.timeInfo,(0,o.getCurrentTime)())>0)i.push("不详");else{var l=c(t,e.timeInfo);i.push(0==l?1:l)}else i.push("不详");else i.push("不详")})),i};var c=t.getSubtractYear=function(e,t){var n=(0,o.dateParser)(e),i=(0,o.dateParser)(t);return""==n.month&&(n.month=0),""==n.date&&(n.date=0),""==i.month&&(i.month=0),""==i.date&&(i.date=0),parseInt(i.month)>parseInt(n.month)||parseInt(i.month)==parseInt(n.month)&&parseInt(i.date)>=parseInt(n.date)?i.year*i.abdcType-n.year*n.abdcType:i.year*i.abdcType-n.year*n.abdcType-1};t.getFitBounds=function(e){var t=[],n=[];return e.forEach((function(e,i){(!t[0]||t[0]<e.location[0])&&(t[0]=e.location[0]),(!t[1]||t[1]<e.location[1])&&(t[1]=e.location[1]),(!n[0]||n[0]>e.location[0])&&(n[0]=e.location[0]),(!n[1]||n[1]>e.location[1])&&(n[1]=e.location[1])})),[n,t]},t.getMurmurHash=function(e){var t={title:e.title,time:e.time,location:e.location,desc:e.desc,imageIds:e.imageIds.length>0?e.imageIds:null};return l.default.murmurhash3_32_gc((0,i.default)(l.default.objKeySort(t)))}},"27f1":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("8827")),a=r(n("57ba"));function r(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(t){var n=this;(0,i.default)(this,e),this.map=t.map,this.comps=t.comps,this.showComps=t.showComps,t.showComps&&t.showComps.forEach((function(e){n.comps[e]&&setTimeout((function(){n.comps[e].showComponent&&n.comps[e].showComponent()}),0)}))}return(0,a.default)(e,[{key:"update",value:function(){}},{key:"onPageMount",value:function(){}},{key:"_onPageExit",value:function(){var e=this;this.showComps&&this.showComps.forEach((function(t){e.comps[t]&&e.comps[t].hideComponent&&e.comps[t].hideComponent()})),this.onPageExit()}},{key:"onPageExit",value:function(){}},{key:"destroy",value:function(){}}]),e}();t.default=o,e.exports=t.default},"2ba3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("9b57")),a=c(n("3f6b")),r=c(n("8827")),o=c(n("57ba")),l=c(n("5e07")),s=c(n("81b1"));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,r.default)(this,e),(0,a.default)(this,{map:null,active:!0,data:[],onMarkerClick:null,markersInstance:[],mapMarkers:[]},t)}return(0,o.default)(e,[{key:"createRecommendMarkers",value:function(e){var t=[],n=[],i=this.dealAllRecommendData(e),a=supercluster({radius:10,maxZoom:22,minZoom:0});a.load(i);var r=parseInt(this.map.getZoom());a.getClusters([-360,-90,360,90],r).forEach((function(e){if(e.properties.cluster_id>=0){var i=a.getLeaves(e.properties.cluster_id,r,1/0,0);n.push(i)}else t.push(e)})),this.drawMultiMarker(n),this.drawSingleMarker(t)}},{key:"drawMultiMarker",value:function(e){var t=this;e.forEach((function(e){var n=[];e.forEach((function(e){n.push(e.properties.originalNode)}));var i=new s.default({data:n,active:t.active,onMarkerClick:function(e){t.cancelSelect("",e.id),t.onMarkerClick(e),t.drawPointLinePolygonForActiveMarker(e.geometry)}});t.markersInstance.push(i),t.map&&t.mapMarkers.push(t.map.addMarker({element:i.$html[0],point:n[0].location}))}))}},{key:"drawSingleMarker",value:function(e){var t=this;e.forEach((function(e){var n=e.properties.originalNode,i=new l.default({data:n,active:t.active,onMarkerClick:function(e){t.cancelSelect("",e.id),t.onMarkerClick(e),t.drawPointLinePolygonForActiveMarker(e.geometry)}});t.markersInstance.push(i),t.map&&t.mapMarkers.push(t.map.addMarker({element:i.$html[0],point:n.location,id:n.id,data:{}}))}))}},{key:"drawPointLinePolygonForActiveMarker",value:function(e){this.removePointLinePolygon();var t=[],n=[],i=[];e.forEach((function(e){switch(e.type){case"Point":t.push(e.coordinates);break;case"LineString":n.push(e.coordinates);break;case"Polygon":i.push(e.coordinates)}})),t.length>1&&(this.drawPoint(t),this.drawKgsLine(t)),n.length>0&&this.drawLineString(n),i.length>0&&this.drawPolygon(i)}},{key:"drawPoint",value:function(e){var t=[];e.forEach((function(e){var n={type:"Feature",properties:{},geometry:{type:"Point",coordinates:e}};t.push(n)})),this.map.addPersonPoint(t,"detail-recommend-kgs-point")}},{key:"drawKgsLine",value:function(e){var t={type:"Feature",properties:{},geometry:{coordinates:[],type:"LineString"}};e.forEach((function(e){t.geometry.coordinates.push(e)})),t.geometry.coordinates.push(e[0]),this.map.addPersonLineString([t],"detail-recommend-kgs-line")}},{key:"drawLineString",value:function(e){var t=[];e.forEach((function(e){t.push({type:"Feature",properties:{},geometry:{coordinates:[].concat((0,i.default)(e)),type:"LineString"}})})),this.map.addPersonLineString(t,"detail-recommend-line")}},{key:"drawPolygon",value:function(e){var t={type:"Feature",properties:{},geometry:{coordinates:[].concat((0,i.default)(e)),type:"Polygon"}};this.map.addPersonPolygon([t],"detail-recommend-polygon")}},{key:"removePointLinePolygon",value:function(){this.map.removePersonPoint("detail-recommend-kgs-point"),this.map.removePersonLineString("detail-recommend-kgs-line"),this.map.removePersonLineString("detail-recommend-line"),this.map.removePersonPolygon("detail-recommend-polygon")}},{key:"show",value:function(){this.markersInstance.forEach((function(e){e.updateStatus(!0)}))}},{key:"hide",value:function(){this.markersInstance.forEach((function(e){e.updateStatus(!1)}))}},{key:"removeAll",value:function(){var e=this;this.removePointLinePolygon(),this.mapMarkers.forEach((function(t){e.map.removeMarker({marker:t})}))}},{key:"cancelSelect",value:function(e,t){this.removePointLinePolygon(),this.markersInstance.forEach((function(n){if(Array.isArray(n.data)){for(var i=0;i<n.data.length;i++)if(t&&t==n.data[i].id)return;for(var a=0;a<n.data.length;a++)n.data[a].id!=e&&e||n.cancelSelect()}else{if(t&&t==n.data.id)return;n.data.id!=e&&e||n.cancelSelect()}}))}},{key:"clickMarker",value:function(e){var t=this,n=this.map.gl.getZoom();this.markersInstance.forEach((function(i){if(Array.isArray(i.data))i.data.forEach((function(a){if(a.id==e){t.cancelSelect("",e),$(".entry-component").empty(),t.map.on("moveend.recommend-marker",(function(n){i.confirmSelect(e),t.map.off("moveend.recommend-marker")}));var r=t.map.gl.project(a.location),o=t.map.gl.unproject([r.x-$(".components-container").outerWidth()/2+160,r.y]);t.map.flyToPoint({center:o,zoom:n,maxDuration:500})}}));else if(i.data.id==e){t.cancelSelect("",e),$(".entry-component").empty(),t.map.on("moveend.recommend-marker",(function(n){i.confirmSelect(e),t.map.off("moveend.recommend-marker")}));var a=t.map.gl.project(i.data.location),r=t.map.gl.unproject([a.x-$(".components-container").outerWidth()/2+160,a.y]);t.map.flyToPoint({center:r,zoom:n,maxDuration:500})}}))}},{key:"dealAllRecommendData",value:function(e){var t=[];return e.forEach((function(e,n){t.push({type:"Feature",properties:{id:e.id,originalNode:e,index:n},geometry:{type:"Point",coordinates:e.location},location:e.location})})),t}}]),e}();t.default=u,e.exports=t.default},"2f7f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("0030")),l=n("0280");function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{map:{},children:[],allChild:[],callback:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)({data:this.allChild[0].properties,children:this.allChild})),this.map.addMarker({element:this.$html[0],point:this.children.geometry.coordinates,id:this.allChild[0].properties.id,data:this.allChild[0].properties}),this._bind()}},{key:"_bind",value:function(){var e=this;this.$html.find(".active-cluster-marker-right").on("wheel",(function(e){e.stopPropagation()})),this.$html.find(".normal-marker-icon").on("mousedown",(function(t){t.stopPropagation(),e.reSet(),e.$html.find(".normal-marker-icon").removeClass("active"),e.$html.find(".active-marker-icon").addClass("active"),e.$html.find(".active-cluster-marker-right").addClass("active"),e.$html.find(".per-marker-content").eq(0).addClass("active"),e.$html.css({"z-index":1})})),this.$html.find(".bottom-text").on("mousedown",(function(t){t.stopPropagation(),(0,l.activeMarkerClickState)(),e.reSet(),e.$html.find(".normal-marker-icon").removeClass("active"),e.$html.find(".active-marker-icon").addClass("active"),e.$html.find(".active-cluster-marker-right").addClass("active"),e.$html.find(".per-marker-content").eq(0).addClass("active"),e.$html.css({"z-index":1})})),this.$html.find(".per-marker-content").on("mousedown",(function(t){e.$html.find(".per-marker-content").removeClass("active"),$(t.currentTarget).addClass("active"),e.callback(t.currentTarget.dataset.did)}))}},{key:"reset",value:function(){this.$html.find(".normal-marker-icon").addClass("active"),this.$html.find(".active-marker-icon").removeClass("active"),this.$html.find(".active-cluster-marker-right").removeClass("active"),this.$html.find(".per-marker-content").removeClass("active"),this.$html.css({"z-index":0})}},{key:"setToDisplay",value:function(e){var t=this,n=e.id;this.allChild.forEach((function(e,i){e.properties.id===n&&(i,t.$html.find(".normal-marker-icon").removeClass("active"),(t.$html.find(".per-marker-content").eq(i)[0].offsetTop>199||t.$html.find(".active-cluster-marker-right")[0].scrollTop>t.$html.find(".per-marker-content").eq(i)[0].offsetTop)&&(t.$html.find(".active-cluster-marker-right")[0].scrollTop=t.$html.find(".per-marker-content").eq(i)[0].offsetTop),t.$html.find(".active-cluster-marker-right").addClass("active"),t.$html.find(".per-marker-content").removeClass("active"),t.$html.find(".per-marker-content").eq(i).addClass("active"),t.$html.find(".active-marker-icon").addClass("active "+e.properties.iconUrl),t.$html.css({"z-index":1}))}))}},{key:"destroy",value:function(){this.$html.remove()}}]),e}();t.default=c,e.exports=t.default},"34a7":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="multi-marker-background">\n  <div class="multi-marker-background-in">\n\n  </div>\n</div>'},useData:!0})},3594:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="result-page resultPage">\n  <div class="components-container">\n    <div class="search-container searchContainer"></div>\n    <div class="results-container resultsContainer"></div>\n    <div class="right-info-container">\n      <div class="territory-info-container territoryInfoContainer"></div>\n    </div>\n  </div>\n</div>'},useData:!0})},"364a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("8827")),a=u(n("57ba")),r=u(n("9c68"));n("a288");var o=n("4a87"),l=u(n("5d7e")),s=u(n("b7f5")),c=n("a7c7");function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){(0,i.default)(this,e),t.entry&&(this.data={},this.entry=t.entry,this.setEntryCompCardsState=t.setEntryCompCardsState,this._createDom())}return(0,a.default)(e,[{key:"_bind",value:function(){var e=this;this.$html.off("click.hidePop").on("click.hidePop",(function(t){!$(t.target).hasClass("pop-content")&&$(t.target).parents(".pop-content").length<1&&e.pop.close()}))}},{key:"_createDom",value:function(){var e=this;this.$html=$((0,r.default)(this.entry)),this.pop=new o.PopBox({customContent:!0,$content:this.$html,afterClose:function(){e.setEntryCompCardsState&&setTimeout((function(){c.MAB_STATE.update("entryCompCardsState",!1)}),20)}}),this._createProduct(),this._bind()}},{key:"_createProduct",value:function(){this.product=new l.default({entry:this.entry,$container:this.$html.find(".product-container"),pop:this.pop}),this.$ps=new s.default(this.$html.find(".product-container")[0])}},{key:"_createMedia",value:function(){}}]),e}();t.default=d,e.exports=t.default},"398d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n("41b2")),a=p(n("9b57")),r=p(n("3f6b")),o=p(n("8827")),l=p(n("57ba")),s=p(n("74a71")),c=p(n("5f72")),u=p(n("fc67")),d=p(n("00b8")),m=p(n("e2d7")),h=n("0280"),f=n("a7c7");function p(e){return e&&e.__esModule?e:{default:e}}var v=function(){function e(t){(0,o.default)(this,e),(0,r.default)(this,{$container:"",emptyBeforeAppend:!1,active:!1,map:null,handleSingleMarkerClick:function(){},handleMultiMarkerClick:function(){},handleMarkerClick:function(){}},t),this.POI_LENGTH=40,this.markerTypes={recommend:"recommendMarkers",result:"resultMarkers",nodeDetail:"nodeDetailMarkers"},this.clusteredMarkersType={recommend:"recommendClusteredMarkers",result:"resultClusteredMarkers"},this.recommendClusteredMarkers=[],this.resultClusteredMarkers=[],this.recommendMarkers=[],this.resultMarkers=[],this.nodeDetailMarkers=[],this._render(),this._bindGlobalEvents()}return(0,l.default)(e,[{key:"_render",value:function(){this.$container&&(this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,s.default)({active:this.active})),this.$container.append(this.$html),this._bind())}},{key:"getAllRecommendMarkers",value:function(){return this.recommendMarkers}},{key:"getAllNodeDetailMarkers",value:function(){return this.nodeDetailMarkers}},{key:"getAllResultMarkers",value:function(){return this.resultMarkers}},{key:"getMarkersByName",value:function(e){return this.markerTypes[e]?this[this.markerTypes[e]]:[]}},{key:"removeAllNodeDetailMarkers",value:function(){var e=this.getMarkersByName("nodeDetail");this.removeMarkers(e.map((function(e){return e.id})),"nodeDetail","nodeDetail")}},{key:"removeMarkers",value:function(e,t,n){!Array.isArray(e)&&this.markerTypes[t]||(this[this.markerTypes[t]]=this[this.markerTypes[t]].filter((function(t){return-1===e.indexOf(t.id)})),this.map&&this.map.removeMarkerByIdsAndType(e,n))}},{key:"removeNodeDetailMarkerByIds",value:function(e){Array.isArray(e)&&(this.nodeDetailMarkers=this.nodeDetailMarkers.filter((function(t){return-1===e.indexOf(t.id)})),this.map&&this.map.removeMarkerByIds(e))}},{key:"removeRecommendMarkerByIds",value:function(e){Array.isArray(e)&&(this.recommendMarkers=this.recommendMarkers.filter((function(t){return-1===e.indexOf(t.id)})),this.map&&this.map.removeMarkerByIds(e))}},{key:"removeAllRecommendMarkers",value:function(){var e=this.getAllRecommendMarkers(),t=[];e.forEach((function(e){t.push(e.id)})),t.length>0&&this.removeRecommendMarkerByIds(t)}},{key:"_getMarkersLength",value:function(e){var t=0;return e.forEach((function(e){t+=e.isCluster?e.allChild.length:1})),t}},{key:"_dealNodeDetailMarker",value:function(e){var t=[];return e.forEach((function(e,n){t.push({type:"Feature",properties:{id:e.id,originalNode:e,index:n,name:e.itemName},geometry:{type:"Point",coordinates:e.location}})})),t}},{key:"updateNodeDetailMarkers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=[],i=[],r=this._dealNodeDetailMarker(e),o=supercluster({radius:t,maxZoom:22,minZoom:0});o.load(r);var l=parseInt(this.map.getZoom()),s=o.getClusters([-360,-90,360,90],l);s.forEach((function(e){var t=e.properties.cluster_id>=0;if(t){var a=o.getLeaves(e.properties.cluster_id,l,1/0,0),r=a[0].properties.originalNode,s=r.id,c=r.itemName,u=r.location,d=r.iconClassName,m=r.data;s+="-multi";var h=m.node,f=m.itemId,p=a.find((function(e){return e.properties.originalNode.active})),v=p?p.properties.index:a[a.length-1].properties.index;i.push({id:s,itemName:c,itemId:f,location:u,node:h,order:v,active:!!p,iconClassName:d,allChild:a,isCluster:t})}else{var y=e.properties.originalNode,g=y.id,k=y.itemName,b=y.location,_=y.iconClassName,C=y.active,$=y.data,w=$.node,M=$.itemId;n.push({id:g,itemName:k,itemId:M,location:b,node:w,active:C,order:e.properties.index,iconClassName:_,originalNode:e.properties.originalNode})}}));var c=[].concat(n,i),u=this.getDiffMarkers(this.nodeDetailMarkers,c);this.drawNodeDetailMarker([].concat((0,a.default)(u.addCluster),(0,a.default)(u.addSingle)),"nodeDetail"),this.removeMarkers(u.delete.map((function(e){return e.id})),"nodeDetail","nodeDetail"),this.nodeDetailClusteredMarkers=[].concat(i),this.nodeDetailMarkers=[].concat((0,a.default)(c))}},{key:"drawNodeDetailMarker",value:function(e,t){var n=this;e.forEach((function(e){var i=new d.default({data:e});n.map&&n.map.addMarker({element:i.getElement(),point:e.location,id:e.id,type:t,data:{}}),setTimeout((function(){i.fadeInMarkerItem()}),200)}))}},{key:"_getMarkersData",value:function(e,t){var n=[],i=[];e.forEach((function(e){e.isCluster?(n.push(e.allChild[0].properties.originalNode),i.push.apply(i,(0,a.default)(e.allChild.slice(1)))):n.push(e.originalNode)}));var r=this.POI_LENGTH-(n.length+t.length);r>0&&i.slice(0,r).forEach((function(e){n.push(e.properties.originalNode)}));return n=[].concat((0,a.default)(n),(0,a.default)(t))}},{key:"changeRecommendMarkers",value:function(e){var t=[],n=[],i=this.dealAllRecommendData(e),a=supercluster({radius:50,maxZoom:22,minZoom:0});a.load(i);var r=parseInt(this.map.getZoom());a.getClusters([-360,-90,360,90],r).forEach((function(e){var i=e.properties.cluster_id>=0;if(i){var o=a.getLeaves(e.properties.cluster_id,r,1/0,0),l=o[0].properties.originalNode,s=l.id,c=l.imgUrl,u=l.itemName,d=l.location,m=l.year,h=l.types,f=l.iconClassName,p=l.data;s+="-multi";var v=p.itemId,y=p.node;n.push({id:s,imgUrl:c,itemName:u,itemId:v,location:d,node:y,year:m,types:h,iconClassName:f,allChild:o,isCluster:i})}else{var g=e.properties.originalNode,k=g.id,b=g.imgUrl,_=g.itemName,C=g.location,$=g.year,w=g.types,M=g.iconClassName,x=g.data,P=x.itemId,T=x.node;t.push({id:k,imgUrl:b,itemName:_,itemId:P,location:C,node:T,year:$,types:w,iconClassName:M,originalNode:e.properties.originalNode})}}));var o=[].concat(t,n),l=this.getDiffMarkers(this.recommendMarkers,o);this.reSetMultiMarkerNum(l.noChange),this.drawClusteredMarker(l.addCluster,"recommend"),this.drawSingleMarker(l.addSingle,"recommend"),this.removeRecommendMarkerByIds(l.delete.map((function(e){return e.id}))),this.recommendMarkers=o}},{key:"reSetMultiMarkerNum",value:function(e){e.forEach((function(e){if(e.isCluster){var t=e.id,n=$(".multiMarker[data-mid="+t+"]");n.length>0&&($(n[0]).find(".markerLen")[0].innerText=e.allChild.length)}}))}},{key:"replenishMarkers",value:function(e){if(Array.isArray(e)&&this.recommendMarkers.length<this.POI_LENGTH){var t=this.POI_LENGTH-this.recommendMarkers.length;e=e.slice(0,t);var n=this._getMarkersData(this.recommendMarkers,e);this.changeRecommendMarkers(n)}}},{key:"closeMultiMarker",value:function(){$(".mapBoxGlMap").find(".mapMarker.open").length>0&&(setTimeout((function(){f.MAB_STATE.update("multiMarkerBgOpened",!1)}),320),$(".mapBoxGlMap").find(".mapMarker.open").find(".multi-marker-background").remove(),$(".mapBoxGlMap").find(".mapMarker.open").find(".multiMarkerChild").remove(),$(".mapBoxGlMap").find(".mapMarker.open").removeClass("open"))}},{key:"dealAllRecommendData",value:function(e){var t=[];return e.forEach((function(e,n){t.push({type:"Feature",properties:{id:e.id,originalNode:e,index:n,name:e.itemName},geometry:{type:"Point",coordinates:e.location}})})),t}},{key:"createRecommendMarkers",value:function(e){var t=[],n=[],i=this.dealAllRecommendData(e),a=supercluster({radius:100,maxZoom:22,minZoom:0});a.load(i);var r=parseInt(this.map.getZoom());a.getClusters([-360,-90,360,90],r).forEach((function(e){var i=e.properties.cluster_id>=0;if(i){var o=a.getLeaves(e.properties.cluster_id,r,1/0,0),l=o[0].properties.originalNode,s=l.id,c=l.imgUrl,u=l.itemName,d=l.location,m=l.year,h=l.types,f=l.iconClassName,p=l.data;s+="-multi";var v=p.node,y=p.itemId;n.push({id:s,imgUrl:c,itemName:u,itemId:y,location:d,node:v,year:m,types:h,iconClassName:f,allChild:o,isCluster:i})}else{var g=e.properties.originalNode,k=g.id,b=g.imgUrl,_=g.itemName,C=g.location,$=g.year,w=g.types,M=g.iconClassName,x=g.data,P=x.node,T=x.itemId;t.push({id:k,imgUrl:b,itemName:_,itemId:T,location:C,node:P,year:$,types:w,iconClassName:M,originalNode:e.properties.originalNode})}})),this.recommendMarkers=[].concat(t,n),this.drawClusteredMarker(n,"recommend"),this.drawSingleMarker(t,"recommend")}},{key:"generatePointsSpiral",value:function(e){this._spiralLengthStart=11,this._spiralFootSeparation=28,this._spiralLengthFactor=5;var t=1*this._spiralLengthStart*2,n=1*this._spiralFootSeparation*2,i=1*this._spiralLengthFactor*Math.PI*2*2,a=0,r=[],o=void 0;for(r.length=parseInt(e),o=0;o<e;o++)o<parseInt(e)&&(r[o]=[t*Math.cos(a),t*Math.sin(a)]),t+=i/(a+=n/t+2e-7*o),this.maxRadius=t;return r}},{key:"drawClusteredMarker",value:function(e,t){var n=this,i=this[this.clusteredMarkersType[t]]||[];e.forEach((function(e){var a=new u.default({data:e,map:n.map,type:t,onClick:function(){n.handleMultiMarkerClick()},emitMultiMarker:function(e,t){n._handleClusteredMarkersClick(e,t)}}),r=i.findIndex((function(t){return t.id===e.id})),o={id:e.id,marker:a};-1!==r?i[r]=o:i.push(o),n.map&&n.map.addMarker({element:a.getElement(),point:e.location,id:e.id,data:{}})}))}},{key:"_handleClusteredMarkersClick",value:function(e,t){var n=(this[this.clusteredMarkersType[t]]||[]).find((function(t){return t.id===e}));if(n){var i=(this[this.markerTypes[t]]||[]).find((function(t){return t.isCluster&&t.id===e}));if(i){var a=[];n.marker.generatePointsSpiral(i.allChild.length).forEach((function(e,t){i.allChild[t].properties.originalNode.markerOffset=[e[0],e[1]];var n=i.allChild[t].properties.originalNode,r=n.id,o=n.imgUrl,l=n.itemName,s=n.markerOffset,c=n.iconClassName,u=n.location,d=n.year,m=n.types,h=n.data,f=h.itemId,p=h.node;a.push({id:r,imgUrl:o,itemName:l,itemId:f,markerOffset:s,location:u,node:p,year:d,types:m,iconClassName:c})}));var r=this.map.gl.project(i.location),o=r.x,l=r.y;n.marker.drawBackground(o,l),n.marker.drawSingleMarker(a)}}}},{key:"drawSingleMarker",value:function(e,t){var n=this;e.forEach((function(e){var i=document.createElement("div"),a=$(i);a.attr("data-mid",e.id).attr("data-type",t).addClass("mapMarker map-marker"),new c.default({$container:a,data:e}),n.map&&n.map.addMarker({element:i,point:e.location,id:e.id,data:{}})}))}},{key:"removeResultMarkerByIds",value:function(e){Array.isArray(e)&&(this.resultMarkers=this.resultMarkers.filter((function(t){return-1===e.indexOf(t.id)})),this.map&&this.map.removeMarkerByIds(e))}},{key:"removeAllResultMarkers",value:function(){var e=this.getAllResultMarkers(),t=[];e.forEach((function(e){t.push(e.id)})),t.length>0&&this.removeRecommendMarkerByIds(t)}},{key:"getDiffMarkers",value:function(e,t){var n={delete:[],addSingle:[],addCluster:[],noChange:[]};return e.forEach((function(e){var i=t.find((function(t){return t.id==e.id}));i?n.noChange.push(i):n.delete.push(e)})),t.forEach((function(e){n.noChange.find((function(t){return t.id==e.id}))||(e.isCluster?n.addCluster.push(e):n.addSingle.push(e))})),n}},{key:"dealResultData",value:function(e){var t=[];return e.forEach((function(e,n){t.push({type:"Feature",properties:{id:e.id,originalNode:e,index:n,name:e.itemName},geometry:{type:"Point",coordinates:e.location}})})),t}},{key:"createResultMarkers",value:function(e){var t=[],n=[],i=this.dealResultData(e),a=supercluster({radius:100,maxZoom:22,minZoom:0});a.load(i);var r=parseInt(this.map.getZoom());a.getClusters([-360,-90,360,90],r).forEach((function(e){var i=e.properties.cluster_id>=0;if(i){var o=a.getLeaves(e.properties.cluster_id,r,1/0,0),l=o[0].properties.originalNode,s=l.id,c=l.imgUrl,u=l.imageUrl,d=l.itemName,m=l.location,h=l.year,f=l.types,p=l.iconClassName,v=l.data;s+="-multi",n.push({id:s,imgUrl:c,imageUrl:u,itemName:d,location:m,year:h,types:f,iconClassName:p,data:v,isCluster:i,allChild:o})}else{var y=e.properties.originalNode,g=y.id,k=y.imgUrl,b=y.imageUrl,_=y.itemName,C=y.location,$=y.year,w=y.types,M=y.iconClassName,x=y.data;t.push({id:g,imgUrl:k,imageUrl:b,itemName:_,location:C,year:$,types:w,iconClassName:M,data:x,originalNode:e.properties.originalNode})}})),this.resultMarkers=[].concat(t,n),this.drawClusteredMarker(n,"result"),this.drawSingleMarker(t,"result")}},{key:"drawLine",value:function(e){var t={type:"Feature",properties:{},geometry:{coordinates:[],type:"LineString"}},n=[];e.forEach((function(e){var i={type:"Feature",properties:{},geometry:{type:"Point",coordinates:e}};n.push(i),t.geometry.coordinates.push(e)})),t.geometry.coordinates.push(e[0]),this.map.addPersonPoint(n,"kgs-point"),this.map.addPersonLineString([t],"kgs-line")}},{key:"drawSketchPoints",value:function(e){var t=[];e.forEach((function(e){t.push({type:"Feature",properties:(0,i.default)({},e.data),geometry:{type:"Point",coordinates:e.points}})})),this.map.addSketchPoint(t,"sketch-point")}},{key:"drawPolygon",value:function(e){var t=[];e.forEach((function(e){t.push({type:"Feature",properties:{},geometry:{coordinates:[e],type:"Polygon"}})})),this.map.addPersonPolygon(t,"person-fill")}},{key:"drawSketchPolygon",value:function(e){var t=[];e.forEach((function(e){t.push({type:"Feature",properties:(0,i.default)({},e.data),geometry:{coordinates:[e.points],type:"Polygon"}})})),this.map.addSketchPolygon(t,"sketch-polygon")}},{key:"drawSketchLines",value:function(e){var t=[];e.forEach((function(e){t.push({type:"Feature",properties:(0,i.default)({},e.data),geometry:{coordinates:[].concat((0,a.default)(e.points)),type:"LineString"}})})),this.map.addSketchLine(t,"sketch-line")}},{key:"drawLineString",value:function(e){var t=[];e.forEach((function(e){t.push({type:"Feature",properties:{},geometry:{coordinates:[].concat((0,a.default)(e)),type:"LineString"}})})),this.map.addPersonLineString(t,"person-line")}},{key:"removeSketchPoint",value:function(){this.map.removeSketchPoint("sketch-point")}},{key:"removeSketchLine",value:function(){this.map.removeSketchLine("sketch-line")}},{key:"removeSketchPolygon",value:function(){this.map.removeSketchPolygon("sketch-polygon")}},{key:"removeMapLine",value:function(){this.map.removePersonPoint("kgs-point"),this.map.removePersonLineString("kgs-line")}},{key:"removePolygon",value:function(){this.map.removePersonPolygon("person-fill")}},{key:"removeLineString",value:function(){this.map.removePersonLineString("person-line")}},{key:"updateNodeDetailMultiMarker",value:function(e,t){var n=e.id,i=e.iconClassName,a=e.allChild.find((function(e){return e.properties.id===t}));if(a){var r=a.properties.originalNode.iconClassName;e.iconClassName=r,e.itemName=a.properties.originalNode.itemName,e.data=a.properties.originalNode.data;var o=$(".mapBoxGlMap").find(".mapMarker[data-mid="+n+"]");$(".mapBoxGlMap").find(".mapMarker").removeClass("active"),o.addClass("active"),o.find(".multiMarkerIcon").removeClass(i).addClass(r);var l=(0,m.default)(e.itemName,"title","true");o.find(".multiMarkerTitle").attr("title",l),o.find(".multiMarkerTitle")[0].innerText=l}}},{key:"updateMultiMarkerIcon",value:function(e,t){var n=e.id,i=e.iconClassName,a=e.allChild.find((function(e){return e.properties.id===t}));if(a){$(".mapBoxGlMap").find(".mapMarker").removeClass("active");var r=a.properties.originalNode.iconClassName;e.iconClassName=r,e.itemName=a.properties.originalNode.itemName,e.data=a.properties.originalNode.data;var o=$(".mapBoxGlMap").find(".mapMarker[data-mid="+n+"]");o.addClass("active"),o.find(".multiMarkerIcon").removeClass(i).addClass(r);var l=(0,m.default)(e.itemName,"title");o.find(".multiMarkerTitle").attr("title",l),o.find(".multiMarkerTitle")[0].innerText=l}}},{key:"activeMarker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];$(".mapBoxGlMap").find(".mapMarker").removeClass("active").end().find(".multiMarkerChild").removeClass("active"),t?$(".mapBoxGlMap").find(".multiMarkerChild[data-mid="+e+"]").addClass("active"):$(".mapBoxGlMap").find(".mapMarker[data-mid="+e+"]").addClass("active")}},{key:"inActiveMarker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?$(".mapBoxGlMap").find(".multiMarkerChild[data-mid="+e+"]").removeClass("active"):$(".mapBoxGlMap").find(".mapMarker[data-mid="+e+"]").removeClass("active")}},{key:"inActiveAllMarkers",value:function(){$(".mapBoxGlMap").find(".mapMarker").removeClass("active")}},{key:"_bind",value:function(){}},{key:"_bindGlobalEvents",value:function(){var e=this;$(".mapBoxGlMap").on("mousedown",".singleMarkerIcon, .singleMarkerTitle",(function(t){var n=$(t.currentTarget).parents(".mapMarker"),i=n.data("mid"),a=n.data("type"),r=(e[e.markerTypes[a]]||[]).find((function(e){return e.id===i}));if(r){var o=r.originalNode;e.handleSingleMarkerClick(o,!1)}})),$(".mapBoxGlMap").on("mousedown",".nodeDetailMarkerEle",(function(t){(0,h.activeMarkerClickState)();var n=$(t.currentTarget).parents(".mapMarker");if(!n.hasClass("active")){var i=n.data("mid"),a=n.data("type"),r=(e[e.markerTypes[a]]||[]).find((function(e){return e.id===i}));if(r){r.isCluster&&(r=r.allChild[r.allChild.length-1].properties);var o=r.originalNode;e.handleMarkerClick(o,!!r.isCluster)}}})),$(".mapBoxGlMap").on("mousedown",".subMultiMarkerIcon, .subMultiMarkerTitle",(function(t){var n=$(t.currentTarget).parent(),i=$(t.currentTarget).parents(".multiMarker").data("mid"),a=n.data("mid"),r=$(t.currentTarget).parents(".mapMarker").data("type"),o=(e[e.markerTypes[r]]||[]).find((function(e){return e.id===i})).allChild.find((function(e){return e.properties.id===a}));if(o){var l=o.properties.originalNode;e.handleSingleMarkerClick(l,!0)}}))}},{key:"update",value:function(e){(0,r.default)(this,e),this._render()}}]),e}();t.default=v,e.exports=t.default},"3a5a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("3f6b")),a=h(n("8827")),r=h(n("57ba")),o=n("0280"),l=n("feb7"),s=h(n("a316")),c=h(n("2f7f")),u=h(n("a637")),d=h(n("e2d7")),m=h(n("3d58"));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",data:{},comps:{},clickCallback:function(){},clickItem:function(){}},t),this.clusterObjects=[],this.markerObjects=[],this.lastIndex=0,this._dealData(),this._renderMarkers()}return(0,r.default)(e,[{key:"_dealData",value:function(){var e=this;this.markers=[],this.data.forEach((function(t,n){var i=(0,o.getMarkerIconNameByTitle)(t.node.title),a=t.node.standardTime+" "+t.node.location.desc,r=t.node.location.geometry.find((function(e){return"Point"===e.type}));!r&&(r=t.node.location.geometry[0]),!t.node.title&&(t.node.title=a),e.markers[n]={type:"Feature",properties:{id:t.id,title:(0,d.default)(m.default.htmlParser(t.node.title)),location:[],iconUrl:i,timeLocation:(0,d.default)(m.default.htmlParser(a)),timeDesc:""},geometry:{type:"Point",coordinates:e.getLocation(r)}}}))}},{key:"getLocation",value:function(e){var t=[];switch(e.type){case"Point":t=e.coordinates;break;case"LineString":t=e.coordinates[0];break;case"Polygon":e.coordinates.push(e.coordinates[0]);var n=(0,l.polygon)([e.coordinates]);t=(0,s.default)(n).geometry.coordinates}return t}},{key:"_renderMarkers",value:function(){var e=this;this.clusterMarker=supercluster({radius:.1,maxZoom:22,minZoom:0}),this.clusterMarker.load(this.markers);var t=parseInt(this.map.getZoom());this.clusterMarker.getClusters([-360,-90,360,90],t).forEach((function(n,i){if(n.properties.cluster_id>=0){var a=e.clusterMarker.getLeaves(n.properties.cluster_id,t,1/0,0),r=new c.default({map:e.map,children:n,allChild:a,callback:function(t){e.clickItem(t)},reSet:function(){e.reSetAll()}});e.markerObjects.push(r)}else{var o=new u.default({map:e.map,child:n,callback:function(t){e.clickItem(t)},reSet:function(){e.reSetAll()}});e.markerObjects.push(o)}})),this._bind()}},{key:"listItemHover",value:function(e){var t=this;this.hoverId!=e&&(this.hoverId=e,this.markerObjects.forEach((function(n,i){if(n.child&&n.child.properties.id===e)t.reSetAll(),t.lastIndex=i+1,n.setToDisplay();else if(n.allChild){if(!n.allChild.find((function(t){return t.properties.id===e})))return void(n.reset&&n.reset());t.lastIndex!==i+1&&(n.reset&&n.reset(),t.reSetAll()),t.lastIndex=i+1,n.setToDisplay({id:e})}else n.reset&&n.reset()})))}},{key:"reSetAll",value:function(){this.markerObjects.forEach((function(e,t){e.reset&&e.reset()}))}},{key:"_bind",value:function(){var e=this;this.map.on("click.detailList",(function(){e.hoverId=null,e.reSetAll()}))}},{key:"destroy",value:function(){this.markerObjects.forEach((function(e,t){e.destroy()}))}}]),e}();t.default=f,e.exports=t.default},"3c3d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=l(n("8336"));function l(e){return e&&e.__esModule?e:{default:e}}n("1737");var s=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,active:!0,regimes:[],featureArr:null,onMarkerClick:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$container&&(this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,o.default)({active:this.active,regimes:this.regimes})),this.$container.append(this.$html)),this._bind()}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".regimeLi",(function(t){t.stopPropagation();var n=$(t.currentTarget).data("idx"),i=e.featureArr.find((function(e){return e.properties.oid===n}));e.onMarkerClick(i)}))}},{key:"update",value:function(e){(0,i.default)(this,e),this.emptyBeforeAppend=!0,this._render()}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"destroy",value:function(){this.$html&&this.$html.remove(),this.onDestroyed()}}]),e}();t.default=s,e.exports=t.default},"3cc8":function(e,t,n){},"402f":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="top-right-in-map mapTopRightContainer">\n  <div class="year-control-wrap yearControlWrap"></div>\n  <div class="user-info-wrap userInfoWrap"></div>\n</div>'},useData:!0})},"417f":function(e,t,n){"use strict";var i,a=n("49dc"),r=n("9fdf");var o=((i=r)&&i.__esModule?i:{default:i}).default.getLang({api:!0});e.exports={getLock:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o;return(0,a.postJson)("/api/item/lock/status",{id:t,itemId:n,type:e,language:i})},cancelLock:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o;return(0,a.postJson)("/api/item/cancel",{id:t,itemId:n,type:e,language:i},{once:!1})},updateLock:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o;return(0,a.postJson)("/api/item/heartbeat/update",{id:t,itemId:n,type:e,language:i})},getAllMsgs:function(){return(0,a.getJson)("/api/message/get/all")},readOne:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,a.postJson)("/api/message/read/one",{messageId:e,messageType:t})},getMsgByType:function(e,t,n){return(0,a.getJson)("/api/message/get/"+e+"/"+t+"/"+n)},getSetting:function(){return(0,a.getJson)("/api/message/setting/get")},setSetting:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.postJson)("/api/message/setting/send",e)},readAllMsg:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,a.postJson)("/api/message/read/all",{messageId:t,messageType:e})}}},"439c":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,i,r,o){return'  <div class="show-periods-menu cp" title="'+e.escapeExpression(a(n("dfab")).call(null!=t?t:e.nullContext||{},"StagingMenu","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:3,column:43},end:{line:3,column:75}}}))+'">\n    <div class="periods-icon">\n\n    </div>\n  </div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="periods-left-bottom active">\n'+(null!=(l=c(i,"if").call(s,null!=t?c(t,"showPeriods"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:2,column:2},end:{line:8,column:9}}}))?l:"")+'  <div class="periods-random cp" title="'+e.escapeExpression(a(n("dfab")).call(s,"RandomStaging","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:9,column:40},end:{line:9,column:74}}}))+'">\n    <div class="periods-random-icon"></div>\n  </div>\n</div>'},useData:!0})},"43f0":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("3f6b")),a=c(n("8827")),r=c(n("57ba"));n("1635");var o=c(n("e28d")),l=c(n("4bf1")),s=n("4a87");function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{images:[{url:""}]},t),this._cleanUrls(),this._createPop()}return(0,r.default)(e,[{key:"_createPop",value:function(){var e=this,t=window.innerWidth,n=window.innerHeight;this.$html=$((0,o.default)({images:this.images,w:t,h:n})),this.pop=new s.PopBox({customContent:!0,$content:this.$html});var i=this.$html.find("img");this._imgLoaded(i)?this.$html.find(".pop-loading").hide():(i.on("load",(function(){e.$html.find(".pop-loading").hide()})),i.on("error",(function(){e.$html.find(".pop-loading").hide()})))}},{key:"_cleanUrls",value:function(){var e=window.innerWidth,t=window.innerHeight;this.images.forEach((function(n){n.url=(0,l.default)(n.url,{w:e,h:t})}))}},{key:"_imgLoaded",value:function(e){return e.complete&&0!==e.naturalHeight}}]),e}();t.default=u,e.exports=t.default},4429:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="option-btn pre-btn preBtn">\n      '+o(r(null!=t?l(t,"preText"):t,t))+'\n    </div>\n    <div class="page-state">\n      <span class="currentNum page-num">'+o(r(null!=t?l(t,"currentNum"):t,t))+"</span>/<span>"+o(r(null!=t?l(t,"totalNum"):t,t))+'</span>\n    </div>\n    <div class="option-btn next-btn nextBtn">\n      '+o(r(null!=t?l(t,"nextText"):t,t))+"\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,r){var o,l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="page-controller-component">\n'+(null!=(o=(l=n("d930"),l&&(l.__esModule?l.default:l)).call(null!=t?t:e.nullContext||{},null!=t?s(t,"totalNum"):t,">",0,{name:"ifcond",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:2,column:2},end:{line:12,column:13}}}))?o:"")+"</div>"},useData:!0})},"452a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("3f6b")),a=u(n("8827")),r=u(n("57ba"));n("de27");var o=u(n("4d0d")),l=u(n("8bb6")),s=n("4a87"),c=n("a7c7");function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){(0,a.default)(this,e),t.entry&&(this.data={},this.entry=t.entry,this.setEntryCompCardsState=t.setEntryCompCardsState,this.shortLength=784,(0,i.default)(this.data,{id:t.entry.id,portrait:t.entry.imageUrl,name:t.entry.name,disambiguation:t.entry.disambiguation,summaries:l.default.removeReferences(t.entry.summary),aliases:""}),this._loadedData())}return(0,r.default)(e,[{key:"_bind",value:function(){var e=this;this.$html.off("click.hidePop").on("click.hidePop",(function(t){!$(t.target).hasClass("pop-content")&&$(t.target).parents(".pop-content").length<1&&e.pop.close()}))}},{key:"_createDom",value:function(){var e=this;this.$html=$((0,o.default)(this.data)),this.pop=new s.PopBox({customContent:!0,$content:this.$html,afterClose:function(){e.setEntryCompCardsState&&setTimeout((function(){c.MAB_STATE.update("entryCompCardsState",!1)}),20)}}),this._bind()}},{key:"_loadedData",value:function(){var e=this,t=window.location.href.split("=")[1];this.entry.aliases.filter((function(n,i){n==decodeURI(t).toString()&&(e.data.aliases=n)})),this._createDom(),this._setExcellentTag()}},{key:"_setExcellentTag",value:function(){switch(this.entry.degree){case"EXCELLENT":this.$html.find(".pop-content").addClass("entry-excellent");break;case"UNFINISHED":this.$html.find(".pop-content").addClass("entry-unfinished")}}}]),e}();t.default=d,e.exports=t.default},4675:function(e,t,n){},4721:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=["Jan","Feb","Mar","Apr","Mar","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.default={yearToMonth:function(e,t){var n=Math.floor(Math.abs(e)%1*12);switch(t){case"short-en":return i[n]+".";default:return n+1}}},e.exports=t.default},"474e":function(e,t,n){},"4b0d":function(e,t,n){},"4d0d":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,i,r,o){var l=e.lambda,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"          "+s(l(null!=t?c(t,"name"):t,t))+" "+s(a(n("dfab")).call(null!=t?t:e.nullContext||{},"alsoKnownAs","detail",{name:"lang",hash:{},data:o,loc:{start:{line:16,column:19},end:{line:16,column:50}}}))+" "+s(l(null!=t?c(t,"aliases"):t,t))+"\n"},3:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"          ("+e.escapeExpression(e.lambda(null!=t?r(t,"disambiguation"):t,t))+")\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="map-entry-comp-pop-box pop-box-mask">\n\n  <div class="pop-content summary">\n    <div class="icon-close-big pop-close"></div>\n    <div class="summary-box">\n      <div class="content-wraper">\n        <div class="content-title">\n            <strong>\n              '+e.escapeExpression(e.lambda(null!=t?c(t,"name"):t,t))+'\n            </strong>\n        </div>\n        <div class="content-byname">\n'+(null!=(l=c(i,"if").call(s,null!=t?c(t,"aliases"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:15,column:10},end:{line:17,column:17}}}))?l:"")+(null!=(l=c(i,"if").call(s,null!=t?c(t,"disambiguation"):t,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:18,column:10},end:{line:20,column:17}}}))?l:"")+'        </div>\n        <div class="content-summary">\n          <article class="data-summary ">\n\n            '+(null!=(l=a(n("fcbf")).call(s,null!=t?c(t,"summaries"):t,"content",{name:"xss",hash:{},data:o,loc:{start:{line:25,column:12},end:{line:25,column:41}}}))?l:"")+"\n          </article>\n\n        </div>\n      </div>\n\n    </div>\n  </div>\n</div>"},useData:!0})},"51c9":function(e,t,n){},"52b4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("96d5")),l=s(n("8171"));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{timebar:{},markers:[],domPositionTimer:{},onClick:function(){}},t),this.ruler=this.timebar.ruler,this._render(),this._bind()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)()),this.timebar.$html.append(this.$html)}},{key:"_bind",value:function(){var e=this;this.ruler.addEvent("change",(function(t){e._updateDomPosition()})),this.$html.on("click",(function(t){var n=t.target.dataset.index,i=e.markers[n];e._onClick(t,i)})),this.$html.on("mouseover",(function(e){$(".timebar-width-division.active").addClass("on-hover")})),this.$html.on("mouseout",(function(e){$(".timebar-width-division.active").removeClass("on-hover")}))}},{key:"_updateDomPosition",value:function(){var e=this,t=this.$html.outerWidth();this.markers.forEach((function(n,i){var a=e.ruler.getScreenXbyTime(n.time);n.$dom.css("left",a),e.domPositionTimer[i]&&clearTimeout(e.domPositionTimer[i]),e.domPositionTimer[i]=setTimeout((function(){72>a?n.$dom.find(".timebar-marker-item-content").css("transform","translateX(-"+a+"px)"):72+a>=t?n.$dom.find(".timebar-marker-item-content").css("transform","translateX(-"+(144+a-t)+"px)"):n.$dom.find(".timebar-marker-item-content").css("transform","translateX(-50%)")}),100)}))}},{key:"_onClick",value:function(e,t){this.onClick(e,t)}},{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{time:0};e.index=this.markers.length;var t=$((0,l.default)(e));this.$html.append(t),this.markers.push((0,i.default)({time:e.time,$dom:t},e)),this._updateDomPosition()}},{key:"update",value:function(e){var t=this;this.removeAll(),e.forEach((function(e){"number"==typeof e.time&&t.add(e)}))}},{key:"removeAll",value:function(){for(var e=this.markers.length-1;e>=0;e--)this.remove(e)}},{key:"remove",value:function(e){var t=this.markers[e];t&&(t.$dom.remove(),this.markers.splice(e,1))}}]),e}();t.default=c,e.exports=t.default},5393:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=l(n("20e3"));function l(e){return e&&e.__esModule?e:{default:e}}n("51c9");var s=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,active:!1,desc:"",position:{x:-1e3,y:-1e3},onDestroyed:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$container&&(this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,o.default)({active:this.active,desc:this.desc})),this.$container.append(this.$html),this.updatePosition(),this._bind())}},{key:"_bind",value:function(){}},{key:"updatePosition",value:function(e){e&&(this.position=e),this.$html.css({top:this.position.y-12+"px",left:this.position.x+"px"})}},{key:"update",value:function(){this.emptyBeforeAppend=!0,this._render()}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"destroy",value:function(){this.$html&&this.$html.remove(),this.onDestroyed()}}]),e}();t.default=s,e.exports=t.default},"5537a":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <div class="avatar-container">\n'+(null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=(r=null!=t?o(t,"user"):t)?o(r,"image"):r,{name:"if",hash:{},fn:e.program(4,a,0),inverse:e.program(6,a,0),data:a,loc:{start:{line:4,column:4},end:{line:8,column:11}}}))?r:"")+"  </div>\n"},4:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <div class="avatar userAvatar" style="background-image:url(\''+e.escapeExpression(e.lambda(null!=(r=null!=t?o(t,"user"):t)?o(r,"image"):r,t))+"')\"></div>\n"},6:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <div class="username">'+e.escapeExpression(e.lambda(null!=(r=null!=t?o(t,"user"):t)?o(r,"name"):r,t))+"</div>\n"},8:function(e,t,i,a,r){return'  <a class="login-link">'+e.escapeExpression((o=n("dfab"),o&&(o.__esModule?o.default:o)).call(null!=t?t:e.nullContext||{},"login",{name:"lang",hash:{},data:r,loc:{start:{line:11,column:24},end:{line:11,column:40}}}))+"</a>\n";var o},10:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <li class="user-menu-item userMenuItem" data-index="'+o(r(a&&l(a,"index"),t))+'">'+o(r(null!=t?l(t,"name"):t,t))+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="user-info-component '+(null!=(r=l(n,"if").call(o,null!=t?l(t,"show"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:32},end:{line:1,column:57}}}))?r:"")+'">\n'+(null!=(r=l(n,"if").call(o,null!=t?l(t,"user"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.program(8,a,0),data:a,loc:{start:{line:2,column:2},end:{line:12,column:9}}}))?r:"")+'  <ul class="user-menu userMenu">\n    <div class="test_triangle_border">\n      <div class="popup">\n        <span>\n          <em></em>\n        </span>\n      </div>\n    </div>\n'+(null!=(r=l(n,"each").call(o,null!=t?l(t,"items"):t,{name:"each",hash:{},fn:e.program(10,a,0),inverse:e.noop,data:a,loc:{start:{line:21,column:4},end:{line:23,column:13}}}))?r:"")+"  </ul>\n</div>"},useData:!0})},"561b":function(e,t,n){},5638:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s="function",c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="painting-slide">\n  <li class="painting-item" id="'+c(typeof(r=null!=(r=u(n,"id")||(null!=t?u(t,"id"):t))?r:l)===s?r.call(o,{name:"id",hash:{},data:a,loc:{start:{line:2,column:32},end:{line:2,column:38}}}):r)+'">\n    <a href="/painting/detail?paintingType=alone&paintingId='+c(typeof(r=null!=(r=u(n,"id")||(null!=t?u(t,"id"):t))?r:l)===s?r.call(o,{name:"id",hash:{},data:a,loc:{start:{line:3,column:60},end:{line:3,column:66}}}):r)+'" target=\'_blank\'>\n      <img class="paint-img" src="'+c(typeof(r=null!=(r=u(n,"url")||(null!=t?u(t,"url"):t))?r:l)===s?r.call(o,{name:"url",hash:{},data:a,loc:{start:{line:4,column:34},end:{line:4,column:41}}}):r)+'" width="'+c(typeof(r=null!=(r=u(n,"width")||(null!=t?u(t,"width"):t))?r:l)===s?r.call(o,{name:"width",hash:{},data:a,loc:{start:{line:4,column:50},end:{line:4,column:59}}}):r)+'">\n    </a>\n    <div class="title">\n      <span>'+c(typeof(r=null!=(r=u(n,"title")||(null!=t?u(t,"title"):t))?r:l)===s?r.call(o,{name:"title",hash:{},data:a,loc:{start:{line:7,column:12},end:{line:7,column:21}}}):r)+"</span>\n    </div>\n  </li>\n</div>"},useData:!0})},"566a":function(e,t,n){},5732:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <img src="'+e.escapeExpression(e.lambda(null!=t?r(t,"imageResponse"):t,t))+'" width="44" height="44" alt="">\n'},5:function(e,t,i,a,r){return'            <img class="default-img" src="'+n("fac8")+'" width="44" height="44" alt="">\n'},7:function(e,t,n,i,a){return""},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lambda,u=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="detail-list-header-component '+(null!=(l=d(i,"if").call(s,null!=t?d(t,"active"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:41},end:{line:1,column:68}}}))?l:"")+'">\n    <div class="person-info">\n        <div class="left-info">\n            <div class="left-info-name">'+u(c(null!=t?d(t,"name"):t,t))+'</div>\n            <div class="left-info-type">'+u(c(null!=t?d(t,"disambiguation"):t,t))+'</div>\n        </div>\n        <div class="right-info">\n'+(null!=(l=d(i,"if").call(s,null!=t?d(t,"imageResponse"):t,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.program(5,o,0),data:o,loc:{start:{line:8,column:12},end:{line:12,column:19}}}))?l:"")+'        </div>\n    </div>\n    <div class="person-desc">\n        '+(null!=(l=a(n("691b")).call(s,null!=t?d(t,"summary"):t,{name:"clean",hash:{},fn:e.program(7,o,0),inverse:e.noop,data:o,loc:{start:{line:16,column:8},end:{line:16,column:36}}}))?l:"")+'\n    </div>\n    <ul class="more-info">\n        <li class="link-item linkItem" data-to="detail" title="'+u(a(n("dfab")).call(s,"Details","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:19,column:63},end:{line:19,column:91}}}))+'">\n            '+u(a(n("dfab")).call(s,"Details","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:20,column:12},end:{line:20,column:40}}}))+'\n        </li>\n        <li class="link-item linkItem" data-to="relation" title="'+u(a(n("dfab")).call(s,"relationGraphShortHand",{name:"lang",hash:{},data:o,loc:{start:{line:22,column:65},end:{line:22,column:98}}}))+'">\n            '+u(a(n("dfab")).call(s,"relationGraphShortHand",{name:"lang",hash:{},data:o,loc:{start:{line:23,column:12},end:{line:23,column:45}}}))+'\n        </li>\n        <li class="link-item linkItem" data-to="product" title="'+u(a(n("dfab")).call(s,"worksAndMedia","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:25,column:64},end:{line:25,column:98}}}))+'">\n            '+u(a(n("dfab")).call(s,"worksAndMedia","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:26,column:12},end:{line:26,column:46}}}))+'\n        </li>\n        <li class="link-item linkItem" data-to="article" title="'+u(a(n("dfab")).call(s,"relatedArticle","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:28,column:64},end:{line:28,column:99}}}))+'">\n            '+u(a(n("dfab")).call(s,"relatedArticle","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:29,column:12},end:{line:29,column:47}}}))+"\n        </li>\n    </ul>\n</div>"},useData:!0})},"591a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=x(n("9b57")),a=x(n("3f6b")),r=x(n("633f")),o=x(n("8827")),l=x(n("57ba")),s=x(n("158c")),c=x(n("9918")),u=x(n("27f1")),d=x(n("3594")),m=n("ffc6"),h=x(n("f1f1")),f=n("2cc3"),p=n("a8a7"),v=n("3d58"),y=x(n("e2d7")),g=x(n("8dfd")),k=x(n("e93f")),b=n("e355"),_=n("0280"),C=n("a7c7"),w=x(n("d355")),M=x(n("7ac4"));function x(e){return e&&e.__esModule?e:{default:e}}var P=function(e){function t(e){(0,o.default)(this,t),e.showComps=["timebar","searchBoxComponent","markersComponent","bottomRightComponent","topRightComponent"];var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.active=!0,n.emptyBeforeAppend=!0,n.onDestroyed=function(){},n.$container=$(".pageContainer"),n.mabState=C.MAB_STATE,n.queryTypeArr=["1","2","3"],n.resultsState={queryType:"3",hasPureEntries:!1,pageSize:30,totalPage:1,currentPage:1},n.resultMarkers=[],n}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onPageMount",value:function(){var e=this;this.comps.timebar.update({type:"area",scalable:!0,draggable:!0,showDivision:!0}),this.timeController=this.comps.timebar.controller,this.$html=$((0,d.default)()),this.emptyBeforeAppend&&this.$container.empty(),this.$container.append(this.$html),this.pageParams=m.Nav.getParams("map-router"),this.keyword=(0,v.htmlDecode)(this.pageParams.kw),this.safeKeyword=(0,y.default)(this.keyword,"title"),M.default.setTitle(_L_("AofB",{p:["searchResult",this.safeKeyword]}),_L_("timemap")),this.markersComponent=this.comps.markersComponent,this.markersComponent.removeAllRecommendMarkers(),this.markersComponent.update({handleSingleMarkerClick:function(t,n){switch(t.data.type){case"painting":t.imageUrl.split("?")[0];window.open("/painting/detail?paintingType=alone&paintingId="+t.id);break;case"book":window.open("/book/detail?id="+t.id);break;case"item":window.open("/map/detail/"+t.id);break;case"territory":var i=e.timeMapEntries.list.find((function(e){return e.id===t.id})),a=i.territory.esGeometry.dlsOid,r=btoa(encodeURIComponent(i.name));(0,p.setSessionStorageItem)("map","territoryInfo",i),window.open("/map/detail/territory?id="+a+"&n="+r);break;case"itemAndTerritory":window.open("/map/detail/"+t.id)}},handleMultiMarkerClick:function(){(0,_.activeMarkerClickState)()}}),this.searchBoxComponent=this.comps.searchBoxComponent,this.searchBoxComponent.update({$container:this.$html.find(".searchContainer"),active:!0,emptyBeforeAppend:!0,emitEmptySearch:function(){m.Nav.go("/map/",{key:"map-router"})}}),this.searchBoxComponent.setInputValue(this.keyword),this.resultsList=new g.default({$container:this.$html.find(".resultsContainer"),toNextPage:function(t){e.resultsState.currentPage<e.resultsState.totalPage&&(e.resultsState.currentPage++,t="3"===t?"1":t,e.resultsState.queryType=t,e._getResultByKeyword({queryType:t}))},toPrePage:function(t){e.resultsState.currentPage>1&&(e.resultsState.currentPage--,1===e.resultsState.currentPage&&(t="1"===t?"3":t),e.resultsState.queryType=t,e._getResultByKeyword({queryType:t}))},toEntryPage:function(t){e.resultsState.currentPage=1,e.resultsState.queryType=t,e._getResultByKeyword({queryType:t})},emitClickEntryItem:function(t,n){switch(n){case"painting":var i=e.timeMapEntries.list.find((function(e){return e.id===t}));if(i||(i=e.pureEntries.list.find((function(e){return e.id===t}))),i){i.imageUrl.split("?")[0];window.open("/painting/detail?paintingType=alone&paintingId="+t)}break;case"book":window.open("/book/detail?id="+t);break;case"item":case"itemAndTerritory":window.open("/map/detail/"+t);break;case"territory":var a=e.timeMapEntries.list.find((function(e){return e.id===t})),r=a.territory.esGeometry.dlsOid,o=btoa(encodeURIComponent(a.name));(0,p.setSessionStorageItem)("map","territoryInfo",a),window.open("/map/detail/territory?id="+r+"&n="+o)}},hoverEntryItem:function(t){var n=e.markersComponent.getAllResultMarkers().find((function(e){return e.isCluster?!!e.allChild.find((function(e){return e.properties.id===t})):e.id===t}));n&&(n.isCluster?$("[data-mid="+t+"]").length>0?e.markersComponent.activeMarker(t,n.isCluster):e.markersComponent.updateMultiMarkerIcon(n,t):e.markersComponent.activeMarker(t,!!n.isCluster))}}),this.territoryInfo=new k.default({$container:this.$html.find(".territoryInfoContainer"),emitCloseTerritoryInfo:function(){e.territory.handleCloseTerritoryInfo()},onDestroyed:function(){e.territoryInfo=null}}),this.territory=new w.default({map:this.map,territoryInfo:this.territoryInfo,onDestroyed:function(){e.territory=null}}),this._getResultByKeyword({queryType:"3"}),this._bind()}},{key:"_bind",value:function(){var e=this;window.onbeforeunload=function(){var t=e._getTimeBarArea(),n=t.start,i=t.end;setStorageItem("timeMapState","timeBarArea",{start:n,end:i})},this.comps.timebar.onChange=function(){var t=e.comps.timebar.ruler.getAreaTime().end;e.map.setYear(Math.round(t),"left")},$("body").off("click.multiMarkerAndEntryCardAtResult").on("click.multiMarkerAndEntryCardAtResult",(function(t){var n=$(t.target),i=e.mabState.get("entryCompCardsState"),a=e.mabState.get("multiMarkerIsOpening");!i&&!a&&n.parents(".mapMarker").length<1&&n.parents(".entryCardComponent").length<1&&e.markersComponent&&e.markersComponent.closeMultiMarker()}))}},{key:"_getResultByKeyword",value:function(e){var t=this,n=e.queryType;h.default.getTimeMapResultByKeyword({keyword:this.keyword,queryType:n,page:""+this.resultsState.currentPage}).then((function(e){e&&200===e.code&&(0,b.getCategoriesList)().then((function(i){t.categoryMap={},i.forEach((function(e){t.categoryMap[e.id]=e})),"2"===n?t.timeMapEntries={totalCount:0,list:[]}:(t.timeMapEntries={totalCount:e.data.timemapSpatioResponse.totalCount,list:e.data.timemapSpatioResponse.mapItemNodes||[]},t._handleTimeMapEntries()),t.pureEntries="1"===n?{totalCount:0,list:[]}:{totalCount:e.data.timemapNoSpatioResponse.totalCount||0,list:e.data.timemapNoSpatioResponse.nodes||[]};var r="2"===n?e.data.timemapNoSpatioResponse.totalPage:e.data.timemapSpatioResponse.totalPage;r=r>50?50:r,(0,a.default)(t.resultsState,{queryType:n,hasPureEntries:e.data.keywordNoSpatio,totalPage:r,currentPage:t.resultsState.currentPage}),t._updateResultsList(),t._updateResultMarkers(),t._updateTimeBar()}))}))}},{key:"_handleTimeMapEntries",value:function(){var e=this;this.timeMapEntries.list.forEach((function(t){t.imageUrl=e._getEntryImgUrl(t)}))}},{key:"_handlePureEntries",value:function(){}},{key:"_updateTimeBar",value:function(){var e=this._getResultList(),t=this._handleResultMarkers(e),n=[];if(t.forEach((function(e){e.year&&n.push(e.year)})),(n=n.sort((function(e,t){return e-t}))).length>0){var i=n[0],a=n[n.length-1];a=a-i<1?a+1:a,this.timeController.ruler.setTimeByOffset(i,a,.3,(function(){})),this.timeController.updateTime(i,a),this.map.setYear(a)}}},{key:"_getResultList",value:function(){var e=[];switch(this.resultsState.queryType){case"1":e=this.timeMapEntries.list;break;case"2":e=this.pureEntries.list;break;case"3":e=[].concat((0,i.default)(this.pureEntries.list.slice(0,1)),(0,i.default)(this.timeMapEntries.list))}return e}},{key:"_updateResultMarkers",value:function(){var e=this._getResultList(),t=this._handleResultMarkers(e),n=this.markersComponent.getAllResultMarkers(),i=[];n.forEach((function(e){i.push(e.id)})),this.markersComponent.removeResultMarkerByIds(i),this.resultMarkers=t,this.markersComponent.createResultMarkers(t),this._fitMapBounds(t)}},{key:"_fitMapBounds",value:function(e){var t=[],n=[];e.forEach((function(e,i){(!t[0]||t[0]<e.location[0])&&(t[0]=e.location[0]),(!t[1]||t[1]<e.location[1])&&(t[1]=e.location[1]),(!n[0]||n[0]>e.location[0])&&(n[0]=e.location[0]),(!n[1]||n[1]>e.location[1])&&(n[1]=e.location[1])}));var i={top:200,bottom:200,left:$(".resultsContainer").outerWidth()+100,right:100};2===n.length&&2===t.length&&this.map.gl.fitBounds([n,t],{padding:i,maxZoom:10})}},{key:"_handleResultMarkers",value:function(e){var t=this,n=[];return e.forEach((function(e){var i=e.id,a=e.imgUrl,r=e.imageUrl,o=e.name,l=e.type,s=e.types,c=t._getResultDataYear(e),u=t._getResultDataLocation(e);if(u){var d=(0,_.getIconClassName)(s,"default-icon");switch(l){case"painting":d="painting-icon";break;case"book":d="book-icon"}n.push({id:i,imgUrl:a,imageUrl:r,itemName:o,location:u,year:c,types:s,iconClassName:d,data:{type:l}})}})),n}},{key:"_getResultDataYear",value:function(e){var t="",n=e.timemapNode;if(n&&n.time){var i=n.time.startTime||n.time.endTime;if(i){var a=(0,f.dateParser)(i);t=a.abdcType*a.year}}return t}},{key:"_getResultDataLocation",value:function(e){var t="",n=e.timemapNode;if(n&&n.location){var i=n.location;i&&(i.geometries.length>1||i.geometries[0].type,"Point"===i.geometries[0].type&&(t=i.geometries[0].coordinates))}return t}},{key:"_updateResultsList",value:function(){this.resultsList.update({emptyBeforeAppend:!0,timeMapEntries:this.timeMapEntries,pureEntries:this.pureEntries,keyword:this.keyword,safeKeyword:this.safeKeyword,queryType:this.resultsState.queryType,hasPureEntries:this.resultsState.hasPureEntries,totalPage:this.resultsState.totalPage,currentPage:this.resultsState.currentPage})}},{key:"_getEntryImgUrl",value:function(e){return e.imageUrl?e.imageUrl+"?w=140":this._getCategoryIcons(e)}},{key:"_getCategoryIcons",value:function(e){var t="__STATIC_COMMON__/img/icons/nine-cates/",n={2:"人物",3:"事件",4:"地点",5:"创造",6:"组织",7:"宗教",9:"观念",10:"医疗",161:"自然"};if("territory"===e.type)t+="territory.svg";else if(e.types&&e.types[0]){var i=this._findCategoryId(this.categoryMap,e.types[0]);t+=n.hasOwnProperty(i)?n[i]+".svg":"无分类.svg"}else t+="无分类.svg";return t}},{key:"_findCategoryId",value:function(e,t){if(!e[t])return"none";if("1"===e[t].parentId)return e[t].id;var n=e[t].parentId;return this._findCategoryId(e,n)}},{key:"_navigateToResult",value:function(e){e.length<1?m.Nav.go("/map/",{key:"map-router"}):m.Nav.go("/map/result/"+e,{key:"map-router"})}},{key:"onPageExit",value:function(){this.markersComponent&&this.markersComponent.removeAllResultMarkers(),$("body").off("click.multiMarkerAndEntryCardAtResult"),this.territory.destroy(),window.onbeforeunload=function(){}}},{key:"destroy",value:function(){this.$container&&this.$container.empty(),this.onDestroyed()}}]),t}(u.default);t.default=P,e.exports=t.default},"5a47":function(e,t,n){},"5ab1":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r,o,l=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li class="link-item linkItem '+(null!=(r=u(n,"if").call(l,null!=t?u(t,"available"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:34},end:{line:3,column:64}}}))?r:"")+'" data-to="'+c("function"==typeof(o=null!=(o=u(n,"type")||(null!=t?u(t,"type"):t))?o:s)?o.call(l,{name:"type",hash:{},data:a,loc:{start:{line:3,column:75},end:{line:3,column:83}}}):o)+'" title="'+c("function"==typeof(o=null!=(o=u(n,"name")||(null!=t?u(t,"name"):t))?o:s)?o.call(l,{name:"name",hash:{},data:a,loc:{start:{line:3,column:92},end:{line:3,column:100}}}):o)+'">\n      '+c("function"==typeof(o=null!=(o=u(n,"name")||(null!=t?u(t,"name"):t))?o:s)?o.call(l,{name:"name",hash:{},data:a,loc:{start:{line:4,column:6},end:{line:4,column:14}}}):o)+"\n    </li>\n"},2:function(e,t,n,i,a){return"active"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<ul class="more-info">\n'+(null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"items"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:2},end:{line:6,column:11}}}))?r:"")+"</ul>"},useData:!0})},"5b16":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("439c"));n("0172");var l=n("098c");function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{active:!1,comps:{},showPeriods:!0,$container:$("body"),showPeriodsCard:function(){},afterRandomPeriods:function(){}},t),this.periods=(0,l.getPeriods)(),this.pid=this.periods,this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)({showPeriods:this.showPeriods})),this.$container.append(this.$html),this._bind()}},{key:"_bind",value:function(){this.$html.find(".show-periods-menu").on("click",this.showPeriodsMenu.bind(this)),this.$html.find(".periods-random").on("click",this.randomPeriods.bind(this))}},{key:"showComponent",value:function(){this.$html&&this.$html.addClass("active")}},{key:"showPeriodsMenu",value:function(){this.showPeriodsCard()}},{key:"randomPeriods",value:function(){var e=this.comps.timebar.minYear,t=this.comps.timebar.maxYear,n=e+Math.floor(Math.random()*(t-e));this.comps.timebar.ruler.setCenterByTime(n,.3)}},{key:"update",value:function(e){(0,i.default)(this,e),this.periods=(0,l.getPeriods)(),this.pid=this.periods,this._render()}},{key:"destroy",value:function(){this.$html.remove()}}]),e}();t.default=c,e.exports=t.default},"5d7e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("3f6b")),a=d(n("8827")),r=d(n("57ba"));n("0dbf");var o=d(n("714f")),l=d(n("d37c")),s=d(n("5638")),c=d(n("fe21")),u=n("2f20");function d(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t){(0,a.default)(this,e),this.entry=t.entry,this.$container=t.$container,this.pop=t.pop,this.data={},(0,i.default)(this.data,{bookdata:{},paintingdata:{},id:this.entry.id,bookPresentNum:1,bookTotalNum:Math.ceil(this.entry.moduleStat.book/5),paintingPresentNum:1,paintingTotalNum:Math.ceil(this.entry.moduleStat.painting/5),bookTotal:this.entry.moduleStat.book,paintingTotal:this.entry.moduleStat.painting}),this.load()}return(0,r.default)(e,[{key:"_createDom",value:function(){this.$html=$((0,o.default)(this.data)),this.$container.append(this.$html)}},{key:"load",value:function(){var e=this;$.when(c.default.getBookList(this.entry.id,"1","5","cn").then((function(e){return e.data.list.map((function(t,n){e.data.list[n].iCount=n%5})),{total:e.data.totalElements,list:e.data.list}})),c.default.getImageList_painting({itemId:this.entry.id,page:"1",size:"5"}).then((function(e){return{total:e.data.totalElements,list:e.data.list}}))).done((function(t,n){e.data.bookdata=t,e.data.paintingdata=n,e._dealPaintingData(e.data.paintingdata),e._createDom(),e._show(),e.pop.resize()})).fail()}},{key:"_dealPaintingData",value:function(e){var t=this;c.default.getImageList_painting({itemId:this.entry.id,page:"1",size:"40"}).then((function(e){t.imgArr=[],t.total=e.data.totalPages,e.data.list.forEach((function(e,n){t.imgArr.push({mediaId:e.id,originalUrl:e.imageUrl,itemId:e.itemId,type:"painting"})}))}))}},{key:"_show",value:function(){var e=this.data.bookdata,t=this.data.paintingdata;this._appendbooklist(e),this._appendpaintinglist(t),this.$painting=this.$html.find(".content-painting-list"),this.$book=this.$html.find(".content-book-list"),this._loadmoreBook(),this._loadmorePainting()}},{key:"_appendbooklist",value:function(e){var t=this;this.$html.find(".book-list").empty(),e.list.forEach((function(e){var n=void 0;e.infos.forEach((function(e){switch(e.key){case"书籍分类":n=e.text?e.text[0]:null}}));var i=$((0,l.default)({desc:e.desc.trim(),title:e.title,cover:e.cover,author:e.bookAuthor?(0,u.striptags)(e.bookAuthor):"未知",sort:n||"未知",id:e.id,iCount:e.iCount}));t.$html.find(".book-list").append(i),t.$html.find(".book-slide").fadeIn(1500)}))}},{key:"_loadmoreBook",value:function(){var e=this,t=this,n=this.$book.find(".current-num")[0];this.$book.find(".next").on("click",(function(){var i=n.innerText;i<e.data.bookTotalNum&&(i++,n.innerText=i,c.default.getBookList(e.entry.id,i,"5","cn").then((function(e){var n=e.data;t._appendbooklist(n)})))})),this.$book.find(".prev").on("click",(function(){var i=n.innerText;i>1&&(i--,n.innerText=i,c.default.getBookList(e.entry.id,i,"5","cn").then((function(e){var n=e.data;t._appendbooklist(n)})))}))}},{key:"_appendpaintinglist",value:function(e){var t=this;this.$html.find(".painting-list").empty(),e.list.forEach((function(e){var n=$((0,s.default)({url:e.imageUrl+"?h=400",title:e.showTitle||e.title,width:e.width/e.height*400,id:e.id}));t.$html.find(".painting-list").append(n),t.$html.find(".painting-slide").fadeIn(1500)}))}},{key:"_loadmorePainting",value:function(){var e=this,t=this.$painting.find(".current-num")[0];this.$painting.find(".next").on("click",(function(){var n=t.innerText;n<e.data.paintingTotalNum&&(n++,t.innerText=n,c.default.getImageList_painting({itemId:e.entry.id,page:n,size:"5"}).then((function(t){var n=t.data;e._appendpaintinglist(n),e._dealPaintingData(n)})))})),this.$painting.find(" .prev").on("click",(function(){var n=t.innerText;n>1&&(n--,t.innerText=n,c.default.getImageList_painting({itemId:e.entry.id,page:n,size:"5"}).then((function(t){var n=t.data;e._appendpaintinglist(n),e._dealPaintingData(n)})))}))}}]),e}();t.default=m,e.exports=t.default},"5e07":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("8230"));n("561b");var l=n("0280");function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{data:{},onMarkerClick:null,active:!0},t),this._init()}return(0,r.default)(e,[{key:"_init",value:function(){this.$html=$((0,o.default)(this.data)),this.originalUrl=this.$html.find(".recommendpoint-headbox").css("background-image"),this._bind(),this.updateStatus(this.active)}},{key:"_bind",value:function(){var e=this;this.$html.find(".recommendpoint-box,.recommendpoint-tip").on("click",(function(t){t.stopPropagation(),e.$html.addClass("selected"),e.$html.find(".recommendpoint-headbox").addClass((0,l.getMarkerIconNameByTitle)(e.data.title)),e.onMarkerClick(e.data)})),this.$html.find(".recommendpoint-box").on("mouseover",(function(t){e.$html.find(".recommendpoint-tip").addClass("onhover"),e.$html.hasClass("selected")||e.$html.find(".recommendpoint-headbox").addClass((0,l.getMarkerIconNameByTitle)(e.data.title))})),this.$html.find(".recommendpoint-box").on("mouseout",(function(t){e.$html.find(".recommendpoint-tip").removeClass("onhover"),e.$html.hasClass("selected")||e.$html.find(".recommendpoint-headbox").css("background-image",e.originalUrl)}))}},{key:"cancelSelect",value:function(){this.$html.removeClass("selected"),this.$html.find(".recommendpoint-headbox").css("background-image",this.originalUrl)}},{key:"confirmSelect",value:function(){this.$html.addClass("selected"),this.$html.find(".recommendpoint-headbox").addClass((0,l.getMarkerIconNameByTitle)(this.data.title)),this.onMarkerClick(this.data)}},{key:"updateStatus",value:function(e){this.active=e,e?(this.$html.addClass("active"),this.$html.removeClass("inactive")):(this.$html.addClass("inactive"),this.$html.removeClass("active"))}}]),e}();t.default=c,e.exports=t.default},"5ec4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n("3f6b")),a=p(n("8827")),r=p(n("57ba"));n("6444");var o=p(n("013d")),l=p(n("a36d")),s=p(n("d88e")),c=p(n("fe21")),u=p(n("2f20")),d=p(n("e2d7")),m=n("4a87"),h=n("a7c7"),f=n("cffa");function p(e){return e&&e.__esModule?e:{default:e}}var v=["#E0A2A2","#A7BEE0","#EAAE91","#A79DCC","#C99CD6","#AAC9B6","#DBBD88","#DCB39A"],y=function(){function e(t){(0,a.default)(this,e),t.entry,this.data={},(0,i.default)(this.data,{relationList:[],entryID:t.entry.id,entryName:t.entry.name,firstLetter:t.entry.name.slice(0,1),entryAvatar:t.entry.imageUrl,isHuman:t.entry.isHuman}),this.setEntryCompCardsState=t.setEntryCompCardsState,this.activeIndex=0,this.offsetIndex=0,this._createDom(),this._loadData()}return(0,r.default)(e,[{key:"_createDom",value:function(){var e=this;this.pop=new m.PopBox({customContent:!0,$content:$((0,s.default)()),afterClose:function(){e.setEntryCompCardsState&&setTimeout((function(){h.MAB_STATE.update("entryCompCardsState",!1)}),20)}})}},{key:"_loadData",value:function(){var e=this;c.default.getHomeRelation(this.data.entryID,14).then((function(e){var t=[],n=0;for(var i in e.data.relationList){var a=e.data.relationList[i];a.forEach((function(e){e.firstLetter=e.name.slice(0,1)})),t.push({cateName:i,color:v[n++],list:a})}return t.length>7&&t.forEach((function(e,n){"其他"===e.cateName&&t.splice(n,1)})),t.slice(0,7)})).then((function(t){t=t.sort((function(e,t){return t.list.length-e.list.length})),e.data.relationList=t,e.offsetIndex+=t.length,e.$html=$((0,o.default)(e.data)),e.pop.updateContent(e.$html),e._movePos(),e._renderList(),e._bind(),e._hoverRelation()}))}},{key:"_hoverRelation",value:function(){}},{key:"_renderList",value:function(e){var t=this.data.relationList.find((function(t){return t.cateName==e}));if(e||(t=this.data.relationList[0]),t){t.list.forEach((function(e,n){e.delay=.03*n+.3,e.relation=u.default.subStr((0,d.default)(e.relation,"content"),10,!1),e.bg=t.color}));var n=$((0,l.default)({key:e,list:t.list,centerId:this.data.entryID}));this.$html.find(".relation-list").empty().append(n)}}},{key:"_movePos",value:function(){var e=this,t=this.data.relationList.length,n=2*Math.PI/t;this.$html.find(".cate-items li").each((function(t){var i=this,a=(e.offsetIndex-t)*n;this.radian||(this.radian=a),f.TweenLite.to(this,.3,{radian:a,onUpdate:function(e){var t=87*Math.sin(i.radian)+92,n=87*Math.cos(i.radian)+92;$(i).css({top:t,left:n})}})}))}},{key:"_bind",value:function(){var e=this,t=this,n=this.$html.find(".cate-items li");n.eq(0).toggleClass("active",!0),n.click((function(){var e=n.length,i=$(this).attr("data-index")-0,a=$(this).attr("data-name"),r=0;(r=i-t.activeIndex)<0&&(r+=e),t.offsetIndex+=r,t.activeIndex=i,n.toggleClass("active",!1),$(this).toggleClass("active",!0),t._movePos(),t._renderList(a)})),this.$html.off("click.hidePop").on("click.hidePop",(function(t){!$(t.target).hasClass("pop-content")&&$(t.target).parents(".pop-content").length<1&&e.pop.close()}))}}]),e}();t.default=y,e.exports=t.default},"5f72":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=l(n("b12d"));function l(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,active:!0},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$container&&(this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,o.default)({iconClassName:this.data.iconClassName,itemName:this.data.itemName,id:this.data.id})),this.$container.append(this.$html),this._bind())}},{key:"_bind",value:function(){}}]),e}();t.default=s,e.exports=t.default},"60a2":function(e,t,n){},"62fa":function(e,t,n){"use strict";var i=r(n("3f6b")),a=n("49dc");function r(e){return e&&e.__esModule?e:{default:e}}var o=r(n("9fdf")).default.getLang({api:!0});e.exports={getArtilceList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o;return(0,a.getJson)("/api/article/list/"+i+"/"+e+"/"+t+"/"+n)},getDetail:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;return(0,a.getJson)("/api/m/article/w1/n/detail/"+t+"/"+e)},getAudit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;return(0,a.getJson)("/api/user/detail/"+t+"/"+e)},getUgcDetail:function(e){return(0,a.getJson)("/api/article/ugc/v1/y/viewByArticle?articleId="+e)},getUgcAudit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,a.getJson)("/api/article/ugc/v1/y/view?id="+e+"&newest="+t)},getDraft:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,a.getJson)("/api/user/draft/"+e)},getDraftDetail:function(e){return(0,a.getJson)("/api/article/n/draft/"+e)},delete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",itemIds:[]},t=(0,i.default)({language:o},e);return(0,a.postJson)("/api/article/delete",t)},saveArticle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,i.default)({id:""},e);return(0,a.postJson)("/api/article/v1/y/save",t,{once:!0})},saveUgcArticle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return(0,a.postJson)("/api/article/ugc/v1/y/web/edit?createType="+t,e,{once:!0})},saveToDraft:function(e){var t=(0,i.default)({id:"",itemId:"",title:"未命名",content:""},e);return(0,a.postJson)("/api/article/draft",t)},getRecommendArticle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o;return(0,a.postJson)("/api/search/articleRecommend",{keyword:e,page:t,size:n,language:i})},getBookDetail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,a.getJson)("/api/index/book/detail/"+o+"/"+e)},getVolumns:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,a.getJson)("/api/book/index/"+e)},fullTextSearch:function(e){return(e=(0,i.default)({keyword:"",page:1,size:10},e)).keyword&&(e.keyword=e.keyword.substring(0,50)),(0,a.getJson)("/api/search/fullText/all?keyword="+e.keyword+"&page="+e.page+"&size="+e.size)},fullTextSearchDetail:function(e){return(0,a.getJson)("/api/search/fullText/book?keyword="+e.keyword+"&bookId="+e.bookId+"&page="+e.page+"&size="+e.size)},getTopicList:function(e){return(0,a.getJson)("/api/m/post/v1/n/tag/search?"+e)},getUserCircle:function(e){return(0,a.postJson)("/api/m/social/circle/v1/n/circles/joined",{userId:e})},getMatchDetail:function(e){return(0,a.postJson)("/api/article/v1/y/article/innerlink/parse",{content:e})},searchEssence:function(e){return(0,a.getJson)("/api/basicService/essence/n/search?keyword="+e.keyword+"&category="+e.category)},deleteEssence:function(e){return(0,a.postJson)("/api/essence/y/delete",e)},saveArticleV3:function(e){var t=(0,i.default)({id:"",itemId:"",title:"未命名",content:""},e);return(0,a.postJson)("/api/m/article/v3/y/save",t)},getArticleDetailV3:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.getJson)("/api/m/article/v3/n/detail?id="+e+"&withAuditingEssence="+t)},getArticleAudit:function(e){return(0,a.getJson)("/api/m/article/audit/v2/detailByArticleId?articleId="+e)}}},6378:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n("3f6b")),a=m(n("8827")),r=m(n("57ba")),o=m(n("df0e")),l=m(n("e3ca")),s=m(n("fe21")),c=n("2cc3");n("f12e");var u=m(n("2ba3")),d=m(n("944a"));function m(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",active:!0,fold:!0,map:null,recommendId:null,recommendType:"TIME",recommendPage:{TIME:1,LOCATION:1},recommendTotalPages:{TIME:1,LOCATION:1},recommendPageSize:5,emitChangeRecommendList:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){var e=this;this.$container.empty(),this.$html=$((0,o.default)({recommendType:this.recommendType})),this.$container.append(this.$html),this.getRecommend(),this._bind(),setTimeout((function(){e.showComponent()}))}},{key:"_bind",value:function(){var e=this;this.$html.find(".recommend .tab-item").on("click",(function(t){var n=$(t.target).data("id");e.$html.find(".recommend .tab-item").removeClass("selected"),$(t.target).addClass("selected"),e.recommendType=n,e.recommendMarker=null,e.$html.find(".recommend-container .main-list").remove(),e.fold?e.$html.find(".recommend .list-icon").trigger("click"):e.getRecommend()})),this.$html.find(".recommend .list-icon").on("click",(function(t){e.$html.find(".recommend .tab-content").hasClass("inactive")?(e.fold=!1,e.recommendMarker?e.recommendMarker.show():e.getRecommend()):(e.$html.find(".recommend .tab-content").css("height",e.$html.find(".recommend .recommend-container").outerHeight()+36),e.entryCard&&e.entryCard.destroy(),e.recommendMarker&&e.recommendMarker.hide(),e.fold=!0),e.onChangeRecommendState(!e.fold),e.$html.find(".recommend .tab-item").toggleClass("inactive"),e.$html.find(".recommend .list-icon").toggleClass("inactive"),e.$html.find(".recommend .tab-content").toggleClass("inactive"),e.emitChangeRecommendList()})),this.$html.find(".recommend .refresh").on("click",(function(t){e.recommendPage[e.recommendType]=e.recommendPage[e.recommendType]+1>e.recommendTotalPages[e.recommendType]?1:e.recommendPage[e.recommendType]+1,e.getRecommend()}))}},{key:"getRecommendState",value:function(){return!this.fold}},{key:"getRecommend",value:function(){var e=this;this.fold||(this.$html.find(".recommend-container .loading-box").fadeIn(),s.default.getTimeLineSame({id:this.recommendId,type:this.recommendType,page:this.recommendPage[this.recommendType],pageSize:this.recommendPageSize}).then((function(t){if(!t.data)return e.recommendMarker&&e.recommendMarker.removeAll(),void e.$html.find(".recommend-container .main-list").remove();e.recommendTotalPages[e.recommendType]=t.data.totalPages;var i=t.data&&t.data.list||[],a=[];i.map((function(e){var t={id:e.timemapNode.id,itemId:e.timemapNode.itemId,title:e.timemapNode.node.title,location:e.timemapNode.location,locationDesc:e.timemapNode.node.location.desc,geometry:e.timemapNode.node.location.geometry,time:(0,c.timeStantard)(e.timemapNode.node.time),nodeName:e.disambiguation?e.name+"("+e.disambiguation+")":""+e.name,avatar:e.imageResponse||n("fac8"),desc:e.summary,name:e.name,node:{title:e.timemapNode.node.title,desc:e.timemapNode.node.desc,year:e.timemapNode.year,locationDesc:e.timemapNode.node.location.desc,itemId:e.timemapNode.itemId}};a.push(t),e.name=t.name,e.title=t.title}));var r=$((0,l.default)({data:a}));r.find(".main-item").on("click",(function(t){e.recommendMarker.clickMarker(t.currentTarget.dataset.id)})),e.$html.find(".recommend-container .main-list").remove(),e.$html.find(".recommend-container").append(r),e.emitChangeRecommendList(),e.recommendMarker&&e.recommendMarker.removeAll(),e.entryCard&&e.entryCard.destroy(),e.recommendMarker=new u.default({map:e.map,active:!e.fold,onMarkerClick:function(t){t.node.yearDesc||(t.node.yearDesc=(0,c.getYearStrFromNum)(t.node.year)),$(".entry-component").empty();var n=$(".marker-"+t.id),i=n.offset();e.entryCard=new d.default({$container:$(".entry-component"),active:!0,data:t,position:{x:i.left<10?10:i.left+32,y:i.top<10?10:i.top},hideEntryCard:function(t){e.recommendMarker.cancelSelect(t)},onDestroyed:function(t){e.map.off("click.recommend"),e.map.off("move.recommend"),e.recommendMarker.cancelSelect(t)}}),setTimeout((function(){e._updateEntryCardPosition()})),e.map.on("move.recommend",(function(t){var i=n.offset();e.entryCard.updatePosition({x:i.left<10?10:i.left+32,y:i.top<10?10:i.top}),e._updateEntryCardPosition()})),e.map.on("click.recommend",(function(t){e.entryCard.destroy()}))}}),e.recommendMarker.createRecommendMarkers(a)}),(function(t){e.$html.find(".recommend-container .main-list").remove()})).always((function(){e.$html.find(".loading-box").fadeOut(),e.$html.find(".recommend .tab-content").css("height",e.$html.find(".recommend .recommend-container").outerHeight()+36)})))}},{key:"_updateEntryCardPosition",value:function(){var e=$(".entry-component .entry-card-component.active").position();e&&(e.top<10&&(e.top=10),e.left<$(".components-container").outerWidth()+8&&(e.left=$(".components-container").outerWidth()+18),$(".entry-component .entry-card-component.active").css({top:e.top,left:e.left}))}},{key:"getDom",value:function(){return this.$html}},{key:"update",value:function(e){var t=this;this.recommendId!=e&&(this.recommendId=e,this.recommendPage={TIME:1,LOCATION:1},this.recommendTotalPages={TIME:1,LOCATION:1},this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout((function(){t.getRecommend()}),500))}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"destroy",value:function(){this.map.off("click.recommend"),this.recommendMarker&&this.recommendMarker.removeAll()}}]),e}();t.default=h,e.exports=t.default},"638f":function(e,t,n){"use strict";var i=o(n("3f6b")),a=o(n("8827")),r=o(n("57ba"));function o(e){return e&&e.__esModule?e:{default:e}}var l=n("7a49"),s=function(){function e(t,n){if((0,a.default)(this,e),this.routes=t,this.config=(0,i.default)({key:"marble_router",basePath:"",onLoad:function(){}},n),window["_"+this.config.key])throw"Router "+this.config.key+" has been created! Please replace it or change router key";this._setGlobalVal(),this._doChange(),this.bind_a(),this._bind_window()}return(0,r.default)(e,[{key:"bind_a",value:function(){var e=this;document.onclick=function(t){var n=t.target,i=(n.baseURI,n.href);if(n.attributes["marble-a"]){t.preventDefault();var a=i.replace(window.location.origin,"");l.go(a,{key:e.config.key})}}}},{key:"_bind_window",value:function(){var e=this;window.addEventListener("popstate",(function(t){e._doChange()}))}},{key:"_cleanGlobalVal",value:function(){window["_"+this.config.key]={}}},{key:"_setGlobalVal",value:function(){window["_"+this.config.key]||(window["_"+this.config.key]=this)}},{key:"getParams",value:function(){return this.currentRoute.params||{}}},{key:"getQuery",value:function(){return this.currentRoute.query||{}}},{key:"getData",value:function(){return this.currentRoute.data||{}}},{key:"_doChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=window.location,n=t.pathname,i=t.search,a=this._matchPath(n),r={};i&&i.replace("?","").split("&").forEach((function(e){(e=e.split("="))[1]&&(e[1]=e[1].split(",")),r[e[0]]=e[1]})),a.route&&(a.query=r,a.data=e,a.href=window.location.href,this.currentRoute=a,"function"==typeof a.route.onLoad&&a.route.onLoad(a),this.config.onLoad(a))}},{key:"_matchPath",value:function(e){var t=this,n={route:null,params:{}};this.routes.find((function(i){var a=i.path;if((a=t.config.basePath+a)==e)return n.route=i,n;var r="";if("string"==typeof a){r=new RegExp("^"+a.replace(/:[^\/]+/g,"([^/]+)")+"$");var o=a.match(/:\w+/g),l=e.match(r);if(o&&l){var s={};return o.map((function(e,t){s[e.slice(1)]=decodeURIComponent(l[t+1])})),n={route:i,params:s}}}if(a.test){var c=e.match(a);c&&(n={params:c.slice(1),route:a})}return!1}));return n}}]),e}();e.exports=s},6444:function(e,t,n){},6561:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("3f6b")),a=d(n("8827")),r=d(n("57ba")),o=d(n("bc8a")),l=d(n("b54b")),s=d(n("b311")),c=d(n("e088")),u=n("97a7");function d(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",url:"",position:"bottom",useText:!1},t),this._render(),this.bind()}return(0,r.default)(e,[{key:"reposQrcode",value:function(){this.$html.find(".qrcode").offset()}},{key:"_render",value:function(){this.$html=$((0,o.default)({pos:this.position,useText:this.useText})),this.$container.append(this.$html),this.setQRCode()}},{key:"setQRCode",value:function(){var e=this;this.$qrcode=new l.default({onReady:function(){e._generateQrcode()}})}},{key:"_generateQrcode",value:function(){var e=this,t=this.url||window.location.href;t=(0,u.setUrlParams)(t,{from:"PC"}),this.$html.find(".copy-href").attr("data-clipboard-text",t);new s.default(".copy-href");this.$qrcode.QRCode.toCanvas(t,{errorCorrectionLevel:"H",width:120,height:120},(function(t,n){if(t)throw t;e.$html.find("#share-qrcode").append(n)}))}},{key:"bind",value:function(){var e=this;this.$html.find(".copy-href").on("click",(function(){e.alert=new c.default({type:"message",text:"复制成功！",duration:4e3,position:"right-top"})})),this.$html.on("mouseover",(function(){e.reposQrcode(),e.$html.find(".qrcode").addClass("active")})),this.$html.on("mousemove",(function(){e.$html.find(".qrcode").addClass("active")})),this.$html.find(".qrcode").on("mouseover",(function(){e.code&&clearTimeout(e.code),e.$html.find(".qrcode").addClass("active")})),this.$html.find(".qrcode").on("mouseout",(function(){e.$html.find(".qrcode").removeClass("active")})),this.$html.on("mouseout",(function(){e.code=setTimeout((function(){e.$html.find(".qrcode").removeClass("active")}),300)}))}}]),e}();t.default=m,e.exports=t.default},6823:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li class="suggest-normal-li cp"><span class="inline">'+s("function"==typeof(r=null!=(r=c(n,"year")||(null!=t?c(t,"year"):t))?r:l)?r.call(o,{name:"year",hash:{},data:a,loc:{start:{line:3,column:58},end:{line:3,column:66}}}):r)+'</span><span class="ad-or-bc suggest-ad-or-bc">'+s("function"==typeof(r=null!=(r=c(n,"adbc")||(null!=t?c(t,"adbc"):t))?r:l)?r.call(o,{name:"adbc",hash:{},data:a,loc:{start:{line:3,column:113},end:{line:3,column:121}}}):r)+"</span></li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"suggestionArr"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:2},end:{line:4,column:11}}}))?r:""},useData:!0})},"691b":function(e,t,n){"use strict";var i,a=n("1098"),r=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){return e?"object"==(void 0===e?"undefined":(0,r.default)(e))?e.map((function(e){return e.replace(/<\/?[^>]*\/?>/gi,"")})):e.toString().replace(/<\/?[^>]*\/?>/gi,""):e}},"6a51":function(e,t,n){"use strict";var i=k(n("8827")),a=k(n("57ba"));n("4675"),n("bd43");var r=k(n("19c0")),o=n("a8a7"),l=n("3d58"),s=n("0b1f"),c=n("ffc6"),u=k(n("f6b6")),d=n("a7c7"),m=n("098c"),h=n("d99f"),f=k(n("1840")),p=k(n("f1d6")),v=k(n("c90c")),y=k(n("a7c8")),g=k(n("398d"));k(n("7ac4")),k(n("92f5"));function k(e){return e&&e.__esModule?e:{default:e}}window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var b=function(){function e(){(0,i.default)(this,e),this.comps={},this.createMap(),this.createMabState(),this._initPeriodsData(),this._initFiltersData()}return(0,a.default)(e,[{key:"createMap",value:function(){var e=this;this.map=new s.MapGL({timelineUrl:"https://map.allhistory.com/dlsgis/api/timeline?h=1",onReady:function(){e.createCommonComps(),e.createRouter()}}),window.map=this.map}},{key:"createMabState",value:function(){this.mabState=d.MAB_STATE}},{key:"_initPeriodsData",value:function(){(0,m.initPeriods)()}},{key:"_initFiltersData",value:function(){(0,h.initFilterTags)()}},{key:"createCommonComps",value:function(){var e=this;this.comps.timebar=new f.default({startOffset:100,endOffset:100}),this.comps.searchBoxComponent=new p.default({active:!0,handleSelectSug:function(e){switch(e.type){case"book":window.open("/book/detail?id="+e.id);break;case"painting":window.open("/painting/detail?paintingType=alone&paintingId="+e.id);break;case"territory":var t=e.territory.esGeometry.dlsOid,n=btoa(encodeURIComponent(e.name));(0,o.setSessionStorageItem)("map","territoryInfo",e),window.open("/map/detail/territory?id="+t+"&n="+n);break;case"item":case"itemAndTerritory":window.open("/map/detail/"+e.id)}},handleSearchResult:function(t){t=(0,l.htmlEncode)(t),e._navigateToResult(t)}}),this.comps.topRightComponent=new v.default({map:this.map,comps:this.comps}),this.comps.bottomRightComponent=new y.default({map:this.map,comps:this.comps}),this.comps.markersComponent=new g.default({map:this.map})}},{key:"_navigateToResult",value:function(e){if(e.length>0){var t=this.comps.timebar.ruler.getAreaTime(),n=t.start,i=t.end;n=Math.round(n),i=Math.round(i),(0,o.setStorageItem)("timeMapState","timeBarArea",{start:n,end:i})}e.length<1?c.Nav.go("/map",{key:"map-router"}):c.Nav.go("/map/result/"+e,{key:"map-router"})}},{key:"createRouter",value:function(){this.router=new u.default({map:this.map,comps:this.comps})}}]),e}();r.default.getUserInfo().then((function(e){window.userInfo=e.data})).always((function(e){new b}))},"6ad37":function(e,t,n){},"6b8a":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="dls-map-time-bar"></div>'},useData:!0})},"6e9c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("3f6b")),a=d(n("8827")),r=d(n("57ba")),o=d(n("812d"));n("60a2");var l=d(n("1e9f")),s=d(n("39f3")),c=d(n("9fdf")),u=d(n("09d4"));function d(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t){(0,a.default)(this,e),this.langOptions=[{name:"中文",icon:"icon-flag-zh",value:"zh"},{name:"English",icon:"icon-flag-en",value:"en"},{name:"français",icon:"icon-flag-fr",value:"fr"},{name:"español",icon:"icon-flag-es",value:"es"},{name:"日本語",icon:"icon-flag-jp",value:"jp"}],(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,show:!0,langs:["zh","en","fr","es","jp"],onSwitchLang:!1,onDestroyed:function(){}},t),this.cookie=(0,l.default)(window),this.langs&&this.langs.indexOf("cn")>-1&&this.langs.push("zh"),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$container&&(this.$html=$((0,o.default)({show:this.show})),this.emptyBeforeAppend&&this.$container.empty(),this.$container.append(this.$html),this._appendChild(),this._bind())}},{key:"_appendChild",value:function(){var e=this,t=c.default.getLang(),n=this.langOptions.find((function(e){return e.value===t}));this.langs&&this.langOptions.forEach((function(t){e.langs.indexOf(t.value)<0&&(t.disabled="disabled")})),this.selectList=new s.default({$container:this.$html,value:n,items:this.langOptions,onToggleList:function(t){t?e.$html.addClass("open"):e.$html.removeClass("open")},onSelect:function(t){e.switchLang(t.value)}})}},{key:"switchLang",value:function(e){var t=void 0,n=c.default.getLang({lang:e,api:!0});this.onSwitchLang&&this.onSwitchLang(e);try{t=window.entryDetail.global[n]}catch(e){}(0,u.default)(e,[t])}},{key:"_bind",value:function(){}},{key:"showComponent",value:function(){this.show=!0,this.$html.removeClass("active")}},{key:"hideComponent",value:function(){this.show=!1,this.$html.addClass("active")}},{key:"destroy",value:function(){this.$container&&(this.$container.empty(),this.onDestroyed())}}]),e}();t.default=m,e.exports=t.default},"714f":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <div class="content-book-list">\n        <div class="letter-title">文学('+s("function"==typeof(r=null!=(r=c(n,"bookTotal")||(null!=t?c(t,"bookTotal"):t))?r:l)?r.call(o,{name:"bookTotal",hash:{},data:a,loc:{start:{line:6,column:37},end:{line:6,column:50}}}):r)+')</div>\n        <div class="pagination">\n          <div class="prev"></div>\n          <div class="num">\n            <span class="current-num">'+s("function"==typeof(r=null!=(r=c(n,"bookPresentNum")||(null!=t?c(t,"bookPresentNum"):t))?r:l)?r.call(o,{name:"bookPresentNum",hash:{},data:a,loc:{start:{line:10,column:38},end:{line:10,column:56}}}):r)+'</span>/<span class="total">'+s("function"==typeof(r=null!=(r=c(n,"bookTotalNum")||(null!=t?c(t,"bookTotalNum"):t))?r:l)?r.call(o,{name:"bookTotalNum",hash:{},data:a,loc:{start:{line:10,column:84},end:{line:10,column:100}}}):r)+'</span>\n          </div>\n          <div class="next"></div>\n        </div>\n        <div class="book-list">\n\n        </div>\n      </div>\n'},3:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <div class="content-painting-list">\n        <div class="art-title">艺术('+s("function"==typeof(r=null!=(r=c(n,"paintingTotal")||(null!=t?c(t,"paintingTotal"):t))?r:l)?r.call(o,{name:"paintingTotal",hash:{},data:a,loc:{start:{line:22,column:34},end:{line:22,column:51}}}):r)+')</div>\n        <div class="pagination">\n          <div class="prev"></div>\n          <div class="num">\n            <span class="current-num">'+s("function"==typeof(r=null!=(r=c(n,"paintingPresentNum")||(null!=t?c(t,"paintingPresentNum"):t))?r:l)?r.call(o,{name:"paintingPresentNum",hash:{},data:a,loc:{start:{line:26,column:38},end:{line:26,column:60}}}):r)+'</span>/<span class="total">'+s("function"==typeof(r=null!=(r=c(n,"paintingTotalNum")||(null!=t?c(t,"paintingTotalNum"):t))?r:l)?r.call(o,{name:"paintingTotalNum",hash:{},data:a,loc:{start:{line:26,column:88},end:{line:26,column:108}}}):r)+'</span>\n          </div>\n          <div class="next"></div>\n        </div>\n        <div class="painting-list">\n\n        </div>\n      </div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="page-comp-product">  \n  <div class="mainer">\n'+(null!=(r=l(n,"if").call(o,null!=t?l(t,"bookTotalNum"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:4},end:{line:18,column:11}}}))?r:"")+(null!=(r=l(n,"if").call(o,null!=t?l(t,"paintingTotalNum"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:20,column:4},end:{line:34,column:11}}}))?r:"")+"  </div>\n</div>"},useData:!0})},"74a71":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="markers-component '+(null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"active"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:30},end:{line:1,column:57}}}))?r:"")+'">\n  <div class="recommend-container"></div>\n</div>'},useData:!0})},7524:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n("adf5")),a=f(n("9b57")),r=f(n("3f6b")),o=f(n("8827")),l=f(n("57ba")),s=f(n("f0a3")),c=f(n("6823"));n("9847");var u=f(n("b7f5")),d=f(n("e088")),m=n("a8a7"),h=n("a7c7");function f(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){var n=this;(0,o.default)(this,e),(0,r.default)(this,{$container:$("body"),map:{},comps:{},listShow:!1,currentYear:1949,currentAdbc:" ",showHistoryMapFlag:"true"===(0,m.getStorageItem)("timemap","showHistoryMap","true"),yearArr:[],isMapYearClose:!1},t),this.enterFlag=!1,this.yearArr=[].concat((0,a.default)(this.map.availableYears)),this.map.onYearChange.push(this.onYearChange.bind(this),this.shouldShowHistoryMap.bind(this,!0)),this.map.onStopSetMapYear.push({name:"toggleMapYear",fn:function(e){n.shouldShowHistoryMap(!1)}}),this.dealYearArr(),this._render(),this.showHistoryMap()}return(0,l.default)(e,[{key:"onYearChange",value:function(e){this.showHistoryMapFlag||this.map.hideYears();var t=e,n=" ";e<0&&(n="BC")&&(t=-e),this.currentYear=e,this.currentAdbc=n,this.$html.find(".his-map-year-num").html(t),this.$html.find(".year-end").html(n),this.$html.find(".user-select-year").val(e)}},{key:"shouldShowHistoryMap",value:function(e){this.showHistoryMapFlag&&(e?(this.isMapYearClose=!1,this.$html.find(".close-history-map").hide(),this.listShow||this.$html.find(".his-map-year").show()):(this.isMapYearClose=!0,this.map.hideYears(),this.$html.find(".his-map-year").hide(),this.$html.find(".close-history-map").show()))}},{key:"_render",value:function(){this.$html=$((0,s.default)({useYearArr:this.useYearArr,currentYear:this.currentYear,currentAdbc:this.currentAdbc})),this.$container.append(this.$html),new u.default(this.$html.find(".down-list-ul")[0],{minScrollbarLength:42}),this._bind()}},{key:"showHistoryMap",value:function(e){if(this.showHistoryMapFlag){var t=parseInt(this.$html.find(".his-map-year-num")[0].innerText),n=this.$html.find(".year-end")[0].innerText;this.$html.find(".down-list-ul").removeClass("close"),"BC"===n&&(t=-t),this.map.setYear(t)}else!e&&(this.$html.find("#show")[0].checked=!1),this.map.hideYears(),this.blurEvent&&clearTimeout(this.blurEvent),this.$html.find(".his-map-year").hide(),this.$html.find(".close-history-map").show(),this.$html.find(".down-list-ul").addClass("close")}},{key:"_scrollItemList",value:function(){var e=this,t=(0,i.default)(this.$html.find(".down-list-ul").find(".normal-li")),n=parseInt(this.$html.find(".user-select-year").val()),a=" ";n<0&&(a="BC"),n<0&&(n=-n);var r=0;t.forEach((function(t,i){var o=$(t).find(".inline")[0].innerText,l=$(t).find(".ad-or-bc")[0].innerText;if(o==n&&l==a)return r=$(t)[0].offsetTop,void e.$html.find(".down-list-ul").scrollTop(r)}))}},{key:"dealYearArr",value:function(){var e=this;this.currentYear<0&&(this.currentAdbc="BC",this.currentYear=-this.currentYear),this.useYearArr=[],this.yearArr.forEach((function(t){var n=t<0?{year:0-parseInt(t),adbc:"BC"}:{year:t,adbc:" "};e.useYearArr.push(n)}))}},{key:"_enterChangeMap",value:function(e){var t=this,n=parseInt(this.$html.find(".user-select-year").val()),i=!1,a=" ",r=n;n<0&&(a="BC"),n<0&&(r=-n),this.yearArr.forEach((function(o,l){o==n&&(i=!0,t.$html.find(".suggest-down-list-ul").hide(),t.$html.find(".down-list").removeClass("open-suggest"),t.$html.find(".down-list").removeClass("open"),t.$html.find(".down-list-ul").show(),t.map.hideYears(),t.map.setYear(n),t.showList(e),t.setYears({val:r,adbc:a,trueVal:n}),t.enterFlag=!0)})),i||(this.alert=new d.default({type:"error",text:_L_("NoMapOfThisYear","timemap"),duration:2e3,position:"center-top"}),this.$html.find(".selected-input-name").val(this.currentYear),this.$html.find(".select-sug-item").hide(),this.$html.find(".select-list").hide())}},{key:"_renderSugList",value:function(e){this.$html.find(".down-list-ul").hide(),this.$html.find(".suggest-down-list-ul").show(),this.$html.find(".down-list").addClass("open-suggest"),this.$sughtml=$((0,c.default)({suggestionArr:e})),this.$html.find(".suggest-down-list-ul").html(this.$sughtml),this._bindSugSelect()}},{key:"_bindSugSelect",value:function(){var e=this;this.$html.find(".suggest-normal-li").on("click",(function(t){var n=parseInt($(t.currentTarget).find(".inline")[0].innerText),i=$(t.currentTarget).find(".inline")[0].innerText,a=$(t.currentTarget).find(".ad-or-bc")[0].innerText;"BC"===a&&(n=-n),e.map.hideYears(),e.map.setYear(n),e.setYears({val:i,adbc:a,trueVal:n}),e.showList(),e.$html.find(".suggest-down-list-ul").hide(),e.$html.find(".down-list").removeClass("open-suggest"),e.$html.find(".down-list-ul").show()}))}},{key:"_getSuggestion",value:function(){var e=this,t=this.$html.find(".user-select-year").val(),n=[],i=this.yearArr.indexOf(t);if(i>-1)n=this.getSomeInArray(this.yearArr,i,5);else{var a=[];this.yearArr.forEach((function(i,r){(i+"").startsWith(t)&&n.push(i),(i<parseInt(t)&&e.yearArr[r+1]>parseInt(t)||i>parseInt(t)&&e.yearArr[r+1]<parseInt(t))&&(a=e.getSomeInArray(e.yearArr,r,5))})),0===n.length&&(n=a),0===n.length&&(parseInt(t)<this.yearArr[0]?n=this.yearArr.slice(0,5):parseInt(t)>this.yearArr[this.yearArr.length-1]&&(n=this.yearArr.slice(this.yearArr.length-5,this.yearArr.length)))}n=n.slice(0,5);var r=[];return n.forEach((function(e,t){var n={year:e,adbc:" "};e<0&&(n.year=0-parseInt(n.year),n.adbc="BC"),r.push(n)})),r}},{key:"getSomeInArray",value:function(e,t,n){if(e.length<=n)return e;var i=e.length,a=Math.floor((n-1)/2),r=n-1-a;a>t&&(r=n-1-(a=t)),r>=i-t&&(a=n-(r=i-t-1)-1);var o=[];return o.concat(e.slice(t-a,t),e[t],e.slice(t+1,t+1+r)),o}},{key:"listenInputKeyup",value:function(e){if(13!==e.keyCode){var t=this.$html.find(".user-select-year").val(),n=t.match(/^-?[1-9][0-9]*\d*$/),i=t.match(/-?/);null==n?i&&1==i[0].length&&1==i.input.length?e.target.value="-":e.target.value="":e.target.value=n[0];var a=this._getSuggestion();this._renderSugList(a)}else this._enterChangeMap(e)}},{key:"inputLostFocus",value:function(){this.$html.find(".his-map-year").show(),this.$html.find(".user-select-year").hide()}},{key:"showListInput",value:function(){var e=this;this.blurEvent=setTimeout((function(){e.showList()}),400)}},{key:"showList",value:function(e){if(!e||"user-select-year"!==e.target.className||13===e.keyCode)if(this.enterFlag)this.enterFlag=!1;else{if(this.isMapYearClose&&this.$html.find(".close-history-map").hide(),this.enterFlag=!1,this.blurEvent&&clearTimeout(this.blurEvent),this.listShow)this.$html.find(".down-list").removeClass("open"),this.$html.find(".down-list").removeClass("open-suggest"),this.$html.find(".list-icon").removeClass("to-up"),this.showHistoryMapFlag&&(this.$html.find(".user-select-year").hide(),this.isMapYearClose?(this.$html.find(".his-map-year").hide(),this.$html.find(".close-history-map").show()):(this.$html.find(".his-map-year").show(),this.$html.find(".his-map-year").focus()));else{this.showHistoryMapFlag?(this.$html.find(".his-map-year").hide(),this.$html.find(".user-select-year").show(),this.$html.find(".user-select-year").focus()):this.$html.find(".close-history-map").show();var t=parseInt(this.$html.find(".his-map-year-num")[0].innerText);if("BC"===this.$html.find(".year-end")[0].innerText&&(t="-"+t),this.$html.find(".user-select-year").val(t),this.$html.find(".down-list").addClass("open"),this.$html.find(".list-icon").addClass("to-up"),"none"===this.$html.find(".suggest-down-list-ul").css("display"))this._scrollItemList();else{var n=this._getSuggestion();this._renderSugList(n)}}this.listShow=!this.listShow}}},{key:"_bind",value:function(){this.$html.find(".select-year").on("click",this.showList.bind(this)),this.$html.find(".choose-label").on("click",this.showHisMap.bind(this)),this.$html.find(".normal-li").on("click",this.yearSelect.bind(this)),this.$html.find(".suggestion-li").on("click",this.yearSelect.bind(this)),this.$html.find(".user-select-year").on("blur",this.showListInput.bind(this)),this.$html.find(".user-select-year").on("keyup",this.listenInputKeyup.bind(this)),$("body").on("click",this.clickOthers.bind(this)),this.map.on("click.select",this.clickMap.bind(this)),this.$html.find(".user-select-year").on("focus",(function(){h.MAB_STATE.update("isFocusMapYearInput",!0)})),this.$html.find(".user-select-year").on("blur",(function(){h.MAB_STATE.update("isFocusMapYearInput",!1)}))}},{key:"clickMap",value:function(){this.$html.find(".down-list").removeClass("open"),this.$html.find(".down-list").removeClass("open-suggest"),this.listShow=!1,this.$html.find(".list-icon").removeClass("to-up"),this.$html.find(".user-select-year").hide(),this.isMapYearClose?this.$html.find(".close-history-map").show():(this.$html.find(".his-map-year").show(),this.$html.find(".his-map-year").focus())}},{key:"clickOthers",value:function(e){var t=$(e.target);"his-map-year-num"!==e.target.className&&e.target.className.indexOf&&e.target.className.indexOf("list-icon")<0&&t.parents(".down-list").length<1&&t.parents(".select-year").length<1&&(this.blurEvent&&clearTimeout(this.blurEvent),this.listShow=!1,this.$html.find(".down-list").removeClass("open"),this.$html.find(".down-list").removeClass("open-suggest"),this.$html.find(".list-icon").removeClass("to-up"),this.$html.find(".down-list-ul").show(),this.$html.find(".suggest-down-list-ul").hide(),this.$html.find(".user-select-year").hide(),this.showHistoryMapFlag?this.isMapYearClose?this.$html.find(".close-history-map").show():(this.$html.find(".his-map-year").show(),this.$html.find(".his-map-year").focus()):this.$html.find(".his-map-year").hide())}},{key:"showHisMap",value:function(e){this.$html.find("#show")[0].checked?(this.showHistoryMapFlag=!1,(0,m.setStorageItem)("timemap","showHistoryMap","false"),this.showHistoryMap(!0),this.$html.find(".his-map-year").hide(),this.$html.find(".user-select-year").hide()):(this.showHistoryMapFlag=!0,this.showHistoryMap(!0),this.listShow&&(this.$html.find(".close-history-map").hide(),this.$html.find(".his-map-year").hide(),this.$html.find(".user-select-year").show(),this.$html.find(".user-select-year").focus()),(0,m.setStorageItem)("timemap","showHistoryMap","true"))}},{key:"setIfShowMap",value:function(){}},{key:"yearSelect",value:function(e){var t=parseInt($(e.currentTarget).find(".inline")[0].innerText),n=$(e.currentTarget).find(".inline")[0].innerText,i=$(e.currentTarget).find(".ad-or-bc")[0].innerText;"BC"===i&&(t=-t),this.$html.find(".down-list-ul").show(),this.$html.find(".suggest-down-list-ul").hide(),this.$html.find(".down-list").removeClass("open-suggest"),this.showHistoryMapFlag&&(this.map.hideYears(),this.map.setYear(t),this.setYears({val:n,adbc:i}),this.showList())}},{key:"setYears",value:function(e){var t=e.val,n=e.adbc,i=e.trueVal;i||("BC"===n&&(i=-parseInt(t)),""===n&&(i=parseInt(t))),!t&&i&&(i>0&&(n="")&&(t=i),i<0&&(n="BC")&&(t=-i)),this.$html.find(".his-map-year-num").html(t),this.$html.find(".year-end").html(n),this.$html.find(".user-select-year").val(i),this.timeBar=this.comps.timebar.ruler;var a=this.timeBar.getAreaTime();this.midTime=a.end-a.start,a.end=parseInt(i),a.start=a.end-this.midTime,"point"===this.comps.timebar.type?this.timeBar.setCenterByTime(parseInt(i),.3,!1):this.timeBar.setTimeByOffset(a.start,a.end,.3,!1)}}]),e}();t.default=p,e.exports=t.default},7544:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o,l=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="switch-box '+(null!=(r=s(n,"if").call(l,null!=t?s(t,"status"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:23},end:{line:1,column:50}}}))?r:"")+'">\n    <div class="switch-text">'+e.escapeExpression("function"==typeof(o=null!=(o=s(n,"title")||(null!=t?s(t,"title"):t))?o:e.hooks.helperMissing)?o.call(l,{name:"title",hash:{},data:a,loc:{start:{line:2,column:29},end:{line:2,column:38}}}):o)+'</div>\n    <div class="switch-btn-container">\n        <div class="switch-btn"></div>\n    </div>\n</div>'},useData:!0})},7586:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"marker-"+e.escapeExpression(e.lambda(null!=t?r(t,"id"):t,t))+" "},3:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <li class="node-info" data-id=\''+c(s(null!=t?d(t,"id"):t,t))+'\'>\n                <div class="node-name">'+c(s(null!=t?d(t,"name"):t,t))+'</div>\n                <div class="node-time" title="'+(null!=(l=a(n("fcbf")).call(u,null!=t?d(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:11,column:46},end:{line:11,column:71}}}))?l:"")+'">'+(null!=(l=a(n("fcbf")).call(u,null!=t?d(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:11,column:73},end:{line:11,column:97}}}))?l:"")+"</div>\n            </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="multi-markers">\n    <div class="multi-marker-point">\n        <div class="multi-marker-point-pin node-icon '+(null!=(r=l(n,"each").call(o,null!=t?l(t,"data"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:53},end:{line:3,column:90}}}))?r:"")+'">\n        </div>\n        <div class="multi-marker-point-count"></div>\n    </div>\n    <ul class="multi-marker-list list-'+e.escapeExpression(e.lambda(null!=(r=null!=t?l(t,"data"):t)?l(r,"length"):r,t))+'">\n'+(null!=(r=l(n,"each").call(o,null!=t?l(t,"data"):t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:8,column:8},end:{line:13,column:17}}}))?r:"")+"    </ul>\n</div>"},useData:!0})},7675:function(e,t,n){e.exports={default:n("8f5f"),__esModule:!0}},"7a49":function(e,t,n){"use strict";var i=r(n("1907")),a=r(n("3f6b"));function r(e){return e&&e.__esModule?e:{default:e}}e.exports={go:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=(0,a.default)({key:"marble_router",replace:!1},t);var n=this._getRouter(t.key);t.replace?window.history.replaceState("","",e):window.history.pushState("","",e),n._doChange()},back:function(){window.history.go(-1)},getParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"marble_router",t=this._getRouter(e);return t.currentRoute.params._length=(0,i.default)(t.currentRoute.params).length,t.currentRoute.params},getQuery:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"marble_router",t=this._getRouter(e);return t.currentRoute.query},getData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"marble_router",t=this._getRouter(e);return t.currentRoute.data},_getRouter:function(e){var t=window["_"+e];if(!t)throw"Router "+e+" not found!";return t}}},"7bc1":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,i,a,r){var o,l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div class="base-info baseInfo">\n          <div class="title">'+e.escapeExpression(e.lambda(null!=(o=null!=t?s(t,"info"):t)?s(o,"name"):o,t))+'</div>\n        </div>\n        <div class="desc-box descBox">\n          <div class="desc territoryDesc">\n            '+(null!=(o=(l=n("fcbf"),l&&(l.__esModule?l.default:l)).call(null!=t?t:e.nullContext||{},null!=(o=null!=t?s(t,"info"):t)?s(o,"summary"):o,"content",{name:"xss",hash:{},data:r,loc:{start:{line:13,column:12},end:{line:13,column:44}}}))?o:"")+"\n          </div>\n        </div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="territory-component territoryComponent '+(null!=(r=l(n,"if").call(o,null!=t?l(t,"active"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:51},end:{line:1,column:78}}}))?r:"")+'">\n  <div class="territory-box">\n    <div class="close-icon closeIcon">\n    </div>\n    <div class="territory-wrap territoryWrap">\n'+(null!=(r=l(n,"if").call(o,null!=t?l(t,"info"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:6,column:6},end:{line:16,column:13}}}))?r:"")+"    </div>\n  </div>\n</div>"},useData:!0})},"812d":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="languages-component '+(null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"show"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:32},end:{line:1,column:57}}}))?r:"")+'">\n\n</div>\n'},useData:!0})},8171:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,i,a,r){var o,l,s=e.lambda,c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="timebar-marker-item" data-time="'+c(s(null!=t?u(t,"time"):t,t))+'" data-index="'+c(s(null!=t?u(t,"index"):t,t))+'">\n    <div class="timebar-marker-item-content">\n        '+(null!=(o=(l=n("89ec"),l&&(l.__esModule?l.default:l)).call(null!=t?t:e.nullContext||{},null!=t?u(t,"title"):t,!1,{name:"htmlparser",hash:{},data:r,loc:{start:{line:3,column:8},end:{line:3,column:36}}}))?o:"")+'\n    </div>\n    <div class="timebar-marker-item-arrow">\n        \n    </div>\n</div>'},useData:!0})},"81b1":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("7586"));n("ee9f");var l=n("0280");function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{data:{},onMarkerClick:null,active:!0},t),this._init()}return(0,r.default)(e,[{key:"_init",value:function(){this.$html=$((0,o.default)({data:this.data})),this.originalUrl=this.$html.find(".multi-marker-point-pin").css("background-image"),this._bind(),this.updateStatus(this.active)}},{key:"_bind",value:function(){var e=this;this.$html.find(".node-info").on("click",(function(t){t.stopPropagation(),e.$html.find(".node-info").removeClass("selected"),$(t.currentTarget).addClass("selected");for(var n=0;n<e.data.length;n++)if(t.currentTarget.dataset.id==e.data[n].id)return e.$html.addClass("selected"),e.$html.find(".multi-marker-point-pin").addClass((0,l.getMarkerIconNameByTitle)(e.data[0].title)),void e.onMarkerClick(e.data[n])})),this.$html.on("mouseover",(function(t){e.$html.hasClass("selected")||e.$html.find(".multi-marker-point-pin").addClass((0,l.getMarkerIconNameByTitle)(e.data[0].title))})),this.$html.on("mouseout",(function(t){e.$html.hasClass("selected")||e.$html.find(".multi-marker-point-pin").css("background-image",e.originalUrl)}))}},{key:"cancelSelect",value:function(){this.$html.removeClass("selected"),this.$html.find(".node-info").removeClass("selected"),this.$html.find(".multi-marker-point-pin").css("background-image",this.originalUrl)}},{key:"confirmSelect",value:function(e){var t=this.$html.find(".node-info");t.removeClass("selected");for(var n=0;n<this.data.length;n++)if(e==this.data[n].id)return this.$html.addClass("selected"),Array.prototype.forEach.call(t,(function(t){t.dataset.id==e&&$(t).addClass("selected")})),this.$html.find(".multi-marker-point-pin").addClass((0,l.getMarkerIconNameByTitle)(this.data[n].title)),void this.onMarkerClick(this.data[n])}},{key:"updateStatus",value:function(e){this.active=e,e?(this.$html.addClass("active"),this.$html.removeClass("inactive")):(this.$html.addClass("inactive"),this.$html.removeClass("active"))}}]),e}();t.default=c,e.exports=t.default},8230:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tip-title" title="'+(null!=(l=a(n("fcbf")).call(s,null!=t?c(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:7,column:51},end:{line:7,column:76}}}))?l:"")+'" >'+(null!=(l=a(n("fcbf")).call(s,null!=t?c(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:7,column:79},end:{line:7,column:104}}}))?l:"")+"</div>"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lambda,l=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="recommendpoint-wrapper">\n    <div class="recommendpoint-box">\n        <div class="recommendpoint-headbox node-icon marker-'+l(o(null!=t?s(t,"id"):t,t))+"\" data-id='"+l(o(null!=t?s(t,"id"):t,t))+'\'></div>\n    </div>\n    <div class="recommendpoint-tip">\n        <div class="tip-name">'+l(o(null!=t?s(t,"name"):t,t))+"</div>\n        "+(null!=(r=s(n,"if").call(null!=t?t:e.nullContext||{},null!=t?s(t,"title"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:8},end:{line:7,column:117}}}))?r:"")+"\n    </div>\n</div>"},useData:!0})},"831b":function(e,t,n){},8336:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li class="regime-li regimeLi regime-item'+s("function"==typeof(r=null!=(r=c(n,"oid")||(null!=t?c(t,"oid"):t))?r:l)?r.call(o,{name:"oid",hash:{},data:a,loc:{start:{line:5,column:45},end:{line:5,column:52}}}):r)+'" data-idx="'+s("function"==typeof(r=null!=(r=c(n,"oid")||(null!=t?c(t,"oid"):t))?r:l)?r.call(o,{name:"oid",hash:{},data:a,loc:{start:{line:5,column:64},end:{line:5,column:71}}}):r)+'">\n      '+s("function"==typeof(r=null!=(r=c(n,"title")||(null!=t?c(t,"title"):t))?r:l)?r.call(o,{name:"title",hash:{},data:a,loc:{start:{line:6,column:6},end:{line:6,column:15}}}):r)+"\n    </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="regime-ul-component regimeUl '+(null!=(r=l(n,"if").call(o,null!=t?l(t,"active"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:41},end:{line:1,column:68}}}))?r:"")+'">\n  <ul class="regimes-marker-comps" id="regimesMarkerComps">\n'+(null!=(r=l(n,"each").call(o,null!=t?l(t,"regimes"):t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:4},end:{line:8,column:13}}}))?r:"")+"  </ul>\n</div>\n"},useData:!0})},8445:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=window.location.hash,t=e.match(/^#\/(detail|detailindex)\/(\w+)(\/(\w+))?/);if(!t){var n=(0,i.getUrlQueryMessage)(),a=n.id,r=n.nodeId,o=n._ua_,l=n.vId;if(!(a&&r&&o)){var s=e.match(/^#\/mapUgc\/(\w+)/);if(s){var c=s[1];if(!c)return;var u="edit/item/"+c+(l?"#vId="+l:"");window.location.replace(u)}else{var d=e.match(/^#\/itemNodeEdit\/(\w+)(\/(\w+))?/);if(d){var m=d[1],h=d[3];if(!m)return;var f="edit/item-node/"+m+"/"+(h||"")+(l?"#vId="+l:"");window.location.replace(f)}}return}var p="map/detail/"+a+"/"+r+"?_ua_="+o;window.location.replace(p)}var v=t[2],y=t[4],g="/";(v||y)&&(v&&(g+="map/detail/"+v),y&&(g+="/"+y),window.location.href.indexOf("_ua_=iframe")>=0&&(g=(0,i.setUrlParam)(g,{_ua_:"iframe"})),window.location.replace(g))};var i=n("97a7");e.exports=t.default},8663:function(e,t,n){var i=n("63b6");i(i.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},"86be":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("facf")),l=n("098c");function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{active:!0,emptyBeforeAppend:!0,showCloseBtn:!1,selectPeriod:function(){}},t),this.periods=(0,l.getPeriods)(),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$container&&(this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,o.default)({active:this.active,periods:this.periods,showCloseBtn:this.showCloseBtn})),this.$container.append(this.$html),this._bind())}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".periodItem",(function(t){var n=$(t.currentTarget).data("period-id");e.selectPeriod(""+n),e.hideComponent()})),this.$html.on("click",".closeBtn",(function(t){e.hideComponent()}))}},{key:"showComponent",value:function(){var e=this;this.active=!0,this.$html.addClass("active"),setTimeout((function(){e.$html.find(".periods-block").addClass("active")}))}},{key:"hideComponent",value:function(){var e=this;this.$html.find(".periods-block").removeClass("active"),setTimeout((function(){e.active=!1,e.$html.removeClass("active")}),200)}},{key:"update",value:function(e){(0,i.default)(this,e),this._render(),this.showComponent()}},{key:"destroy",value:function(){this.$container&&this.$container.empty(),this.onDestroyed()}}]),e}();t.default=c,e.exports=t.default},"893f":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <img src="'+e.escapeExpression(e.lambda(null!=(r=null!=t?o(t,"info"):t)?o(r,"imageResponse"):r,t))+'" width="44" height="44" alt="">\n'},5:function(e,t,i,a,r){return'                <img class="default-img" src="'+n("fac8")+'" width="44" height="44" alt="">\n'},7:function(e,t,n,i,a){return""},9:function(e,t,n,i,a){return"visibility:hidden"},11:function(e,t,i,r,o,l,s){var c,u=e.lambda,d=e.escapeExpression,m=null!=t?t:e.nullContext||{},h=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <div class="node-info node-info-'+d(u(null!=t?h(t,"index"):t,t))+'" data-id='+d(u(null!=t?h(t,"index"):t,t))+'>\n                    <div class="node-desc">\n                        <div class="node-title" data-id='+d(u(null!=t?h(t,"index"):t,t))+">\n                            "+(null!=(c=a(n("fcbf")).call(m,null!=(c=null!=t?h(t,"node"):t)?h(c,"title"):c,"title",{name:"xss",hash:{},data:o,loc:{start:{line:35,column:28},end:{line:35,column:56}}}))?c:"")+'\n                            <i class="edit-icon" data-nodeid='+d(u(null!=t?h(t,"id"):t,t))+'></i>\n                        </div>\n                        <div class="node-time">\n                            '+d(u(null!=(c=null!=t?h(t,"node"):t)?h(c,"standardTime"):c,t))+" "+d(u(null!=(c=null!=(c=null!=t?h(t,"node"):t)?h(c,"location"):c)?h(c,"desc"):c,t))+'\n                        </div>\n                    </div>\n                    <div class="node-detail nodeDetail">\n                        '+(null!=(c=a(n("fcbf")).call(m,null!=(c=null!=t?h(t,"node"):t)?h(c,"desc"):c,"content","true",{name:"xss",hash:{},data:o,loc:{start:{line:43,column:24},end:{line:43,column:60}}}))?c:"")+"\n"+(null!=(c=h(i,"each").call(m,null!=t?h(t,"images"):t,{name:"each",hash:{},fn:e.program(12,o,0,l,s),inverse:e.noop,data:o,loc:{start:{line:44,column:24},end:{line:49,column:33}}}))?c:"")+"                    </div>\n                </div>\n"},12:function(e,t,n,i,a,r,o){var l=e.lambda,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                        <div class="node-img-wrapper">\n                            <img class="node-img" data-index='+s(l(e.data(a,1)&&c(e.data(a,1),"index"),t))+' data-imgurl="'+s(l(null!=t?c(t,"originalUrl"):t,t))+'" src="'+s(l(null!=t?c(t,"originalUrl"):t,t))+'" title="'+s(l(null!=t?c(t,"title"):t,t))+'">\n                        </div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o,l,s){var c,u=null!=t?t:e.nullContext||{},d=e.escapeExpression,m=e.lambda,h=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="detail-page detailPage">\n    <div class="components-container '+(null!=(c=h(i,"if").call(u,null!=t?h(t,"active"):t,{name:"if",hash:{},fn:e.program(1,o,0,l,s),inverse:e.noop,data:o,loc:{start:{line:2,column:37},end:{line:2,column:64}}}))?c:"")+' ">\n        <div class="detail-top-nav">\n            '+d(a(n("dfab")).call(u,"ReturnNodeInformationList","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:4,column:12},end:{line:4,column:58}}}))+'\n        </div>\n        <div class="detail-top-header">\n            <div class="left-info">\n'+(null!=(c=h(i,"if").call(u,null!=(c=null!=t?h(t,"info"):t)?h(c,"imageResponse"):c,{name:"if",hash:{},fn:e.program(3,o,0,l,s),inverse:e.program(5,o,0,l,s),data:o,loc:{start:{line:8,column:16},end:{line:12,column:23}}}))?c:"")+'            </div>\n            <div class="right-info">\n                <div class="right-info-name">'+d(m(null!=(c=null!=t?h(t,"info"):t)?h(c,"name"):c,t))+'</div>\n                <div class="right-info-type">'+d(m(null!=(c=null!=t?h(t,"info"):t)?h(c,"disambiguation"):c,t))+'</div>\n            </div>\n            <div class="share-wrapper"></div>\n        </div>\n        <div class="life-line inactive" style="'+(null!=(c=h(i,"if").call(u,null!=(c=null!=t?h(t,"info"):t)?h(c,"showLife"):c,{name:"if",hash:{},fn:e.program(7,o,0,l,s),inverse:e.program(9,o,0,l,s),data:o,loc:{start:{line:20,column:47},end:{line:20,column:100}}}))?c:"")+'">\n            <div class="birth-year">'+d(a(n("dfab")).call(u,"age","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:21,column:36},end:{line:21,column:60}}}))+' 0</div>\n            <div class="dead-year">'+d(m(null!=(c=null!=t?h(t,"lifeLineBirthDeathInfo"):t)?h(c,"deathDesc"):c,t))+'</div>\n            <div class="line1">\n                <div class="wrap-circle">\n                    <div class="inner-circle"></div>\n                </div>\n            </div>\n        </div>\n        <div class="detail-content-wrapper">\n            <div class="detail-content detailContent">\n'+(null!=(c=h(i,"each").call(u,null!=(c=null!=t?h(t,"info"):t)?h(c,"timeMap"):c,{name:"each",hash:{},fn:e.program(11,o,0,l,s),inverse:e.noop,data:o,loc:{start:{line:31,column:16},end:{line:52,column:25}}}))?c:"")+'            </div>\n        </div>\n        <div class="detail-footer">\n            <div class="previous-btn change-btn">'+d(a(n("dfab")).call(u,"previousOne","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:56,column:49},end:{line:56,column:81}}}))+'</div>\n            <div class="num-info">\n                <span class="current-num"></span>/\n                <span class="total-num">'+d(m(null!=(c=null!=(c=null!=t?h(t,"info"):t)?h(c,"timeMap"):c)?h(c,"length"):c,t))+'</span>\n            </div>\n            <div class="next-btn change-btn">'+d(a(n("dfab")).call(u,"nextOne","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:61,column:45},end:{line:61,column:73}}}))+'</div>\n        </div>\n    </div>\n    <div class="right-info-container rightInfoContainer">\n        <div class="recom-container">\n        </div>\n        <div class="territory-info-container territoryInfoContainer"></div>\n    </div>\n    <div class="entry-component">\n    </div>\n    <div class="regime-list-component">\n    </div>\n    <div class="plugins-container pluginsContainer">\n        <div class="desc-viewer-container descViewerContainer"></div>\n    </div>\n</div>'},useData:!0,useDepths:!0})},"8bb6":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getArticleCover=t.ImageBlockResizer=void 0;var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=n("97a7");function l(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this.p=(0,i.default)({},t)}return(0,r.default)(e,[{key:"_formatImgMargin",value:function(){this.html.find("img").each((function(e){$(this).css("margin-top","auto"),$(this).css("margin-bottom","auto")}))}},{key:"_formatTable",value:function(e){e.find("table").each((function(e,t){if("0"===$(this).attr("border")||"0"===$(this).attr("border-spacing")||this.clientWidth>650)return $(this).addClass("line-age"),$(this).find("img").length>0&&$(this).find("td").css("padding","0px"),void $(this).wrap((function(){return"<div class='detail-table-box' style='overflow-x: auto;'></div>"}));$(this).addClass("dls-table"),parseInt(this.style.width)>=640&&(this.style.width="640px")}))}},{key:"formatLink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e=(e="string"==typeof(e=e||"")?e:String(e)).replace(/(<a[^>]+)href="\?id=([0-9a-zA-Z]*)(&amp;language=cn)?([^>]+)(>)/gi,'$1/detail/$2$4 data-id="$2"$5')}},{key:"formatReference",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=$("<div>"+e+"</div>");return t.find(".sup-ref").each((function(e,t){var n=$(t).attr("data-refid"),i=n.split("-")[1],a=$("<sup class='sup-reference' ref-id='"+n+"'>["+i+"]</sup>");$(t).after(a),$(t).remove()})),t.find(".sup-note").each((function(e,t){var n=$(t).attr("note-id");if(n||(n=$(t).attr("data-refid")),n){var i=n.split("-")[1];if(!i)return;var a=$("<sup class='sup-note' note-id='"+n+"'>[注"+i+"]</sup>");$(t).after(a),$(t).remove()}})),t.find(".sup-historical").each((function(e,t){$(t).append('<span class="sup">引</span>'),$(t).next().remove()})),t.html()}},{key:"clearMusicProgress",value:function(e){var t=$("<div>"+e+"</div>");return t.find(".info-part-bar").each((function(e,t){$(t).css("width",0)})),t.find(".current-duration").each((function(e,t){$(t).text("00:00")})),t.html()}},{key:"removeReferences",value:function(e){var t=$("<div>"+e+"</div>");return t.find(".sup-reference,.sup-ref,.sup-note").remove(),t.html()}},{key:"removeOutLink",value:function(e){for(var t=$("<div>"+e+"</div>"),n=t.find("a"),i=n.length,a=0;a<i;a++){var r=$(n[a]),o=r.attr("href");o&&o.length>=2&&"/"!==o[0]&&-1===o.indexOf("allhistory.com")&&-1===o.indexOf(window.location.hostname)&&(r.attr("href",""),r.addClass("out-link"))}return t.html()}},{key:"addTitleEdit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=$("<div>"+e+"</div>");return t.find("h2").each((function(e,t){if(0===$(t).find("span").length){var n=$(t).text();$(t).text("");var i="<span class='mw-headline'>"+n+"</span>";$(t).append($(i))}var a="<div class='h2-edit-container'>\n                      <span class='h2-edit-line'></span>\n                      <div class='butt-wrapper'>\n                          <span class='h2-edit-img'></span><span class='text'>"+_L_("edit")+"</span>\n                      </div>\n                    </div>";$(t).append($(a))})),t.html()}},{key:"resolveSpecialImport",value:function(e){var t=$("<div>"+e+"</div>");try{t.find(".dls-timemap-in-article").each((function(){})),t.find("iframe").each((function(){var e=$(this).attr("src");$(this).attr("scrolling","no"),e=(0,o.setUrlParam)(e,{_ua_:"iframe"}),/\/family\/subIndex\?id=/i.test(e)&&(e=(0,o.setUrlParam)(e,{options:0})),$(this).attr("src",e)})),t.find(".dls-relation-in-article").each((function(){var e=$(this),t=e.find("a").attr("href");e.find(".cke-btn-more-info").removeAttr("href").text(_L_("viewX",{p:["relationGraph"]})),e.find(".dls-relation-in-article-thumb").append('<a class="mask-see-more" target="_blank" href="'+t+'"></a>')}))}catch(e){}return t.html()}},{key:"_bind",value:function(){}}]),e}();t.default=new s;var c={resizeImageBlocks:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"article",n=this,i=0;i=t?parseInt(e.find(t).width()):parseInt(e.width()),e.find(".dls-image-block").each((function(){var e=i/640;$(this).width(i+20),$(this).find("img").length>1&&$(this).find("img").each((function(){var t=this;n.resizeImages(this,e),$(this).load((function(i){return n.resizeImages(t,e)}))}))}))},resizeImages:function(e,t){var n=$(e);n.width("auto");var i=void 0;if(!((i=e.naturalHeight)<=0)){parseInt(n.attr("data-origin-height"))?i=n.attr("data-origin-height"):(i=$(e).height(),n.attr("data-origin-height",i));var a=i*t;n.height(a)}}};t.ImageBlockResizer=c,t.getArticleCover=function(e){switch(e.coverType){case"SINGLE":case"TRIPLE":return e.covers[0]&&e.covers[0].url;case"AUTO":return e.covers[0]&&e.covers[0].url||e.thumb;default:return e.thumb}}},"8dfd":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("3f6b")),a=h(n("8827")),r=h(n("57ba")),o=h(n("0308"));n("831b");var l=h(n("e2cd")),s=h(n("2f20")),c=h(n("3d58")),u=h(n("9491")),d=n("f4f1"),m=h(n("b7f5"));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",active:!0,emptyBeforeAppend:!1,totalPage:1,currentPage:1,queryType:"3",keyword:"",pureEntries:{totalCount:0,list:[]},timeMapEntries:{totalCount:0,list:[]},onDestroyed:function(){},toNextPage:function(){},toPrePage:function(){},toEntryPage:function(){},hoverEntryItem:function(){},emitClickEntryItem:function(){}},t)}return(0,r.default)(e,[{key:"_render",value:function(){var e=this;if(this.$container){this.emptyBeforeAppend&&this.$container.empty();var t={active:this.active,queryType:this.queryType,pureEntry:{totalCount:this.pureEntries.totalCount,list:this._getPureEntryList(this.pureEntries.list)},timeMapEntry:{totalCount:this.timeMapEntries.totalCount,list:this._getTimeMapEntryList(this.timeMapEntries.list)},keyword:this.keyword,safeKeyword:this.safeKeyword};0===t.pureEntry.list.length&&0===t.timeMapEntry.list.length&&(t.showEmptyOptions=!0),t.timeMapEntryFirst=!1,t.pureEntry.list[0]&&t.timeMapEntry.list[0]&&t.pureEntry.list[0].title!==this.keyword&&t.timeMapEntry.list[0].title===this.keyword&&(t.timeMapEntryFirst=!0),this.$html=$((0,o.default)(t)),this.$container.append(this.$html),this.totalPage>1&&(this.pagingController=new l.default({$container:this.$html.find(".nodesOptions"),preText:_L_("lastPage","book"),nextText:_L_("nextPage","book"),currentNum:parseInt(Number(this.currentPage)),totalNum:parseInt(Number(this.totalPage)),onClickPreBtn:function(){e.toPrePage(e.queryType)},onClickNextBtn:function(){e.toNextPage(e.queryType)}})),this.$html.find(".resultListWrap").length>0&&(this.$ps=new m.default(this.$html.find(".resultListWrap")[0])),this._bind()}}},{key:"_getTimeMapEntryList",value:function(e){var t=[];return e.forEach((function(e){var n={title:e.name,summary:s.default.striptags(c.default.htmlParser(e.summary,!0)),imageUrl:e.imageUrl,id:e.id,type:e.type};"book"!==n.type||n.imageUrl||(n.firstCharOfName=n.title.substr(0,1)),t.push(n)})),t}},{key:"_getPureEntryList",value:function(e){if("2"===this.queryType){var t=[];return e.forEach((function(e){var n={title:e.name,summary:s.default.striptags(c.default.htmlParser(e.summary,!0)),imageUrl:e.imageUrl,id:e.id,type:e.type};"book"!==n.type||n.imageUrl||(n.firstCharOfName=n.title.substr(0,1)),t.push(n)})),t}return e[0]?[{title:e[0].name,summary:s.default.striptags(c.default.htmlParser(e[0].summary,!0)),imageUrl:e[0].imageUrl,id:e[0].id,type:e[0].type}]:[]}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".moreInfo",(function(t){e.toEntryPage("2")})),this.$html.on("click",".backLink",(function(t){e.toEntryPage("3")})),this.$html.on("click",".entryItem",(function(t){var n=$(t.currentTarget),i=n.data("id"),a=n.data("type");e.emitClickEntryItem(i,a)})),this.$html.on("click",".createBtn",(function(t){if((0,d.isAuth)()&&window.userInfo&&window.userInfo.phone){var n=btoa(encodeURIComponent(e.keyword));window.open("/user/newentry?keyword="+e.keyword+"&urlKeyword="+n)}else new u.default})),this.$html.on("mouseover",".entryItem",(function(e){$(e.currentTarget).addClass("active")})),this.$html.on("mouseout",".entryItem",(function(e){$(e.currentTarget).removeClass("active")})),this.$html.on("mouseenter",".entryItem",(function(t){var n=$(t.currentTarget).data("id");setTimeout((function(){var t=e.$html.find(".entryItem:hover");t.length>0&&$(t[0]).data("id")===n&&e.hoverEntryItem(n)}),500)}))}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"update",value:function(e){(0,i.default)(this,e),this._render()}},{key:"destroy",value:function(){this.$container&&this.$container.empty(),this.onDestroyed()}}]),e}();t.default=f,e.exports=t.default},"8f5f":function(e,t,n){n("8663"),e.exports=n("584a").Math.log2},"8faf":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n("3f6b")),a=m(n("8827")),r=m(n("57ba"));n("4b0d");var o=m(n("aeba")),l=m(n("62fa")),s=n("4a87"),c=m(n("d88e")),u=n("a7c7"),d=n("8bb6");function m(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t){(0,a.default)(this,e),t.entry&&(this.data={},(0,i.default)(this.data,{entryID:t.entry.id,articles:[]}),this.setEntryCompCardsState=t.setEntryCompCardsState,this._createDom(),this._loadData())}return(0,r.default)(e,[{key:"_bind",value:function(){var e=this;this.$html.off("click.hidePop").on("click.hidePop",(function(t){!$(t.target).hasClass("pop-content")&&$(t.target).parents(".pop-content").length<1&&e.pop.close()}))}},{key:"_createDom",value:function(){var e=this;this.pop=new s.PopBox({customContent:!0,$content:$((0,c.default)()),afterClose:function(){e.setEntryCompCardsState&&setTimeout((function(){u.MAB_STATE.update("entryCompCardsState",!1)}),20)}})}},{key:"_loadData",value:function(){var e=this;l.default.getArtilceList(this.data.entryID,1,4).then((function(t){var n=t.data.list;n.forEach((function(e){e.thumb=(0,d.getArticleCover)(e),e.thumb&&(e.thumb=e.thumb.replace(/\?[^\?]*$/,"")),e.url="/article/"+e.id})),e.data.articles=n,e.$html=$((0,o.default)(e.data)),e.pop.updateContent(e.$html),e._bind()}))}}]),e}();t.default=h,e.exports=t.default},9178:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="dls-timebar-controller point-model">\n  <div class="point-time"></div>\n  <br>\n  <div class="point-arrow"></div>\n</div>'},useData:!0})},"93c3":function(e,t,n){e.exports=n.p+"common/img/photo-example.6709.png"},9424:function(e,t,n){},"944a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n("3f6b")),a=m(n("8827")),r=m(n("57ba")),o=m(n("268e")),l=m(n("ecea")),s=m(n("1505")),c=n("a7c7"),u=n("df60"),d=m(n("fe21"));function m(e){return e&&e.__esModule?e:{default:e}}n("1f10");var h=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",active:!1,emptyBeforeAppend:!1,data:null,position:{x:-1e3,y:-1e3},width:434,height:240,isMultiMarker:!1,onDestroyed:function(){},handleLinkItemClick:function(){},hideEntryCard:function(){},emitNavigateToDetail:function(){}},t),this.markerOffset={top:-1,left:15},this.isAlive=!0,this._render(),this._loadCard(this.data.node.itemId)}return(0,r.default)(e,[{key:"_render",value:function(){this.$container&&this.data&&(this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,o.default)({active:this.active,data:this.data})),this.$container.append(this.$html),this._handleLinkLabel(),this._moveCard(),this._bind())}},{key:"_handleLinkLabel",value:function(){(0,u.handleOpenLinkInNewTab)({$container:this.$html.find(".descWrap, .entryDesc")})}},{key:"_moveCard",value:function(){var e=this._getPosition(),t=e.top,n=e.left;this.$html.css({top:t,left:n})}},{key:"_loadCard",value:function(e){var t=this;e&&d.default.getSimpleIntro(e).then((function(e){t.entry=e.data})).then((function(e){var n=t.entry.moduleStat,i=[{name:_L_("summary"),type:"detail",available:!0},{name:_L_("relationGraph"),type:"relation",available:n.relation>0},{name:_L_("works"),type:"product",available:n.book+n.painting>0},{name:_L_("article"),type:"article",available:n.article>0}],a=(0,l.default)({items:i});t.$html.find(".more-info").replaceWith(a)}))}},{key:"_linkItemClick",value:function(e){if(this.entry){var t=e.currentTarget.dataset.to;if(!t)return!1;if(!(e.currentTarget.className.indexOf("active")<0)){c.MAB_STATE.update("entryCompCardsState",!0);switch(t){case"relation":s.default.showRelation(this.entry,!0);break;case"detail":s.default.showSummary(this.entry,!0);break;case"product":s.default.showProductMedia(this.entry,!0);break;case"article":s.default.showArticle(this.entry,!0)}}}}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".linkItem",this._linkItemClick.bind(this)),this.$html.on("click",".nodeItem",(function(t){window.open("/map/detail/"+e.data.node.itemId+"/"+e.data.id)})),this.$html.on("click",".iconClose",(function(){e.hideComponent();var t=e.$html.data("entry-id");e.hideEntryCard(t)})),this.$html.off("click.stopPropagation").on("click.stopPropagation",".descWrap a",(function(e){e.stopPropagation()}))}},{key:"_getPosition",value:function(){var e=this.$html.outerHeight(),t=this.position.y-e,n=this.position.x-(this.getCardWidth()||this.width)/2;return t=Math.round(t),n=Math.round(n),this.cardOffsetY=this.isMultiMarker?34:60,this.isMultiMarker&&(t+=this.markerOffset.top,n+=this.markerOffset.left),{top:t-=this.cardOffsetY,left:n}}},{key:"getCardHeight",value:function(){return this.$html?this.$html.outerHeight():0}},{key:"getCardWidth",value:function(){return this.$html?this.$html.outerWidth():0}},{key:"updatePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.position=e,this.isMultiMarker=t,this._moveCard()}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html&&this.$html.removeClass("active")}},{key:"update",value:function(e){(0,i.default)(this,e),this._render()}},{key:"destroy",value:function(){this.$html&&(this.isAlive=!1,this.$html.remove()),$("body").off("click.popClose",".icon-close-big");var e=this.$html.data("entry-id");this.onDestroyed(e)}}]),e}();t.default=h,e.exports=t.default},9574:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="map-header-component '+(null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"show"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:33},end:{line:1,column:58}}}))?r:"")+'">\n  <div class="languages-container languagesContainer"></div>\n  <div class="userinfo-container userInfoContainer"></div>\n</div>'},useData:!0})},"963a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n("3f6b")),a=f(n("8827")),r=f(n("57ba")),o=f(n("b225"));n("e249");var l=f(n("b7f5")),s=n("27dc"),c=f(n("417f")),u=f(n("1be1")),d=f(n("9491")),m=n("f4f1"),h=f(n("a4fc"));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",info:{},id:"",active:!1,listItemHover:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){var e=this;this.$container.empty(),this.$html=$((0,o.default)(this.info)),this.$container.append(this.$html),this._bind(),setTimeout((function(){e.showComponent(),e._calcHeight(),e.$ps=new l.default(e.$html.find(".list-content")[0])}))}},{key:"_bind",value:function(){var e=this;$(window).off("resize.detail-list-content").on("resize.detail-list-content",(function(t){e._calcHeight(),e.$ps.update()})),this.$html.find(".list-item").on("click",(function(t){var n=t.currentTarget.dataset.id;e.listItemHover(n),e.onListClick(n)})),this.$html.find(".list-item").on("mouseover",(function(t){e.mtimer&&clearTimeout(e.mtimer),e.mtimer=setTimeout((function(){var n=t.currentTarget.dataset.id;e.flyToMarker(n)}),500)})),this.$html.find(".editIcon").on("click",(function(){(0,m.isAuth)()&&window.userInfo&&window.userInfo.phone?new h.default({type:"编辑节点"}).isBan||c.default.getLock("timemap","",e.id).then((function(t){200===t.code&&(window.location.href="/map/edit/item/"+e.id)})).fail((function(t){401===t.status?new d.default({nextUrl:"/map/edit/item/"+e.id}):2001===t.code?new u.default({$container:$("body"),text:_L_("TheItemIsUnderCheckAndGoUserCenter","timemap"),position:"top-center"}):new u.default({resp:t,duration:3e3})})):new d.default({nextUrl:"/map/edit/item/"+e.id})}))}},{key:"update",value:function(e){e&&(this.info=e,this._render())}},{key:"flyToMarker",value:function(e){var t=this;this.info.timeMap.forEach((function(n){if(n.id==e){t.map.on("moveend.detail-list-marker",(function(n){t.listItemHover(e),t.map.off("moveend.detail-list-marker")}));var i=t.map.gl.project((0,s.getLocation)(n.node.location.geometry[0])),a=t.map.gl.unproject([i.x-$(".detail-list-header-component").outerWidth()/2,i.y]);t.map.flyToPoint({center:a})}}))}},{key:"destroy",value:function(){$(window).off("resize.detail-list-content")}},{key:"_calcHeight",value:function(){this.$html.find(".list-content").css("max-height",$("body").height()-435+"px")}},{key:"updateTopVal",value:function(e){this.$html.css("top",e+"px")}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}}]),e}();t.default=p,e.exports=t.default},"96d5":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="timebar-markers-wrapper">\n  \n</div>'},useData:!0})},"96ef":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){return"multi-marker"},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.lambda,u=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="mapMarker map-marker '+(null!=(l=d(i,"if").call(s,null!=t?d(t,"active"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:33},end:{line:1,column:60}}}))?l:"")+'" data-mid="'+u(c(null!=t?d(t,"id"):t,t))+'" data-type="'+u(c(null!=t?d(t,"type"):t,t))+'">\n  <div class="marker-item '+(null!=(l=d(i,"if").call(s,null!=t?d(t,"isCluster"):t,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:2,column:26},end:{line:2,column:62}}}))?l:"")+'">\n    <div class="marker-icon multiMarkerIcon nodeDetailMarkerEle '+u(c(null!=t?d(t,"iconClassName"):t,t))+'">\n    </div>\n    <div class="marker-title multiMarkerTitle nodeDetailMarkerEle" title="'+(null!=(l=a(n("89ec")).call(s,null!=t?d(t,"itemName"):t,!1,{name:"htmlparser",hash:{},data:o,loc:{start:{line:5,column:74},end:{line:5,column:107}}}))?l:"")+'">\n      '+(null!=(l=a(n("89ec")).call(s,null!=t?d(t,"itemName"):t,!1,{name:"htmlparser",hash:{},data:o,loc:{start:{line:6,column:6},end:{line:6,column:39}}}))?l:"")+"\n    </div>\n  </div>\n</div>"},useData:!0})},"983e":function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="timebar-width-division">\n <div class="division-bar active"></div>\n</div>'},useData:!0})},9847:function(e,t,n){},"9c68":function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l=e.lambda,s=e.escapeExpression,c=null!=t?t:e.nullContext||{},u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="map-entry-comp-pop-box pop-box-mask">\n  <div class="pop-content product">\n    <div class="icon-close-big pop-close"></div>\n    <div class="scroll-content">\n      <div class="box-title">\n        <a href="/detail/'+s(l(null!=t?u(t,"id"):t,t))+'/product" target="_blank">'+s(a(n("dfab")).call(c,"worksAndContribution",{name:"lang",hash:{},data:o,loc:{start:{line:6,column:57},end:{line:6,column:88}}}))+'</a>\n      </div>\n      <a class="read-more cp" href="/detail/'+s(l(null!=t?u(t,"id"):t,t))+"/product\" target='_blank'>"+s(a(n("dfab")).call(c,"readdetail",{name:"lang",hash:{},data:o,loc:{start:{line:8,column:76},end:{line:8,column:97}}}))+' <div class="icon icon-arrow-right"></div></a>\n\n      <div class="product-container"></div>\n    </div>\n  </div>\n</div>'},useData:!0})},a16c:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return window.self!==window.top&&($(".page-container,.mapboxgl-control-container,.timebar-width-division,.top-right-in-map,.map-bottom-right-components").css("visibility","hidden"),!0)},e.exports=t.default},a1d3:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){var r,o,l=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div class="filter-row">\n          <div class="filter-name">\n            '+c("function"==typeof(o=null!=(o=u(n,"text")||(null!=t?u(t,"text"):t))?o:s)?o.call(l,{name:"text",hash:{},data:a,loc:{start:{line:7,column:12},end:{line:7,column:20}}}):o)+'\n          </div>\n          <div class="filter-items filterItem" data-name="'+c("function"==typeof(o=null!=(o=u(n,"name")||(null!=t?u(t,"name"):t))?o:s)?o.call(l,{name:"name",hash:{},data:a,loc:{start:{line:9,column:58},end:{line:9,column:66}}}):o)+'">\n'+(null!=(r=u(n,"each").call(l,null!=t?u(t,"data"):t,{name:"each",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a,loc:{start:{line:10,column:12},end:{line:15,column:21}}}))?r:"")+"          </div>\n        </div>\n"},4:function(e,t,n,i,a){var r,o,l=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'              <div class="tag-item tagItem '+(null!=(r=u(n,"if").call(l,null!=t?u(t,"active"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:11,column:43},end:{line:11,column:70}}}))?r:"")+'" data-tag-id="'+c("function"==typeof(o=null!=(o=u(n,"id")||(null!=t?u(t,"id"):t))?o:s)?o.call(l,{name:"id",hash:{},data:a,loc:{start:{line:11,column:85},end:{line:11,column:91}}}):o)+'">\n                <span class="icon '+c("function"==typeof(o=null!=(o=u(n,"iconClassName")||(null!=t?u(t,"iconClassName"):t))?o:s)?o.call(l,{name:"iconClassName",hash:{},data:a,loc:{start:{line:12,column:34},end:{line:12,column:51}}}):o)+'"></span>\n                <span class="tag-name">'+c("function"==typeof(o=null!=(o=u(n,"name")||(null!=t?u(t,"name"):t))?o:s)?o.call(l,{name:"name",hash:{},data:a,loc:{start:{line:13,column:39},end:{line:13,column:47}}}):o)+"</span>\n              </div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="filter-component '+(null!=(r=l(n,"if").call(o,null!=t?l(t,"active"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:29},end:{line:1,column:56}}}))?r:"")+'">\n  <div class="filter-wrap active">\n    <div class="filter-list">\n'+(null!=(r=l(n,"each").call(o,null!=t?l(t,"tagsArr"):t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:6},end:{line:18,column:15}}}))?r:"")+'      <div class="switch-container">\n      </div>\n    </div>\n    <div class="filter-switch switchBtn">\n\n    </div>\n  </div>\n</div>'},useData:!0})},a256:function(e,t,n){},a288:function(e,t,n){},a360:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=O(n("e1de")),a=O(n("633f")),r=O(n("8827")),o=O(n("57ba")),l=O(n("158c")),s=O(n("9918")),c=O(n("27f1")),u=O(n("d1f2")),d=n("ffc6"),m=n("a7c7"),h=O(n("d355")),f=O(n("24d8")),p=n("27dc"),v=O(n("b5e2")),y=O(n("963a")),g=O(n("3a5a")),k=O(n("e93f")),b=O(n("2f20")),_=n("a8a7"),C=n("2cc3"),w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n("2cc3")),M=O(n("8bb6")),x=O(n("e2d7")),P=O(n("89ec")),T=O(n("fe21")),I=O(n("c115")),S=O(n("9491")),E=n("f4f1");n("474e");var A=O(n("7ac4"));function O(e){return e&&e.__esModule?e:{default:e}}var L=function(e){function t(e){(0,r.default)(this,t),e.showComps=["timebar","markersComponent","bottomRightComponent","topRightComponent"];var n=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));return n.active=!0,n.mabState=m.MAB_STATE,n.yearArr=n.mabState.get("mapYears"),n.$container=$(".pageContainer"),n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"onPageMount",value:function(){var e=this;this.pageParams=d.Nav.getParams("map-router"),this.pageQuery=d.Nav.getQuery("map-router"),this.markersComponent=this.comps.markersComponent,this.comps.timebar.update({scalable:!1,showDivision:!1,type:"point",draggable:!1,markers:[]}),this._getInfo().then((function(t){e.$html=$((0,u.default)()),e.$container.empty(),e.$container.append(e.$html),e.detailListMarker=new g.default({comps:e.comps,data:e.info.timeMap,map:e.map,clickItem:function(t){d.Nav.go("/map/detail/"+e.pageParams.id+"/"+t,{key:"map-router"})}}),A.default.setTitle(_L_("AofB",{p:["timemap",t.name]})),A.default.setDesc(t.summary),e.detailListHeader=new v.default({$container:e.$html.find(".detail-list-header"),info:e.info||{},id:e.pageParams.id}),e.detailListContent=new y.default({$container:e.$html.find(".detail-list-content"),info:e.info||{},id:e.pageParams.id,map:e.map,onListClick:function(t){d.Nav.go("/map/detail/"+e.pageParams.id+"/"+t,{key:"map-router"})},listItemHover:function(t){var n=0;e.markers.forEach((function(i){i.id==t&&(n=i.index,"number"==typeof i.time&&(e.comps.timebar.ruler.setCenterByTime(i.time,.3,!1),i.mapTime?e.map.setYear(i.mapTime):e.map.setYear(i.time)))})),$(".timebar-marker-item").removeClass("active"),Array.prototype.forEach.call($(".timebar-marker-item"),(function(e){Number(e.dataset.index)==n&&$(e).addClass("active")})),e.detailListMarker.listItemHover(t)}}),e.resetDetailListContentTop(),e._removePointLinePolygonForMarker(),e.markers=e._dealMarkerData(e.info.timeMap),e.years=(0,p.getBirthToDead)(e.markers),e.minAndMax=(0,p.getMinAndMax)(e.years),e.comps.timebar.update({showDivision:!1,type:"point",markerOnClick:function(t,n){e.comps.timebar.ruler.setCenterByTime(n.time,.3,!1),d.Nav.go("/map/detail/"+e.pageParams.id+"/"+n.id,{key:"map-router"})},draggable:!1,scalable:!1,markers:e.markers});var n=e.markers.sort((function(e,t){return e.time-t.time}));if(n.length>0&&e.map.setYear(n[n.length-1].time,"left"),e.markers.length>0&&(e.comps.timebar.ruler.setTimeByWidth(e.minAndMax.min-(e.minAndMax.max-e.minAndMax.min)-10,e.minAndMax.max+10),e.comps.timebar.ruler.setCenterByTime(e.markers[0].time,.3,!1),$(window).off("resize.detail-list").on("resize.detail-list",(function(t){e.comps.timebar.ruler.setTimeByWidth(e.minAndMax.min-(e.minAndMax.max-e.minAndMax.min)-10,e.minAndMax.max+10),e.comps.timebar.ruler.setCenterByTime(e.markers[0].time,.3,!1)}))),e.territoryInfo=new k.default({$container:e.$html.find(".territoryInfoContainer"),emitCloseTerritoryInfo:function(){e.territory.handleCloseTerritoryInfo()},onDestroyed:function(){e.territoryInfo=null}}),e.territory=new h.default({map:e.map,territoryInfo:e.territoryInfo,onDestroyed:function(){e.territory=null}}),"territory"===e.pageParams.id&&e._setToTerritoryYear(),e.info.special){var i=e.info.location,a=.3*$("body").width();a=a<480?480:a;var r={top:60,bottom:120,left:a+=100,right:60};e.map.gl.fitBounds(i,{padding:r})}else setTimeout((function(){e.fitBounds()}),20)}))}},{key:"resetDetailListContentTop",value:function(){var e=this.detailListHeader.$html.outerHeight()+8+8;this.detailListContent.updateTopVal(e)}},{key:"_removePointLinePolygonForMarker",value:function(){this.markersComponent.removeMapLine(),this.markersComponent.removeLineString(),this.markersComponent.removePolygon()}},{key:"fitBounds",value:function(){var e=[];this.info.timeMap.forEach((function(t){var n={location:(0,p.getLocation)(t.node.location.geometry[0])};e.push(n)})),e.length>0&&this.map.gl.fitBounds((0,p.getFitBounds)(e),{padding:{top:200,bottom:200,left:$(".detail-list-header-component.active").outerWidth()+100,right:100}})}},{key:"_setToTerritoryYear",value:function(){var e=this,t=(0,_.getSessionStorageItem)("map","territoryInfo","");if(t){var n=t.territory.esGeometry.sTime,i=t.territory.esGeometry.eTime;if(n&&i){var a=n,r=i+(i-n);r-a<10&&(a=i-5,r=i+5),this.comps.timebar.ruler.setTimeByWidth(a,r),this.comps.timebar.ruler.setCenterByTime(i,.3,!1);var o=this.yearArr.filter((function(e){return e>=n&&e<=i})),l=o.length>0?o[o.length-1]:i;this.map.setYear(l),setTimeout((function(){e.highlightTerritory(l)}),2e3),this.territory.fitBoundsCountry(l,this.territoryId)}}}},{key:"highlightTerritory",value:function(e){var t=(0,C.getYearStrFromNum)(e,!1),n=t+"-countryborder_hover",i=t+"-country_comb_hover",a=t+"-country_comb_line_hover";this.territory.activeSpecialTerritory(this.territoryId);var r=[this.territoryId];this.territory.activeCountryState(n,r),this.territory.activeCountryCombState(i,a,r)}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".createBtn",(function(){if((0,E.isAuth)()&&window.userInfo&&window.userInfo.phone){var t=btoa(encodeURIComponent(e.safeTerritoryName));window.open("/user/newentry?keyword="+e.safeTerritoryName+"&urlKeyword="+t)}else new S.default}))}},{key:"_render",value:function(){var e=this;this.$html=$((0,u.default)()),this.$container.empty(),this.$container.append(this.$html),this.comps.timebar.update({showDivision:!1,type:"point",markerOnClick:function(e,t){},draggable:!1,scalable:!1,markers:[]}),this.territoryInfo=new k.default({$container:this.$html.find(".territoryInfoContainer"),emitCloseTerritoryInfo:function(){e.territory.handleCloseTerritoryInfo()},onDestroyed:function(){e.territoryInfo=null}}),this.territory=new h.default({map:this.map,territoryInfo:this.territoryInfo,onDestroyed:function(){e.territory=null}}),this._bind()}},{key:"showEmptyTerritoryInfo",value:function(){this.$html.find(".keyWordsName")[0].innerText=this.safeTerritoryName,this.$html.find(".emptyTerritoryContainer").addClass("active")}},{key:"onPageExit",value:function(){this.detailListHeader&&this.detailListHeader.hideComponent(),this.detailListContent&&this.detailListContent.hideComponent(),this.territory&&this.territory.destroy()}},{key:"destroy",value:function(){this.$container&&this.$container.empty(),$(window).off("resize.detail-list"),this.detailListContent&&this.detailListContent.destroy(),this.comps.timebar.update({showDivision:!1,type:"point",markers:[]}),this.detailListMarker&&this.detailListMarker.destroy()}},{key:"_getInfo",value:function(){var e=this;if("territory"===this.pageParams.id){var t=this.pageQuery.id[0];t&&(this.territoryId=t);var n=this.pageQuery.n[0];return n&&(this.territoryName=decodeURIComponent(atob(n)),this.safeTerritoryName=(0,x.default)(this.territoryName,"title","true")),I.default.getTerritoryItem([t]).then((function(t){if(200===t.code){var n=t.data&&t.data.list||[],i=n[0]?n[0]:{};if(i.itemid_country&&i.itemid_country[0])return T.default.getMapDetail(i.itemid_country[0]).then((function(t){if(200===t.code)return e.mabState.updateIn(["detail","id"],i.itemid_country[0]),t.data.summary=M.default.removeReferences(t.data.summary),t.data.timeMap.forEach((function(t,n){t.index=n+1,t.node.subdesc=(0,P.default)(t.node.desc)?b.default.subStr((0,P.default)(t.node.desc).replace(/<a.*>(.*)<\/a>/g,"$1"),94):"",t.node.standardTime=(0,C.timeStantard)(t.node.time),""===t.node.title&&(t.node.isNLP=!0,t.node.title=e._getNlpNodeTitle(t))})),e.mabState.updateIn(["detail","info"],t.data),e.info=e.mabState.get("detail").info,e.info}))}})).fail((function(t){e._render(),e.showEmptyTerritoryInfo(),e._setToTerritoryYear()}))}var a=this.mabState.get("detail").id;return this.pageParams.id==a?i.default.resolve().then((function(t){return e.info=e.mabState.get("detail").info,e.info})):T.default.getMapDetail(this.pageParams.id).then((function(t){if(t.data)return e.mabState.updateIn(["detail","id"],e.pageParams.id),t.data.summary=M.default.removeReferences(t.data.summary),t.data.timeMap.forEach((function(t,n){t.index=n+1,t.node.subdesc=(0,P.default)(t.node.desc)?b.default.subStr((0,P.default)(t.node.desc).replace(/<a.*>(.*)<\/a>/g,"$1"),94):"",t.node.standardTime=(0,C.timeStantard)(t.node.time),""===t.node.title&&(t.node.isNLP=!0,t.node.title=e._getNlpNodeTitle(t))})),e.mabState.updateIn(["detail","info"],t.data),e.info=e.mabState.get("detail").info,e.info}))}},{key:"_getNlpNodeTitle",value:function(e){return f.default.subDateForYear(e.node.time.startTime)+" "+e.node.location.desc}},{key:"_dealMarkerData",value:function(e){var t=this,n=[];return e.forEach((function(e){if(e.node.time&&e.node.time.startTime){var i=w.dateParser(e.node.time.startTime),a=i.year*i.abdcType;0==a&&(a=null);var r=null,o=null;if(e.node.time&&e.node.time.startTime&&e.node.time.endTime){var l=w.dateParser(e.node.time.startTime),s=w.dateParser(e.node.time.endTime),c=parseInt(l.yearWithAdbc),u=parseInt(s.yearWithAdbc);o=c>1949&&u>=1990?u:(r=t.yearArr.filter((function(e){return e>=c&&e<=u}))).length&&0!==r.length?r[parseInt(r.length/2)]:c+parseInt((u-c)/2)}n.push({time:a,mapTime:o,id:e.id,title:e.node.title})}})),n}}]),t}(c.default);t.default=L,e.exports=t.default},a36d:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,i,r,o,l,s){var c,u=e.lambda,d=e.escapeExpression,m=null!=t?t:e.nullContext||{},h=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <li data-id="'+d(u(null!=t?h(t,"id"):t,t))+'" style="animation-delay:'+d(u(null!=t?h(t,"delay"):t,t))+'s"\n    onclick="window.open(\'/relation?id='+d(u(null!=s[1]?h(s[1],"centerId"):s[1],t))+"&lineId="+d(u(null!=t?h(t,"relationId"):t,t))+"&&')\">\n\n    <div class='avator-container'>\n      <div class='outer'></div>\n      <div class='inner'></div>\n"+(null!=(c=h(i,"if").call(m,null!=t?h(t,"imageUrl"):t,{name:"if",hash:{},fn:e.program(2,o,0,l,s),inverse:e.program(4,o,0,l,s),data:o,loc:{start:{line:9,column:6},end:{line:13,column:13}}}))?c:"")+'\n      <div class="relation-name">\n        <span\n          class="relation-arrow '+(null!=(c=a(n("d930")).call(m,null!=t?h(t,"direction"):t,"===","->",{name:"ifcond",hash:{},fn:e.program(6,o,0,l,s),inverse:e.program(8,o,0,l,s),data:o,loc:{start:{line:18,column:32},end:{line:18,column:164}}}))?c:"")+"\"\n          data-dir='"+d(u(null!=t?h(t,"direction"):t,t))+"'></span>\n        <span class='relation-detail'>"+d(u(null!=t?h(t,"relation"):t,t))+'</span>\n      </div>\n      <div class="entry-name">'+d(u(null!=t?h(t,"name"):t,t))+'</div>\n      <div class="relation-big-name '+d(u(null!=t?h(t,"direction"):t,t))+'">'+d(u(null!=t?h(t,"relation"):t,t))+"</div>\n    </div>\n\n  </li>\n\n"},2:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <div class="avatar op" style="background-image:url(\''+o(r(null!=t?l(t,"imageUrl"):t,t))+"?w=200&h=200'); background-color:"+o(r(null!=t?l(t,"bg"):t,t))+';"></div>\n'},4:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <div class="avatar" style="background-color:'+o(r(null!=t?l(t,"bg"):t,t))+'">'+o(r(null!=t?l(t,"firstLetter"):t,t))+"</div>\n"},6:function(e,t,n,i,a){return"right-arrow"},8:function(e,t,i,r,o){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=a(n("d930")).call(null!=t?t:e.nullContext||{},null!=t?s(t,"direction"):t,"===","<-",{name:"ifcond",hash:{},fn:e.program(9,o,0),inverse:e.program(11,o,0),data:o,loc:{start:{line:18,column:83},end:{line:18,column:153}}}))?l:""},9:function(e,t,n,i,a){return"left-arrow"},11:function(e,t,n,i,a){return"two-arrow"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a,r,o){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<ul>\n"+(null!=(l=s(n,"each").call(null!=t?t:e.nullContext||{},null!=t?s(t,"list"):t,{name:"each",hash:{},fn:e.program(1,a,0,r,o),inverse:e.noop,data:a,loc:{start:{line:2,column:2},end:{line:29,column:11}}}))?l:"")+"</ul>"},useData:!0,useDepths:!0})},a637:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("e4f9")),l=n("0280");function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{map:{},child:[],callback:function(){},reSet:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)(this.child.properties)),this.map.addMarker({element:this.$html[0],point:this.child.geometry.coordinates,id:this.child.properties.id,data:this.child.properties}),this._bind()}},{key:"_bind",value:function(){var e=this;this.$html.find(".normal-marker-icon").on("mousedown",(function(){e.callback(e.child.properties.id),e.reSet(),e.$html.find(".normal-marker-icon").removeClass("active"),e.$html.find(".active-marker-icon").addClass("active"),e.$html.css({"z-index":1})})),this.$html.find(".active-marker-icon").on("mousedown",(function(){e.callback(e.child.properties.id)})),this.$html.find(".bottom-text").on("mousedown",(function(){(0,l.activeMarkerClickState)()}))}},{key:"setToDisplay",value:function(){this.$html.find(".normal-marker-icon").removeClass("active"),this.$html.find(".active-marker-icon").addClass("active"),this.$html.css({"z-index":1})}},{key:"reset",value:function(){this.$html.find(".active-marker-icon").removeClass("active"),this.$html.find(".normal-marker-icon").addClass("active"),this.$html.css({"z-index":0})}},{key:"destroy",value:function(){this.$html.remove()}}]),e}();t.default=c,e.exports=t.default},aacd:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,r){var o,l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="search-box-component '+(null!=(o=c(i,"if").call(s,null!=t?c(t,"active"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:33},end:{line:1,column:60}}}))?o:"")+'">\n  <div id="searchBoxComponent" class="search-box">\n    <input type="text" class="fs-4" type="text" placeholder="'+e.escapeExpression((l=n("dfab"),l&&(l.__esModule?l.default:l)).call(s,"searchBoxPlaceholder","timemap",{name:"lang",hash:{},data:r,loc:{start:{line:3,column:61},end:{line:3,column:102}}}))+'" autocomplete="false">\n    <div class="icon icon-logo iconLogo"></div>\n    <div class="icon icon-search"></div>\n    <div class="icon icon-empty emptySearch display-none"></div>\n    <ul id="timeMapSearchSuggestions" class="search-box-suggestions"></ul>\n  </div>\n  <div class="hot-search-container hotSearchContainer display-none"></div>\n</div>'},useData:!0})},aeba:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <li>\n        <a href="'+c(s(null!=t?d(t,"url"):t,t))+"\" target='_blank'>\n"+(null!=(l=d(i,"if").call(u,null!=t?d(t,"thumb"):t,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.program(4,o,0),data:o,loc:{start:{line:13,column:10},end:{line:17,column:17}}}))?l:"")+'          <div class="title">'+c(s(null!=t?d(t,"title"):t,t))+'</div>\n          <div class="desc">'+c(a(n("d558")).call(u,null!=t?d(t,"content"):t,80,{name:"substr",hash:{},data:o,loc:{start:{line:19,column:28},end:{line:19,column:49}}}))+"</div>\n        </a>\n      </li>\n"},2:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'          <div class="cover" style="background-image:url(\''+e.escapeExpression(e.lambda(null!=t?r(t,"thumb"):t,t))+"?h=400');\"></div>\n"},4:function(e,t,n,i,a){return'          <div class="cover default"></div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="map-entry-comp-pop-box pop-box-mask">\n  <div class="pop-content page-comp-article">\n    <div class="icon-close-big pop-close"></div>\n    <div class="box-title">\n      <a href="/detail/'+c(s(null!=t?d(t,"entryID"):t,t))+'/article" target="_blank">'+c(a(n("dfab")).call(u,"article",{name:"lang",hash:{},data:o,loc:{start:{line:5,column:60},end:{line:5,column:78}}}))+'</a>\n    </div>\n    <a class="read-more cp" href="/detail/'+c(s(null!=t?d(t,"entryID"):t,t))+"/article\" target='_blank'>"+c(a(n("dfab")).call(u,"readdetail",{name:"lang",hash:{},data:o,loc:{start:{line:7,column:79},end:{line:7,column:100}}}))+' <div class="icon icon-arrow-right"></div></a>\n\n    <ul>\n'+(null!=(l=d(i,"each").call(u,null!=t?d(t,"articles"):t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:10,column:6},end:{line:22,column:15}}}))?l:"")+"    </ul>\n  </div>\n</div>"},useData:!0})},aec1:function(e,t,n){},afb7:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s="function",c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="mapMarker map-marker" data-type="'+c(typeof(r=null!=(r=u(n,"type")||(null!=t?u(t,"type"):t))?r:l)===s?r.call(o,{name:"type",hash:{},data:a,loc:{start:{line:1,column:45},end:{line:1,column:53}}}):r)+'" data-mid="'+c(typeof(r=null!=(r=u(n,"id")||(null!=t?u(t,"id"):t))?r:l)===s?r.call(o,{name:"id",hash:{},data:a,loc:{start:{line:1,column:65},end:{line:1,column:71}}}):r)+'">\n  <div class="multi-marker multiMarker" data-mid="'+c(typeof(r=null!=(r=u(n,"id")||(null!=t?u(t,"id"):t))?r:l)===s?r.call(o,{name:"id",hash:{},data:a,loc:{start:{line:2,column:50},end:{line:2,column:56}}}):r)+'">\n    <div class="marker-icon multiMarkerIcon">\n      <div class="marker-len markerLen">\n        '+c(typeof(r=null!=(r=u(n,"markerLen")||(null!=t?u(t,"markerLen"):t))?r:l)===s?r.call(o,{name:"markerLen",hash:{},data:a,loc:{start:{line:6,column:8},end:{line:6,column:21}}}):r)+'\n      </div>\n    </div>\n    <div class="marker-title multiMarkerTitle">\n      '+c(typeof(r=null!=(r=u(n,"itemName")||(null!=t?u(t,"itemName"):t))?r:l)===s?r.call(o,{name:"itemName",hash:{},data:a,loc:{start:{line:10,column:6},end:{line:10,column:18}}}):r)+"\n    </div>\n  </div>\n</div>"},useData:!0})},b12d:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="single-marker singleMarker" data-mid="'+s("function"==typeof(r=null!=(r=c(n,"id")||(null!=t?c(t,"id"):t))?r:l)?r.call(o,{name:"id",hash:{},data:a,loc:{start:{line:1,column:50},end:{line:1,column:56}}}):r)+'">\n  <div class="marker-icon singleMarkerIcon '+s("function"==typeof(r=null!=(r=c(n,"iconClassName")||(null!=t?c(t,"iconClassName"):t))?r:l)?r.call(o,{name:"iconClassName",hash:{},data:a,loc:{start:{line:2,column:43},end:{line:2,column:60}}}):r)+'">\n  </div>\n  <div class="marker-title singleMarkerTitle" title="'+s("function"==typeof(r=null!=(r=c(n,"itemName")||(null!=t?c(t,"itemName"):t))?r:l)?r.call(o,{name:"itemName",hash:{},data:a,loc:{start:{line:4,column:53},end:{line:4,column:65}}}):r)+'">\n    '+s("function"==typeof(r=null!=(r=c(n,"itemName")||(null!=t?c(t,"itemName"):t))?r:l)?r.call(o,{name:"itemName",hash:{},data:a,loc:{start:{line:5,column:4},end:{line:5,column:16}}}):r)+"\n  </div>\n</div>"},useData:!0})},b225:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <li class="list-item" data-id="'+c(s(null!=t?d(t,"id"):t,t))+'" data-index="'+c(s(o&&d(o,"index"),t))+'">\n            <div class="node-title">'+(null!=(l=a(n("fcbf")).call(u,null!=(l=null!=t?d(t,"node"):t)?d(l,"title"):l,"title",{name:"xss",hash:{},data:o,loc:{start:{line:9,column:36},end:{line:9,column:66}}}))?l:"")+'</div>\n            <div class="node-time">'+c(s(null!=(l=null!=t?d(t,"node"):t)?d(l,"standardTime"):l,t))+"  "+c(s(null!=(l=null!=(l=null!=t?d(t,"node"):t)?d(l,"location"):l)?d(l,"desc"):l,t))+'</div>\n            <div class="node-desc">'+(null!=(l=a(n("fcbf")).call(u,null!=(l=null!=t?d(t,"node"):t)?d(l,"desc"):l,"title","true",{name:"xss",hash:{},data:o,loc:{start:{line:11,column:35},end:{line:11,column:70}}}))?l:"")+"</div>\n        </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="detail-list-content-component '+(null!=(l=u(i,"if").call(s,null!=t?u(t,"active"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:42},end:{line:1,column:69}}}))?l:"")+'">\n    <div class="list-title">\n        <span>'+c(a(n("dfab")).call(s,"itemInfo","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:3,column:14},end:{line:3,column:43}}}))+'</span>\n        <div class="edit-icon editIcon"></div>\n    </div>\n    <ul class="list-content">\n'+(null!=(l=u(i,"each").call(s,null!=t?u(t,"timeMap"):t,{name:"each",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:7,column:8},end:{line:13,column:17}}}))?l:"")+'    </ul>\n    <div class="empty-content '+(null!=(l=a(n("d930")).call(s,null!=(l=null!=t?u(t,"timeMap"):t)?u(l,"length"):l,"<",1,{name:"ifcond",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:15,column:30},end:{line:15,column:79}}}))?l:"")+'">\n        '+c(a(n("dfab")).call(s,"noSpatioAdd","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:16,column:8},end:{line:16,column:40}}}))+"\n    </div>\n</div>"},useData:!0})},b231:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pubsub=void 0;var i=r(n("8827")),a=r(n("57ba"));function r(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,i.default)(this,e),this.handlers={},this.order=0}return(0,a.default)(e,[{key:"publish",value:function(e){if(this.handlers[e]&&this.handlers[e].length>0){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var a=0;a<this.handlers[e].length;a++){var r;(r=this.handlers[e][a]).handler.apply(r,n)}}}},{key:"subscribe",value:function(e,t){this.handlers.hasOwnProperty(e)||(this.handlers[e]=[]);var n=this.order++;return this.handlers[e].push({handler:t,order:n}),n}},{key:"unsubscribe",value:function(e){for(var t in this.handlers)for(var n=0;n<this.handlers[t].length;n++)if(this.handlers[t][n].order===e){this.handlers[t].splice(n,1);break}}}]),e}(),l=new o;t.default=l,t.Pubsub=o},b311:function(e,t,n){
/*!
 * clipboard.js v2.0.6
 * https://clipboardjs.com/
 * 
 * Licensed MIT © Zeno Rocha
 */
var i;i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t){e.exports=function(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var i=window.getSelection(),a=document.createRange();a.selectNodeContents(e),i.removeAllRanges(),i.addRange(a),t=i.toString()}return t}},function(e,t){function n(){}n.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function a(){i.off(e,a),t.apply(n,arguments)}return a._=t,this.on(e,a,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,a=n.length;i<a;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],a=[];if(i&&t)for(var r=0,o=i.length;r<o;r++)i[r].fn!==t&&i[r].fn._!==t&&a.push(i[r]);return a.length?n[e]=a:delete n[e],this}},e.exports=n,e.exports.TinyEmitter=n},function(e,t,n){var i=n(3),a=n(4);e.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!i.string(t))throw new TypeError("Second argument must be a String");if(!i.fn(n))throw new TypeError("Third argument must be a Function");if(i.node(e))return function(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}(e,t,n);if(i.nodeList(e))return function(e,t,n){return Array.prototype.forEach.call(e,(function(e){e.addEventListener(t,n)})),{destroy:function(){Array.prototype.forEach.call(e,(function(e){e.removeEventListener(t,n)}))}}}(e,t,n);if(i.string(e))return function(e,t,n){return a(document.body,e,t,n)}(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},function(e,t){t.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},t.nodeList=function(e){var n=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in e&&(0===e.length||t.node(e[0]))},t.string=function(e){return"string"==typeof e||e instanceof String},t.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},function(e,t,n){var i=n(5);function a(e,t,n,i,a){var o=r.apply(this,arguments);return e.addEventListener(n,o,a),{destroy:function(){e.removeEventListener(n,o,a)}}}function r(e,t,n,a){return function(n){n.delegateTarget=i(n.target,t),n.delegateTarget&&a.call(e,n)}}e.exports=function(e,t,n,i,r){return"function"==typeof e.addEventListener?a.apply(null,arguments):"function"==typeof n?a.bind(null,document).apply(null,arguments):("string"==typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return a(e,t,n,i,r)})))}},function(e,t){if("undefined"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}e.exports=function(e,t){for(;e&&9!==e.nodeType;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}},function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resolveOptions(t),this.initSelection()}return o(e,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.container=e.container,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=a()(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=a()(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),document.activeElement.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}(),s=n(1),c=n.n(s),u=n(2),d=n.n(u),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.resolveOptions(n),i.listenClick(e),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),h(t,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText,this.container="object"===m(e.container)?e.container:document.body}},{key:"listenClick",value:function(e){var t=this;this.listener=d()(e,"click",(function(e){return t.onClick(e)}))}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new l({action:this.action(t),target:this.target(t),text:this.text(t),container:this.container,trigger:t,emitter:this})}},{key:"defaultAction",value:function(e){return p("action",e)}},{key:"defaultTarget",value:function(e){var t=p("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return p("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach((function(e){n=n&&!!document.queryCommandSupported(e)})),n}}]),t}(c.a);function p(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}t.default=f}]).default},e.exports=i()},b54b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("3f6b")),a=c(n("633f")),r=c(n("8827")),o=c(n("158c")),l=c(n("57ba")),s=c(n("9918"));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return(0,i.default)(n,{onReady:function(){}},e),n}return(0,s.default)(t,e),(0,l.default)(t,[{key:"requireLibs",get:function(){return["/staticlib/qrcode/qrcode.min.js"]}}]),(0,l.default)(t,[{key:"init",value:function(){this.QRCode=QRCode}},{key:"onComponentMount",value:function(){this.onReady()}}]),t}(c(n("7790")).default.Component);t.default=u,e.exports=t.default},b5e2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("3f6b")),a=u(n("8827")),r=u(n("57ba")),o=u(n("5732")),l=u(n("5ab1"));n("05d2");var s=u(n("fe21")),c=u(n("1505"));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",info:{},active:!1},t),this._render(),this._loadCard(this.id)}return(0,r.default)(e,[{key:"_render",value:function(){var e=this;this.$container.empty(),this.$html=$((0,o.default)(this.info)),this.$container.append(this.$html),this._bind(),setTimeout((function(){e.showComponent()}))}},{key:"_bind",value:function(){this.$html.on("click",".linkItem",this._linkItemClick.bind(this))}},{key:"_loadCard",value:function(e){var t=this;e&&s.default.getIntro(e).then((function(e){t.entry=e.data})).then((function(e){var n=t.entry.moduleStat,i=[{name:_L_("summary"),type:"detail",available:!0},{name:_L_("relationGraphShortHand"),type:"relation",available:n.relation>0},{name:_L_("worksAndMedia"),type:"product",available:n.book+n.painting>0},{name:_L_("relatedArticle"),type:"article",available:n.article>0}],a=(0,l.default)({items:i});t.$html.find(".more-info").replaceWith(a)}))}},{key:"_linkItemClick",value:function(e){if(this.entry){var t=e.currentTarget.dataset.to;if(!t)return!1;if(!(e.currentTarget.className.indexOf("active")<0))switch(t){case"relation":c.default.showRelation(this.entry);break;case"detail":c.default.showSummary(this.entry);break;case"product":c.default.showProductMedia(this.entry);break;case"article":c.default.showArticle(this.entry)}}}},{key:"update",value:function(e){e&&((0,i.default)(this.info,e),this._render())}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}}]),e}();t.default=d,e.exports=t.default},bc8a:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return'    <div class="share hasText">分享</div>\n'},3:function(e,t,n,i,a){return'    <div class="share-text">扫一扫预览文章</div>\n    <div class="share"></div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o,l=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="dls-share-container">\n'+(null!=(r=s(n,"if").call(l,null!=t?s(t,"useText"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:2,column:4},end:{line:7,column:11}}}))?r:"")+'    <div class="qrcode '+e.escapeExpression("function"==typeof(o=null!=(o=s(n,"pos")||(null!=t?s(t,"pos"):t))?o:e.hooks.helperMissing)?o.call(l,{name:"pos",hash:{},data:a,loc:{start:{line:8,column:23},end:{line:8,column:30}}}):o)+'">\n        <div class="qrcode-con" id="share-qrcode">\n\n        </div>\n        <div class="share-to-weixin">\n            <div class="share-icon"></div><span>微信扫扫</span>\n        </div>\n        <div class="copy-href">\n            <div class="copy-icon"></div><span>复制链接</span>\n        </div>\n\n        <div class="new-href" data-clipboard-demo="" data-clipboard-action="copy" data-clipboard-text=""></div>\n    </div>\n</div>'},useData:!0})},bdd3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=l(n("9178"));function l(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this.timebar=t.timebar,this.ruler=this.timebar.ruler,(0,i.default)(this,{timebar:{}},t),this.ruler=this.timebar.ruler,this._render(),this._updateTime(),this._bind()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)()),this.timebar.$html.append(this.$html)}},{key:"_updateTime",value:function(e){var t=void 0;0==(t=e&&e.time?e.time:Math.floor(this.ruler.getTimeByPixel(this.ruler.centerPx)))&&(t=1);var n=t;t<0?n=Math.abs(t)+"BC":n+="AD",this.$html.find(".point-time")[0].innerText=n}},{key:"_bind",value:function(){var e=this;this.ruler.addEvent("change",(function(t,n){e._updateTime(n)}))}},{key:"hide",value:function(){this.$html.hide()}},{key:"show",value:function(){this.$html.show()}}]),e}();t.default=s,e.exports=t.default},c7be:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("41b2")),a=d(n("3f6b")),r=d(n("8827")),o=d(n("57ba")),l=d(n("6b8a"));n("9424");var s=d(n("4721")),c=d(n("03be")),u=n("cffa");function d(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t){var n=this;if((0,r.default)(this,e),this.events={change:[]},(0,a.default)(this,{tickTime:+new Date,tick:50,container:document.body,minYear:-5e3,maxYear:2500,minZoom:.5,maxZoom:10,minUnitWidth:8,maxUnitWidth:16,totalWidth:0,unitTime:10,zoomSpeed:.5,zoom:1,unitWidth:8,mousePos:{x:0,y:0,clientX:0,clientY:0},downTranslate:{x:0,y:0},translate:{x:0,y:0},bufferYears:{min:0,max:0},endOffsetPx:0,startOffsetPx:0,offsetAreaDuration:0,scalable:!0,draggable:!0,onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.events.change.forEach((function(t){t(n,e)}))},onRender:function(){},onAnimateFinish:function(){}},t),this.startUnitTime=this.unitTime,this.startUnitWidth=this.unitWidth,this.ratio=window.devicePixelRatio,this.totalTime=this.maxYear-this.minYear,this.createCanvas(),window.frameElement)return this.onChange=function(){},!1;this._resize(),this.updateTotalWidth(),this.updateBufferYears(),this.render(),this.bind()}return(0,o.default)(e,[{key:"createCanvas",value:function(){this.$html=$((0,l.default)()),this.canvas=document.createElement("canvas"),this.$html.append(this.canvas),this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.$html[0])}},{key:"_resize",value:function(){this.canvas.width=this.$html.width()*this.ratio,this.canvas.height=this.$html.height()*this.ratio,this.centerPx=this.$html.width()/2,this.canvas.style.transformOrigin="0 0",this.canvas.style.transform="scale("+(this.ratio,1/this.ratio+")"),this.render(),this.onChange({resize:!0})}},{key:"render",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.width),this.ctx.save(),this.ctx.scale(this.ratio,this.ratio),this.ctx.translate(this.translate.x,this.translate.y),this.drawUnit(),this.drawDisable(),this.ctx.restore(),this.onRender(this)}},{key:"updateTotalWidth",value:function(){this.totalWidth=this.unitWidth*((this.maxYear-this.minYear)/this.unitTime)}},{key:"updateBufferYears",value:function(){var e=this.getTimeByPixel(this.translate.x),t=this.getTimeByPixel(this.$html.width())-this.getTimeByPixel(0);this.bufferYears.min=this.getTimeByPixel(0)-t,this.bufferYears.max=this.getTimeByPixel(0)+2*t,this.zeroX=this.getXbyTime(0),this.renderStartX=(this.minYear-e-t)/this.unitTime*this.unitWidth}},{key:"drawUnit",value:function(){this.ctx.strokeStyle="#CAD2D6",this.ctx.fillStyle="#999999";var e=0;if(this.bufferYears.min<0)for(var t=0;t>this.bufferYears.min;t-=this.unitTime){var n=-(e+1)*this.unitWidth+this.zeroX,i=(e+1)%10==0;this.drawLine(n,i?20:10),i&&this.drawText(t-this.unitTime,n),e++}if(e=0,this.bufferYears.max>0)for(var a=1;a<this.bufferYears.max;a+=this.unitTime){var r=e*this.unitWidth+this.zeroX,o=e%10==0,l=a-1;1==a&&(l=a),this.drawLine(r,o?20:8),o&&this.drawText(l,r),e++}}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;e=Math.floor(e),this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.moveTo(e,0),this.ctx.lineTo(e,t),this.ctx.stroke(),this.ctx.closePath()}},{key:"drawDisable",value:function(){var e=this.$html.height();this.ctx.globalAlpha=.5,this.ctx.beginPath(),this.ctx.fillStyle="#999",this.ctx.rect(-this.translate.x,0,this.translate.x,e),this.ctx.fill(),this.ctx.closePath();var t=-this.translate.x+this.$html.width()-this.totalWidth;this.ctx.beginPath(),this.ctx.fillStyle="#999",this.ctx.rect(this.totalWidth,0,t,e),this.ctx.fill(),this.ctx.closePath()}},{key:"drawText",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:31,i=s.default.yearToMonth(e,"short-en"),a=Math.floor(e);"Jan."!=i&&(a+=" "+i),this.ctx.beginPath(),this.ctx.textAlign="center",this.ctx.fillText(a,Math.round(t),n+6),this.ctx.closePath()}},{key:"_fixOverFlowTranslate",value:function(e){e>this.centerPx-this.startOffsetPx?this.translate.x=this.centerPx-this.startOffsetPx:-e>this.totalWidth-this.centerPx-this.endOffsetPx?this.translate.x=-this.totalWidth+this.centerPx+this.endOffsetPx:this.translate.x=e}},{key:"getOffsetAreaDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.unitWidth,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.unitTime;return(this.startOffsetPx+this.endOffsetPx)/e*t}},{key:"getTimeByPixel",value:function(e){var t=(e-this.translate.x)/this.totalWidth*this.totalTime+this.minYear;return 0==Math.floor(t)&&(t=1),t}},{key:"getDateByPixel",value:function(e){var t=this.getTimeByPixel(e);return{year:Math.floor(t),month:s.default.yearToMonth(t)}}},{key:"getXbyTime",value:function(e){return(e-this.minYear)/this.totalTime*this.totalWidth}},{key:"getScreenXbyTime",value:function(e){var t=this.getXbyTime(e);return Math.round(t+this.translate.x)}},{key:"getAreaTime",value:function(){return{start:this.getTimeByPixel(this.centerPx-this.startOffsetPx),end:this.getTimeByPixel(this.centerPx+this.endOffsetPx)}}},{key:"setCenterByTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(i){var r=this.getOffsetAreaDuration();e-r/2<=this.minYear&&(e=this.minYear+r/2),e+r/2>=this.maxYear&&(e=this.maxYear-r/2)}var o=-this.getXbyTime(e)+this.centerPx;u.TweenLite.to(this.translate,t,{x:o,onUpdate:function(){n.updateBufferYears(),n.render(),a?a():n.onChange({time:e})}})}},{key:"setTimeByOffset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];1==e&&(e=0),1==t&&(t=0);var a=c.default.calcUnitBySelectedOffset(this,e,t),r=a.newUnitTime,o=a.newUnitWidth;this._zoomToSelectedOffset(e,t,r,o,n,i)}},{key:"setTimeByWidth",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.innerWidth,i=t-e;if(!(i<10)){var a=c.default.calcUnitBySelectedOffset(this,e,t,n),r=a.newUnitTime,o=a.newUnitWidth;this._zoomToSelectedOffset(e,t,r,o,0)}}},{key:"addEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"change",t=arguments[1];this.events[e].push(t)}},{key:"hide",value:function(){this.html.style.display="none"}},{key:"_zoomToSelectedOffset",value:function(e,t,n,i){var a=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments[5],l=e+(t-e)/2,s=this.getTimeByPixel(this.centerPx),c=l-s;u.TweenLite.to(this,r,{ease:u.Power0.easeNone,unitTime:n,unitWidth:i,onUpdateParams:["{self}"],onUpdate:function(e){var t=e.progress(),n=c*t+s;a.updateTotalWidth(),a.updateBufferYears(),a.setCenterByTime(n,0,!0,o),a.render(),o?o():a.onChange()}})}},{key:"_zoom",value:function(e){var t=this.unitWidth,n=this.unitTime;t+=e;var i=this.getTimeByPixel(this.centerPx),a=this.maxUnitWidth/this.minUnitWidth;t>this.maxUnitWidth&&(t=this.minUnitWidth,n=this.unitTime/a),t<this.minUnitWidth&&(t=this.maxUnitWidth,n=this.unitTime*a);var r=this.getOffsetAreaDuration(t,n);r>0&&r<=1||(this.unitTime=n,this.unitWidth=t,this.updateTotalWidth(),this.setCenterByTime(i),this._fixOverFlowTranslate(this.translate.x),this.updateBufferYears(),r>=this.maxYear-this.minYear&&this.setTimeByOffset(this.minYear,this.maxYear),this.render(),this.onChange(this))}},{key:"_mouseWheel",value:function(e){this.scalable&&(e.preventDefault(),e.originalEvent.deltaY<0?this._zoom(-this.zoomSpeed):this._zoom(this.zoomSpeed))}},{key:"_mousedown",value:function(){this.isMousedown=!0,this.mousedownPos={x:this.mousePos.x,y:this.mousePos.y},this.downTranslate=(0,i.default)({},this.translate)}},{key:"_mousemove",value:function(e){if(this.mousePos.x=e.clientX,this.mousePos.y=e.clientY,this.mousedownPos){if(!this.draggable)return;var t=this.mousePos.x-this.mousedownPos.x,n=this.downTranslate.x+t;this._fixOverFlowTranslate(n),this.updateBufferYears(),this.render(),this.onChange(this)}}},{key:"_mouseup",value:function(){this.mousedownPos=!1}},{key:"_mouseenter",value:function(e){this.$html.toggleClass("hover",!0)}},{key:"_mouseleave",value:function(e){this.$html.toggleClass("hover",!1)}},{key:"bind",value:function(){$(window).on("resize.timebar",this._resize.bind(this)),$(window).on("mousemove.dls-map-timebar",this._mousemove.bind(this)),$(window).on("mouseup.dls-map-timebar",this._mouseup.bind(this));var e=this.$html;e.on("mousewheel",this._mouseWheel.bind(this)),e.on("mousedown",this._mousedown.bind(this)),e.on("mouseenter",this._mouseenter.bind(this)),e.on("mouseleave",this._mouseleave.bind(this))}}]),e}();t.default=m,e.exports=t.default},c90c:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("3f6b")),a=c(n("8827")),r=c(n("57ba")),o=c(n("402f"));n("e896");var l=c(n("dc72")),s=c(n("7524"));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:$("body"),map:{},comps:{}},t),this._render(),this.addComponent()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)()),this.$container.append(this.$html)}},{key:"addComponent",value:function(){this.MapYearSelect=new s.default({map:this.map,comps:this.comps,$container:this.$html.find(".yearControlWrap")}),this.header=new l.default({$container:this.$html.find(".userInfoWrap")})}},{key:"showComponent",value:function(){this.$html.toggleClass("active",!0),this.active=!0}},{key:"hideComponent",value:function(){this.$html.toggleClass("active",!1),this.active=!1}}]),e}();t.default=u,e.exports=t.default},cec8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("3f6b")),a=u(n("8827")),r=u(n("57ba")),o=u(n("a1d3")),l=n("d99f"),s=n("a8a7"),c=u(n("1488"));function u(e){return e&&e.__esModule?e:{default:e}}n("3cc8");var d=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",active:!1,emptyBeforeAppend:!1,onChangeFilterTag:function(){},onDestroyed:function(){}},t),this.tagsArr=(0,l.getFilterTags)(),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){var e=this;if(this.$container){this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,o.default)({active:this.active,tagsArr:this.tagsArr,currentTags:this.currentTags})),this.$container.append(this.$html);var t=!1;this.tagsArr.forEach((function(e){!t&&e.data.find((function(e){return e.active}))&&(t=!0)})),this.switchBtn=new c.default({$container:this.$html.find(".switch-container"),title:_L_("showHumanEvents","timemap"),status:t,onChange:function(t){e.toggleFilterTags(t)}}),this._bind()}}},{key:"toggleFilterTags",value:function(e){this.tagsArr.forEach((function(t){t.data.forEach((function(t){t.active=e}))}));var t=this.getActiveTypes().split(",");(0,s.setStorageItem)("timeMapState","filterTags",t),this.$html.find(".filterItem .tagItem").toggleClass("active",e),this.onChangeFilterTag()}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".switchBtn",(function(e){$(e.currentTarget).parent().toggleClass("active")})),this.$html.on("click",".tagItem",(function(t){var n=$(t.currentTarget),i=n.parent().data("name"),a=""+n.data("tag-id");e.tagsArr.find((function(e){return e.name===i})).data.find((function(e){return e.id===a})).active=!n.hasClass("active"),n.toggleClass("active");var r=!1;e.tagsArr.forEach((function(e){!r&&e.data.find((function(e){return e.active}))&&(r=!0)})),e.$html.find(".switch-box").toggleClass("active",r);var o=e.getActiveTypes().split(",");(0,s.setStorageItem)("timeMapState","filterTags",o),e.onChangeFilterTag()}))}},{key:"getActiveTypes",value:function(){var e=[];return this.tagsArr.forEach((function(t){t.data.forEach((function(t){t.active&&e.push(t.id)}))})),e.join(",")}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"update",value:function(e){(0,i.default)(this,e),this._render()}},{key:"destroy",value:function(){this.$container&&this.$container.empty(),this.onDestroyed()}}]),e}();t.default=d,e.exports=t.default},cffa:function(e,t,n){"use strict";n.r(t);var i=n("2e20");n.d(t,"TweenLite",(function(){return i.default})),n.d(t,"TweenPlugin",(function(){return i.TweenPlugin})),n.d(t,"Ease",(function(){return i.Ease})),n.d(t,"Power0",(function(){return i.Power0})),n.d(t,"Power1",(function(){return i.Power1})),n.d(t,"Power2",(function(){return i.Power2})),n.d(t,"Power3",(function(){return i.Power3})),n.d(t,"Power4",(function(){return i.Power4})),n.d(t,"Linear",(function(){return i.Linear})),n.d(t,"_gsScope",(function(){return i._gsScope}));var a=n("f0e7");n.d(t,"TimelineLite",(function(){return a.a}));var r=n("2346");n.d(t,"TimelineMax",(function(){return r.a}));var o=n("109c");n.d(t,"default",(function(){return o.default})),n.d(t,"TweenMax",(function(){return o.default}));var l=n("9ce6");n.d(t,"CSSPlugin",(function(){return l.a}));var s=n("1e77");n.d(t,"AttrPlugin",(function(){return s.a}));var c=n("8c77");n.d(t,"RoundPropsPlugin",(function(){return c.a}));var u=n("2429");n.d(t,"DirectionalRotationPlugin",(function(){return u.a}));var d=n("4940");n.d(t,"BezierPlugin",(function(){return d.a}));var m=n("0a47");n.d(t,"Back",(function(){return m.a})),n.d(t,"Elastic",(function(){return m.d})),n.d(t,"Bounce",(function(){return m.b})),n.d(t,"RoughEase",(function(){return m.g})),n.d(t,"SlowMo",(function(){return m.i})),n.d(t,"SteppedEase",(function(){return m.j})),n.d(t,"Circ",(function(){return m.c})),n.d(t,"Expo",(function(){return m.e})),n.d(t,"Sine",(function(){return m.h})),n.d(t,"ExpoScaleEase",(function(){return m.f}))},d1f2:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l=null!=t?t:e.nullContext||{},s=e.escapeExpression;return'<div class="detail-list-page detailListPage">\n    <div class="components-container">\n        <div class="detail-list-header"></div>\n        <div class="detail-list-content"></div>\n        <div class="empty-territory-container emptyTerritoryContainer">\n            <div class="empty-content">\n                <div class="empty-title">\n                    '+s(a(n("dfab")).call(l,"notFindEntry","search",{name:"lang",hash:{},data:o,loc:{start:{line:8,column:20},end:{line:8,column:52}}}))+'“<span class="keyWordsName"></span>”\n                </div>\n                <div class="empty-tips">\n                    <div class="text">'+s(a(n("dfab")).call(l,"welcomeToCreate","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:11,column:38},end:{line:11,column:74}}}))+'</div>\n                    <div class="create-btn createBtn">'+s(a(n("dfab")).call(l,"IWillCreate","search",{name:"lang",hash:{},data:o,loc:{start:{line:12,column:54},end:{line:12,column:85}}}))+'</div>\n                </div>\n            </div>\n        </div>\n        <div class="right-info-container">\n            <div class="territory-info-container territoryInfoContainer"></div>\n        </div>\n    </div>\n</div>'},useData:!0})},d355:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("e1de")),a=h(n("41b2")),r=h(n("3f6b")),o=h(n("9b57")),l=h(n("8827")),s=h(n("57ba")),c=n("a7c7"),u=h(n("fe21")),d=h(n("c115")),m=h(n("3c3d"));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){var n=this;(0,l.default)(this,e),this.selectRegime=function(e){n._highlightCountry(e),n._showTerritoryInfo(e),n.removeMarker()},this.removeMarker=function(){n.currentMaker&&(n.map.removeMarkerById(n.currentMaker.id),n.currentMaker=null)},this._getAllMouseCountry=function(e,t){var i=t.country,a=t.countryCombCon,r=t.countryTop,l=[];if(i.length>0){var s=n.map.gl.queryRenderedFeatures(e,{layers:i});s.length>0&&l.push.apply(l,(0,o.default)(s))}if(a.length>0){var c=n.map.gl.queryRenderedFeatures(e,{layers:a});c.length>0&&l.push.apply(l,(0,o.default)(c))}if(r&&r.length>0){var u=n.map.gl.queryRenderedFeatures(e,{layers:r});u.length>0&&l.push.apply(l,(0,o.default)(u))}var d=[];l.forEach((function(e){-1===d.findIndex((function(t){return t.properties.title===e.properties.title}))&&d.push(e)}));var m=[];return d.forEach((function(e){e.properties.itemid_country&&m.push(e)})),m},(0,r.default)(this,{map:"",territoryInfo:"",territoryState:!0,hoverTerritoryOId:"",territoryDataObj:{},activeTerritoryOId:"",activeTerritoryLayerId:"",hoverTerritoryLayerId:"",hoverCountry:!1,fitBoundsList:{},onDestroyed:function(){}},t),this.map&&this.territoryInfo&&(this.map.onYearChange.push((function(){n._handleYearChange()})),this.map.onHideMapYears.push({name:"closeTerritoryInfo",fn:function(){n._handleYearChange()}}),this._bind())}return(0,s.default)(e,[{key:"_bind",value:function(){var e=this;this.map.on("click.country",(function(t){if(!(c.MAB_STATE.get("markerClickState")||c.MAB_STATE.get("defMeasureDistanceState")||c.MAB_STATE.get("defMeasureAreaState")||c.MAB_STATE.get("sketchEditingState")||c.MAB_STATE.get("sketchClickState")||c.MAB_STATE.get("EntryCardOpened")||c.MAB_STATE.get("multiMarkerBgOpened"))){var n=e.map.getAllLayers(),i=e._getAllMouseCountry(t.point,n);if(e.removeMarker(),i.length>0)if(1===i.length)e._highlightCountry(i[0]),e._showTerritoryInfo(i[0]);else{var r=i.map((function(e){return(0,a.default)({},e.properties)})),o=t.lngLat,l={id:""+Math.floor(1e9*Math.random()),lngLat:o},s=document.createElement("div");s.classList=["regime-list"];var u=$(s);u.attr("data-mid",l.id).attr("data-type","regimeList").addClass("go-see"),e.regimesMarker=new m.default({$container:u,active:!0,regimes:r,featureArr:i,onMarkerClick:function(t){e.selectRegime(t)}});var d=null;e.map&&(d=e.map.addMarker({element:s,point:l.lngLat,id:l.id,data:{}})),l.marker=d,e.currentMaker=l}else e._hideTerritoryInfo()}})),this.map.on("mousemove.country",(function(t){if(!c.MAB_STATE.get("sketchEditingState")){e.mouseMoveTimer=null;var n=e.map.getAllLayers(),i=e._getTheMouseCountry(t.point,n);i&&i.properties.itemid_country?e._highlightCountry(i):e._highlightActiveCountry()}})),$("body").off("click.shouldCloseTerritoryInfo").on("click.shouldCloseTerritoryInfo",(function(t){$(".territoryComponent:hover").length>0||$(".mapboxgl-canvas:hover").length>0||$(".mcanvas:hover").length>0||e._hideTerritoryInfo()}))}},{key:"_getTheMouseCountry",value:function(e,t){var n=t.country,i=t.countryCombCon,a=t.countryTop;if(n.length>0){var r=this.map.gl.queryRenderedFeatures(e,{layers:n});if(r.length>0)return r[0]}if(i.length>0){var o=this.map.gl.queryRenderedFeatures(e,{layers:i});if(o.length>0)return o[0]}if(a.length>0){var l=this.map.gl.queryRenderedFeatures(e,{layers:a});if(l.length>0)return l[0]}return null}},{key:"_hideTerritoryInfo",value:function(){this.territoryInfo&&this.territoryInfo.hideComponent(),this.removeMarker(),this.handleCloseTerritoryInfo()}},{key:"_highlightActiveCountry",value:function(){var e=this.hoverTerritoryLayerId,t=this.hoverTerritoryOId,n=[];if(this.activeTerritoryOId&&n.push(this.activeTerritoryOId),e&&t){var i=e.split("-")[0],a={hoverIdArr:[i+"-country_top_hover"],borderHoverIdArr:[i+"-countryborder_hover",i+"-country_comb_line_hover",i+"-country_top_border_hover"]};this._activeHoverCountries(a,n)}}},{key:"_handleYearChange",value:function(){this.territoryInfo&&this.territoryInfo.hideComponent()}},{key:"_highlightCountry",value:function(e){var t=e.layer.id,n=e.properties.oid,i=[n];this.activeTerritoryOId&&this.activeTerritoryOId!==n&&i.push(this.activeTerritoryOId);var a=e.properties.itemid_country;if(a){if(JSON.parse(a)[0]||""){var r=t.split("-")[0],o={hoverIdArr:[r+"-country_top_hover"],borderHoverIdArr:[r+"-countryborder_hover",r+"-country_comb_line_hover",r+"-country_top_border_hover"]};this._activeHoverCountries(o,i)}this.hoverTerritoryOId=n,this.hoverTerritoryLayerId=t}}},{key:"_showTerritoryInfo",value:function(e){var t=this,n=e.properties.oid,i=e.layer.id,a=e.properties.itemid_country;if(a){var r=JSON.parse(a)[0]||"";n&&r&&this._getTerritoryDataObj(n,r).then((function(e){if(e){t.activeTerritoryOId=n,t.activeTerritoryLayerId=i,t.territoryInfo.updateInfo(e);var a=i.split("-")[0],r={hoverIdArr:[a+"-country_top_hover"],borderHoverIdArr:[a+"-countryborder_hover",a+"-country_comb_line_hover",a+"-country_top_border_hover"]};t._activeHoverCountries(r,[n])}})).catch((function(e){}))}}},{key:"_getTerritoryDataObj",value:function(e,t){var n=this;return new i.default((function(i,a){n.territoryDataObj[e]?i(n.territoryDataObj[e]):u.default.getSimpleIntro(t).then((function(t){if(200===t.code){var r=t.data;n.territoryDataObj[e]=r,i(n.territoryDataObj[e])}else a()})).fail((function(e){a()}))}))}},{key:"fitBoundsCountry",value:function(e,t){var n=this,i=.3*$("body").width();if(i=i<480?480:i,i+=100,e=""+e,this.fitBoundsList[e]){if(this.fitBoundsList[t]){var a=this.fitBoundsList[t].coordinates,r={top:200,bottom:200,left:i,right:100};this.map.gl.fitBounds(a,{padding:r,maxZoom:10})}}else d.default.getFitBoundsByYear(e,!1).then((function(a){if(200===a.code){var r=a.data.envelope;if(n.fitBoundsList[e]=r,r[t]){var o=r[t].coordinates,l=n.getBoundBox(o),s={top:200,bottom:200,left:i,right:100};n.map.gl.fitBounds(l,{padding:s,maxZoom:10})}}}))}},{key:"getBoundBox",value:function(e){var t=[],n=[],i=[];return e.forEach((function(e){i.push.apply(i,(0,o.default)(e))})),i.forEach((function(e){(!t[0]||t[0]<e[0])&&(t[0]=e[0]),(!t[1]||t[1]<e[1])&&(t[1]=e[1]),(!n[0]||n[0]>e[0])&&(n[0]=e[0]),(!n[1]||n[1]>e[1])&&(n[1]=e[1])})),[n,t]}},{key:"activeSpecialTerritory",value:function(e){this.activeTerritoryOId=e}},{key:"_emitMouseLeaveCountry",value:function(e,t){this.activeTerritoryOId?t!==this.activeTerritoryOId&&this.map.gl.setFilter(e,["==","oid",this.activeTerritoryOId]):this.map.gl.setFilter(e,["==","oid",""])}},{key:"handleCloseTerritoryInfo",value:function(){var e=this.activeTerritoryLayerId;if(e){this.activeTerritoryLayerId="",this.activeTerritoryOId="";var t=e.split("-")[0],n={hoverIdArr:[t+"-country_top_hover"],borderHoverIdArr:[t+"-countryborder_hover",t+"-country_comb_line_hover",t+"-country_top_border_hover"]};this._inactiveHoverCountries(n)}}},{key:"_activeHoverCountries",value:function(e,t){var n=e.hoverIdArr,i=e.borderHoverIdArr,a=this.map.gl;[].concat((0,o.default)(n),(0,o.default)(i)).forEach((function(e){a.getLayer(e)&&a.setFilter(e,["in","oid"].concat((0,o.default)(t)))}))}},{key:"_inactiveHoverCountries",value:function(e){var t=e.hoverIdArr,n=e.borderHoverIdArr,i=this.map.gl;[].concat((0,o.default)(t),(0,o.default)(n)).forEach((function(e){i.getLayer(e)&&i.setFilter(e,["==","oid",""])}))}},{key:"activeCountryState",value:function(e,t){this.map.gl.getLayer(e)&&this.map.gl.setFilter(e,["in","oid"].concat((0,o.default)(t)))}},{key:"inactiveCountryState",value:function(e){this.map.gl.getLayer(e)&&this.map.gl.setFilter(e,["==","oid",""])}},{key:"activeCountryCombState",value:function(e,t,n){this.map.gl.getLayer(e)&&(this.map.gl.setFilter(e,["in","oid"].concat((0,o.default)(n))),this.map.gl.setFilter(t,["in","oid"].concat((0,o.default)(n))))}},{key:"inactiveCountryCombState",value:function(e,t){this.map.gl.getLayer(e)&&(this.map.gl.setFilter(e,["==","oid",""]),this.map.gl.setFilter(t,["==","oid",""]))}},{key:"activeCountryTopState",value:function(e,t,n){this.map.gl.getLayer(e)&&(this.map.gl.setFilter(e,["in","oid"].concat((0,o.default)(n))),this.map.gl.setFilter(t,["in","oid"].concat((0,o.default)(n))))}},{key:"inactiveCountryTopState",value:function(e,t){this.map.gl.getLayer(e)&&(this.map.gl.setFilter(e,["==","oid",""]),this.map.gl.setFilter(t,["==","oid",""]))}},{key:"_removeFunFromList",value:function(e){var t=this.map.onHideMapYears.findIndex((function(t){return t.name===e}));-1!==t&&this.map.onHideMapYears.splice(t,1)}},{key:"destroy",value:function(){this.map.off("click.country"),this.map.off("mousemove.country"),this._handleYearChange=function(){},this._removeFunFromList("closeTerritoryInfo"),this.onDestroyed()}}]),e}();t.default=f,e.exports=t.default},d37c:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r,o=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <li class="book-item" style="background-image: url(\''+e.escapeExpression(e.lambda(null!=t?l(t,"cover"):t,t))+'\')">\n        <div class="book-cover">\n          <div class="line">\n            '+(null!=(r=l(n,"if").call(o,null!=t?l(t,"title"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:12},end:{line:7,column:145}}}))?r:"")+"\n            "+(null!=(r=l(n,"if").call(o,null!=t?l(t,"author"):t,{name:"if",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a,loc:{start:{line:8,column:12},end:{line:8,column:69}}}))?r:"")+"\n          </div>\n        </div>\n      </li>\n"},2:function(e,t,i,r,o){var l=null!=t?t:e.nullContext||{},s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<p class="name" title="'+s(a(n("fcbf")).call(l,null!=t?c(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:7,column:48},end:{line:7,column:69}}}))+'">'+s(a(n("dfab")).call(l,"theBookNameWidthColon","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:7,column:71},end:{line:7,column:113}}}))+s(a(n("fcbf")).call(l,null!=t?c(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:7,column:113},end:{line:7,column:134}}}))+"</p>"},4:function(e,t,n,i,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<p class="author">作者：'+e.escapeExpression(e.lambda(null!=t?r(t,"author"):t,t))+" </p>"},6:function(e,t,i,r,o){var l,s=e.escapeExpression,c=null!=t?t:e.nullContext||{},u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <li class="book-item index-'+s(e.lambda(null!=t?u(t,"iCount"):t,t))+'">\n        <div class="book-title">\n          <span class="short-title">\n            '+s(a(n("d558")).call(c,null!=t?u(t,"title"):t,50,!1,{name:"substr",hash:{},data:o,loc:{start:{line:19,column:12},end:{line:19,column:37}}}))+'\n          </span>\n        </div>\n        <div class="book-cover">\n          <div class="line">\n            '+(null!=(l=u(i,"if").call(c,null!=t?u(t,"title"):t,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:24,column:12},end:{line:24,column:145}}}))?l:"")+"\n            "+(null!=(l=u(i,"if").call(c,null!=t?u(t,"author"):t,{name:"if",hash:{},fn:e.program(4,o,0),inverse:e.noop,data:o,loc:{start:{line:25,column:12},end:{line:25,column:69}}}))?l:"")+"\n          </div>\n        </div>\n      </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="book-slide">\n  <a target="_Blank"  href="/book/detail?id='+e.escapeExpression(e.lambda(null!=t?o(t,"id"):t,t))+'&from=product">\n'+(null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"cover"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(6,a,0),data:a,loc:{start:{line:3,column:4},end:{line:32,column:11}}}))?r:"")+"  </a>\n</div>"},useData:!0})},d558:function(e,t,n){"use strict";var i=r(n("2f20")),a=r(n("e2d7"));function r(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"content",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"false";return n?(0,a.default)(i.default.subStr(e,t,!n),r,o):i.default.subStr(e,t,!n)}},d88e:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){return'<div class="map-entry-comp-pop-box pop-box-mask pop-loading">\n  <div class="pop-content hidden">\n    <div class="icon-close-big pop-close"></div>\n  </div>\n</div>'},useData:!0})},d930:function(e,t,n){"use strict";var i,a=n("1098"),r=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e,t,n,i){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");var a={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},"&&":function(e,t){return e&&t},"||":function(e,t){return e||t},typeof:function(e,t){return(void 0===e?"undefined":(0,r.default)(e))==t},in:function(e,t){return Array.isArray(t)&&t.includes(e)||"string"==typeof t&&t.split(" ").includes(e)}};if(!a[t])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+t);var o=a[t](e,n);return o?i.fn(this):i.inverse(this)}},d99f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFilterTags=t.initFilterTags=void 0;var i=n("a7c7"),a=n("a8a7");t.initFilterTags=function(){var e=[{name:"human",text:_L_("person","timemap"),id:"",active:!0,data:[{name:_L_("litterateur","timemap"),id:"170",active:!0,iconClassName:"person-litterateur"},{name:_L_("SocialFigure","timemap"),id:"116",active:!0,iconClassName:"person-social"},{name:_L_("IndustryFigures","timemap"),id:"120",active:!0,iconClassName:"person-industry"},{name:_L_("artist","timemap"),id:"186",active:!0,iconClassName:"person-artist"},{name:_L_("naturalist","timemap"),id:"54",active:!0,iconClassName:"person-naturalist"},{name:_L_("ReligiousFigure","timemap"),id:"94",active:!0,iconClassName:"person-religious"},{name:_L_("sociologist","timemap"),id:"169",active:!0,iconClassName:"person-sociologist"},{name:_L_("MilitaryFigure","timemap"),id:"81",active:!0,iconClassName:"person-military"},{name:_L_("politician","timemap"),id:"115",active:!0,iconClassName:"person-politician"}]},{name:"events",text:_L_("Events","timemap"),id:"",active:!1,data:[{name:_L_("MilitaryEvent","timemap"),id:"83",active:!0,iconClassName:"events-military"},{name:_L_("PoliticalEvent","timemap"),id:"124",active:!0,iconClassName:"events-politician"},{name:_L_("SocialEvent","timemap"),id:"125",active:!0,iconClassName:"events-social"}]}],t=(0,a.getStorageItem)("timeMapState","filterTags",["170","116","120","186","54","94","169","81","115","83","124","125"]);e.forEach((function(e){e.data.forEach((function(e){e.active=t.includes(e.id)}))})),i.MAB_STATE.update("filterTags",e)},t.getFilterTags=function(){return i.MAB_STATE.get("filterTags")}},dc72:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("3f6b")),a=c(n("8827")),r=c(n("57ba")),o=c(n("9574"));n("a256");var l=c(n("6e9c")),s=c(n("1b6c"));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,show:!0,userInfo:null,langs:["zh"],onDestroyed:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){var e=this;this.$container&&(this.$html=$((0,o.default)({show:this.show})),this.emptyBeforeAppend&&this.$container.empty(),this.$container.append(this.$html),this.$languages=new l.default({$container:this.$html.find(".languagesContainer"),langs:this.langs,onDestroyed:function(){e.$languages=null}}),this.$userInfo=new s.default({$container:this.$html.find(".userInfoContainer"),userInfo:this.userInfo,redirectUrl:this.userInfo?"":encodeURIComponent(window.location.href),onDestroyed:function(){e.$userInfo=null},onLogout:function(){e.userInfo=null,window.userInfo=null,e.$userInfo.update({userInfo:e.userInfo,redirectUrl:encodeURIComponent(window.location.href)})}}),this._bind())}},{key:"showComponent",value:function(){this.show=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.show=!1,this.$html.removeClass("active")}},{key:"_bind",value:function(){}},{key:"destroy",value:function(){this.$container&&(this.$container.empty(),this.onDestroyed())}}]),e}();t.default=u,e.exports=t.default},dc97:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=x(n("b24f")),a=x(n("633f")),r=x(n("8827")),o=x(n("57ba")),l=x(n("158c")),s=x(n("9918")),c=x(n("27f1")),u=x(n("0319")),d=x(n("86be")),m=x(n("cec8")),h=x(n("944a")),f=x(n("5b16")),p=x(n("e93f")),v=n("a7c7"),y=n("ee78"),g=n("0280"),k=n("098c"),b=x(n("d355")),_=n("a8a7"),C=n("97a7"),w=n("2cc3"),M=x(n("f1f1"));function x(e){return e&&e.__esModule?e:{default:e}}var P=function(e){function t(e){(0,r.default)(this,t),e.showComps=["searchBoxComponent","markersComponent"];var n=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));return n.POI_LENGTH=40,n.emptyBeforeAppend=!0,n.mabState=v.MAB_STATE,n.$container=$(".pageContainer"),n.changeMapRangeTimer=null,n.POP_UP_RULES=[{pointName:"p1",avoidElements:[{selector:".searchContainer",direction:"y",isIncrease:!0,keyPoint:"p3"},{selector:".filterContainer",direction:"x",isIncrease:!0,keyPoint:"p3"}]},{pointName:"p2",avoidElements:[{selector:".mapTopRightContainer",direction:"y",isIncrease:!0,keyPoint:"p4"},{selector:".territoryInfoContainer",direction:"x",isIncrease:!1,keyPoint:"p4"}]},{pointName:"p3",avoidElements:[{selector:".mapBottomRightContainer",direction:"x",isIncrease:!1,keyPoint:"p1"}]}],n}return(0,s.default)(t,e),(0,o.default)(t,[{key:"getScreenLngRange",value:function(){var e=$("body").width();return{startLng:this.map.gl.unproject([0,0]).lng,endLng:this.map.gl.unproject([e,0]).lng}}},{key:"onPageMount",value:function(){var e=this;this.comps.timebar.update({type:"area",scalable:!0,draggable:!0,showDivision:!0}),this.timeController=this.comps.timebar.controller,this.$html=$((0,u.default)()),this.emptyBeforeAppend&&this.$container.empty(),this.$container.append(this.$html),this.searchBoxComponent=this.comps.searchBoxComponent,this.searchBoxComponent.update({$container:this.$html.find(".searchContainer"),active:!0,emptyBeforeAppend:!0}),this.filterComponent=new m.default({$container:this.$html.find(".filterContainer"),active:!1,onChangeFilterTag:function(){e._hideEntryCard(),e._filterRecommendData()},onDestroyed:function(){e.filterComponent=null}}),this._initPeriods(),this.territoryInfo=new p.default({$container:this.$html.find(".territoryInfoContainer"),emitCloseTerritoryInfo:function(){e.territory.handleCloseTerritoryInfo()},onDestroyed:function(){e.territoryInfo=null}}),this.territory=new b.default({map:this.map,territoryInfo:this.territoryInfo,onDestroyed:function(){e.territory=null}}),this.randomPeriods=new f.default({$container:$("body").find(".timebar-width-division"),comps:this.comps,showPeriodsCard:function(){e.showPeriodsCard()},afterRandomPeriods:function(t){e.afterRandomPeriods(t)}}),setTimeout((function(){e.randomPeriods.showComponent()}),0),this.markersComponent=this.comps.markersComponent,this.markersComponent.update({handleSingleMarkerClick:function(t,i){i||(e._hideEntryCard(),e._closeMultiMarker(),$(".mapMarker.active").removeClass("active")),(0,g.activeMarkerClickState)(),e.mabState.update("isMovingMapForEntryCard",!0);var a={x:-1e3,y:-1e3};if(i){var r=$("[data-mid="+t.id+"]").offset();a={x:r.left,y:r.top}}else{var o=e.getScreenLngRange(),l=o.startLng,s=o.endLng;if(t.location[0]>=l&&t.location[0]<=s)a=e.map.gl.project(t.location);else{var c=void 0;c=t.location[0]<l?(c=t.location[0]+360*Math.ceil((l-t.location[0])/360))>s?t.location[0]:c:(c=t.location[0]-360*Math.ceil((t.location[0]-s)/360))<l?t.location[0]:c,a=e.map.gl.project([c,t.location[1]])}}e.entryCard&&e.entryCard.isAlive&&e.entryCard.destroy();var u=(0,C.setUrlParams)(t.imgUrl||n("fac8"),{w:90,h:108}),d={id:t.id,avatar:u,name:t.itemName,desc:t.data.summary,node:{title:t.data.node.title,desc:t.data.node.desc,year:t.year,yearDesc:(0,w.getYearStrFromNum)(t.year),locationDesc:t.data.node.location.desc,itemId:t.data.itemId}};v.MAB_STATE.update("EntryCardOpened",!0),e.entryCard=new h.default({$container:e.$html.find(".pluginsContainer"),active:!0,data:d,emitNavigateToDetail:function(){},hideEntryCard:function(t){e.markersComponent.inActiveMarker(t)},onDestroyed:function(e){setTimeout((function(){v.MAB_STATE.update("EntryCardOpened",!1)}),320)}});var m=(0,y.getMoveDataBeforeShowEntryCard)({map:e.map.gl,point:a,cardHeight:e.entryCard.getCardHeight(),cardWidth:e.entryCard.getCardWidth(),rules:e.POP_UP_RULES}),f=m.shouldMove,p=m.center;if(f){var k=e.map.gl.getZoom();e.map.flyToPoint({center:p,zoom:k})}setTimeout((function(){e.mabState.update("isMovingMapForEntryCard",!1),e.markersComponent.activeMarker(t.id);var n={x:-1e3,y:-1e3};if(i){var a=$("[data-mid="+t.id+"]").offset();n={x:a.left,y:a.top}}else{var r=e.getScreenLngRange(),o=r.startLng,l=r.endLng;if(t.location[0]>=o&&t.location[0]<=l)n=e.map.gl.project(t.location);else{var s=void 0;s=t.location[0]<o?(s=t.location[0]+360*Math.ceil((o-t.location[0])/360))>l?t.location[0]:s:(s=t.location[0]-360*Math.ceil((t.location[0]-l)/360))<o?t.location[0]:s,n=e.map.gl.project([s,t.location[1]])}}e.entryCard.updatePosition(n,i)}),f?200:0)},handleMultiMarkerClick:function(){(0,g.activeMarkerClickState)(),e.markersComponent.inActiveAllMarkers(),e._hideEntryCard()}}),this._bind()}},{key:"_updateTimeBarTimeArea",value:function(e){var t=e.start,n=e.end;!t||!n||t>n||(this.timeController.ruler.setTimeByOffset(t,n,.3,(function(){})),this.timeController.updateTime(t,n))}},{key:"showPeriodsCard",value:function(){this.periods&&this.periods.update({active:!0,showCloseBtn:!0})}},{key:"afterRandomPeriods",value:function(e){e=e+1+"",this.changePeriods(e)}},{key:"_initPeriods",value:function(){var e=this,t=(0,_.getStorageItem)("timeMapState","pId");if(t){this.comps.timebar.showComponent(),this.comps.topRightComponent.showComponent(),this.mabState.updateIn(["home","periodId"],t);var n=(0,_.getStorageItem)("timeMapState","timeBarArea",{start:0,end:0}),i=n.start,a=n.end;this._updateTimeBarTimeArea({start:i,end:a}),setTimeout((function(){e._slideSearchContainer(),e._slideFilterComponent(),e._slideBottomRightComponent()}),20)}this.periods=new d.default({$container:this.$html.find(".pluginsContainer"),active:!t,selectPeriod:function(t){e.changePeriods(t),e.comps.topRightComponent.showComponent(),e.comps.timebar.showComponent(),e._slideSearchContainer(),e._slideFilterComponent(),e._slideBottomRightComponent()}})}},{key:"changePeriods",value:function(e){(0,_.setStorageItem)("timeMapState","pId",e),this.mabState.updateIn(["home","periodId"],e);var t=(0,k.getPeriodTimeArea)({periodId:e}),n=t.start,i=t.end;this._updateTimeBarTimeArea({start:n,end:i}),this._getRecommendData()}},{key:"_slideSearchContainer",value:function(){this.$html.find(".searchContainer").addClass("active")}},{key:"_slideFilterComponent",value:function(){this.filterComponent.showComponent()}},{key:"_slideBottomRightComponent",value:function(){this.comps.bottomRightComponent.showComponent()}},{key:"_hideEntryCard",value:function(){this.entryCard&&this.entryCard.isAlive&&this.entryCard.destroy()}},{key:"_bind",value:function(){var e=this;this.map.on("dragend.recommend",(function(t){if(!e.mabState.get("isMovingMapForEntryCard")){var n=t.originalEvent||{x:0,y:0},i=n.x,a=n.y,r=Math.abs(i-e.dragstartPosition.x),o=Math.abs(a-e.dragstartPosition.y);r<8&&o<8||(e.changeMapRangeTimer&&clearTimeout(e.changeMapRangeTimer),e.changeMapRangeTimer=setTimeout((function(){e._checkRecommendPosition()}),500))}})),this.map.on("dragstart.entryCard",(function(t){var n=t.originalEvent||{x:0,y:0},i=n.x,a=n.y;e.dragstartPosition={x:i,y:a},e.mabState.get("isMovingMapForEntryCard")||e._hideEntryCard(),e.markersComponent.inActiveAllMarkers()})),this.map.on("zoomstart.entryCard",(function(t){e.mabState.get("isMovingMapForEntryCard")||e._hideEntryCard(),e.markersComponent.inActiveAllMarkers()})),this.map.on("zoomend.recommend",(function(t){e.mabState.get("isMovingMapForEntryCard")||(e.changeMapRangeTimer&&clearTimeout(e.changeMapRangeTimer),e.changeMapRangeTimer=setTimeout((function(){e._checkRecommendPosition()}),500))})),this.comps.timebar.onChange=function(){var t=e.comps.timebar.ruler.getAreaTime().end;e.map.setYear(Math.round(t),"left"),e._handleTimeChangeForRecommend(),e._hideEntryCard()},window.onbeforeunload=function(){var t=e._getTimeBarArea(),n=t.start,i=t.end;(0,_.setStorageItem)("timeMapState","timeBarArea",{start:n,end:i})},$("body").off("mousedown.multiMarkerAndEntryCardAtHome").on("mousedown.multiMarkerAndEntryCardAtHome",(function(t){var n=$(t.target),i=e.mabState.get("entryCompCardsState"),a=e.mabState.get("multiMarkerIsOpening");!i&&!a&&n.parents(".mapMarker").length<1&&n.parents(".entryCardComponent").length<1&&(e._hideEntryCard(),e._closeMultiMarker(),$(".mapMarker.active").removeClass("active"))}))}},{key:"_closeMultiMarker",value:function(){this.markersComponent&&this.markersComponent.closeMultiMarker()}},{key:"_checkRecommendPosition",value:function(){var e=this.markersComponent.getAllRecommendMarkers(),t=this._getWindowRectPoints(),n=(0,i.default)(t,2),a=(0,i.default)(n[0],2),r=a[0],o=a[1],l=(0,i.default)(n[1],2),s=l[0],c=l[1],u=1,d=-15,m=[];e.forEach((function(e){var t=$(".mapMarker [data-mid="+e.id+"]").offset(),n=t.top,i=t.left;n-=u,((i-=d)<=r||i>=s||n<=o||n>=c)&&m.push(e.id)}));var h=e.length-m.length;(m.length>0||h<this.POI_LENGTH)&&(this.markersComponent.removeRecommendMarkerByIds(m),this._updateRecommendData())}},{key:"_getMarkerLength",value:function(e,t){var n=0;return e.forEach((function(e){-1===t.indexOf(e.id)&&(n+=e.isCluster?e.allChild.length:1)})),n}},{key:"_getTimeBarArea",value:function(){var e=this.comps.timebar.ruler.getAreaTime(),t=e.start,n=e.end;return{start:t=Math.round(t),end:n=Math.round(n)}}},{key:"_handleTimeChangeForRecommend",value:function(){var e=this;this.timeBarTimer&&clearTimeout(this.timeBarTimer),this.timeBarTimer=setTimeout((function(){e._filterRecommendData()}),500)}},{key:"_getTimeMapNodeRecommendParams",value:function(){var e=this._getTimeBarArea(),t=e.start,n=e.end,i=this._getWindowRectPoints(),a=this.map.gl.unproject(i[0]),r=a.lat,o=a.lng;o-=180*parseInt(o/180);var l=this.map.gl.unproject(i[1]),s=l.lat,c=l.lng;return{start:t,end:n,x1:r,y1:o,x2:s,y2:c-=180*parseInt(c/180),type:this.filterComponent.getActiveTypes()}}},{key:"_filterRecommendData",value:function(){var e=this,t=this._getTimeMapNodeRecommendParams();M.default.getTimeMapNodeRecommend(t).then((function(t){if(200===t.code){var n=t.data||[];e.recommendData=n;var i=e._handleRecommendMarkers(n);e.markersComponent.changeRecommendMarkers(i)}}))}},{key:"_getRecommendData",value:function(){var e=this,t=this._getTimeMapNodeRecommendParams();M.default.getTimeMapNodeRecommend(t).then((function(t){if(200===t.code){var n=t.data||[];e.recommendData=n;var i=e.markersComponent.getAllRecommendMarkers(),a=[];i.forEach((function(e){a.push(e.id)})),e.markersComponent.removeRecommendMarkerByIds(a);var r=e._handleRecommendMarkers(n);e.markersComponent.createRecommendMarkers(r)}}))}},{key:"_handleRecommendMarkers",value:function(e){var t=[];return e.forEach((function(e){var n=e.id,i=e.imgUrl,a=e.itemName,r=e.summary,o=e.source,l=o.type,s=o.year,c=o.location,u=o.itemId,d=o.node,m=(0,g.getIconClassName)(l,"default-icon");t.push({id:n,imgUrl:i,itemName:a,location:c,year:s,types:l,iconClassName:m,data:{itemId:u,summary:r,node:d}})})),t}},{key:"_updateRecommendData",value:function(){var e=this,t=this._getTimeMapNodeRecommendParams();M.default.getTimeMapNodeRecommend(t).then((function(t){if(200===t.code){var n=t.data||[];e.recommendData=n;var i=e.markersComponent.getAllRecommendMarkers(),a=[],r=[];if(i.forEach((function(e){e.isCluster?e.allChild.forEach((function(e){a.push(e.properties.id),e.properties.originalNode.data&&e.properties.originalNode.data.itemId&&r.push(e.properties.originalNode.data.itemId)})):(a.push(e.id),e.itemId&&r.push(e.itemId))})),i.length<e.POI_LENGTH){var o=n.filter((function(e){return-1===a.indexOf(e.id)&&(!e.source.itemId||-1===r.indexOf(e.source.itemId))})),l=e._handleRecommendMarkers(o);e.markersComponent.replenishMarkers(l)}}}))}},{key:"_getWindowRectPoints",value:function(){var e=document.querySelector(".mapBoxGlMap").getBoundingClientRect();return[[e.x,e.y],[e.x+e.width,e.y+e.height]]}},{key:"onPageExit",value:function(){this.map.off("dragend.recommend"),this.map.off("zoomend.recommend"),this.map.off("zoomstart.entryCard"),this.map.off("dragstart.entryCard"),$("body").off("mousedown.multiMarkerAndEntryCardAtHome"),this.randomPeriods.destroy(),this.comps.markersComponent.removeAllRecommendMarkers(),this.territory.destroy(),this.comps.timebar.onChange=function(){},window.onbeforeunload=function(){},v.MAB_STATE.update("EntryCardOpened",!1)}}]),t}(c.default);t.default=P,e.exports=t.default},ddd0:function(e,t,n){},de27:function(e,t,n){},df0e:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){return"selected"},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="recommend-component" '+(null!=(l=u(i,"if").call(s,null!=t?u(t,"active"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:33},end:{line:1,column:60}}}))?l:"")+'>\n    <div class="recommend">\n        <div class="tabs">\n            <div class="tab-item inactive '+(null!=(l=a(n("d930")).call(s,null!=t?u(t,"recommendType"):t,"==","TIME",{name:"ifcond",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:4,column:42},end:{line:4,column:98}}}))?l:"")+'" data-id="TIME">'+c(a(n("dfab")).call(s,"sameTime","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:4,column:115},end:{line:4,column:146}}}))+'</div>\n            <div class="tab-item inactive '+(null!=(l=a(n("d930")).call(s,null!=t?u(t,"recommendType"):t,"==","LOCATION",{name:"ifcond",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:5,column:42},end:{line:5,column:102}}}))?l:"")+'" data-id="LOCATION">'+c(a(n("dfab")).call(s,"nearBy","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:5,column:123},end:{line:5,column:152}}}))+'</div>\n            <div class="list-icon inactive"></div>\n        </div>\n        <div class="tab-content inactive">\n            <div class="recommend-container">\n                <div class="loading-box">\n                    <div class="loading"></div>\n                </div>\n            </div>\n            <div class="refresh">\n                '+c(a(n("dfab")).call(s,"changeOneChange","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:15,column:16},end:{line:15,column:52}}}))+"\n            </div>\n        </div>\n    </div>\n</div>"},useData:!0})},df60:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.handleOpenLinkInNewTab=function(e){var t=e.$container;t&&t.length>0&&t.find("a").attr("target","_blank").attr("rel","noopener noreferrer nofollow")}},e249:function(e,t,n){},e28d:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a,r,o){var l,s=e.escapeExpression,c=e.lambda,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <img src="'+s("function"==typeof(l=null!=(l=u(n,"url")||(null!=t?u(t,"url"):t))?l:e.hooks.helperMissing)?l.call(null!=t?t:e.nullContext||{},{name:"url",hash:{},data:a,loc:{start:{line:5,column:12},end:{line:5,column:19}}}):l)+'" style="max-width:'+s(c(null!=o[1]?u(o[1],"w"):o[1],t))+"px; max-height:"+s(c(null!=o[1]?u(o[1],"h"):o[1],t))+'px;min-width:100px;min-height:100px">\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a,r,o){var l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="dls-map-image-pop pop-box-mask">\n  <div class="pop-loading"></div>\n  <div class="icon-close-big pop-close"></div>\n'+(null!=(l=s(n,"each").call(null!=t?t:e.nullContext||{},null!=t?s(t,"images"):t,{name:"each",hash:{},fn:e.program(1,a,0,r,o),inverse:e.noop,data:a,loc:{start:{line:4,column:2},end:{line:6,column:11}}}))?l:"")+"</div>"},useData:!0,useDepths:!0})},e2cd:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=l(n("4429"));function l(e){return e&&e.__esModule?e:{default:e}}n("6ad37");var s=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",preText:"上一页",nextText:"下一页",currentNum:0,totalNum:0,onClickPreBtn:function(){},onClickNextBtn:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$container&&(this.$html=$((0,o.default)({preText:this.preText,nextText:this.nextText,currentNum:this.currentNum,totalNum:this.totalNum})),this.emptyBeforeAppend&&this.$container.empty(),this.$container.append(this.$html),this._bind())}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".preBtn",(function(){e.onClickPreBtn(e.currentNum)})),this.$html.on("click",".nextBtn",(function(){e.onClickNextBtn(e.currentNum)}))}},{key:"updateCurrentNum",value:function(e){Number(e)&&Number(e)<this.totalNum&&this.$html.find(".currentNum").text(Number(e))}},{key:"destory",value:function(){this.$container&&this.$container.empty()}}]),e}();t.default=s,e.exports=t.default},e355:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCategoriesList=void 0;var i,a=s(n("d785")),r=s(n("0f75")),o=(t.getCategoriesList=(i=(0,r.default)(a.default.mark((function e(){var t,n,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.MAB_STATE,!(n=t.getIn(["result","defCategories"]))){e.next=6;break}return e.abrupt("return",n);case 6:return e.next=8,(0,l.getCategoryList)();case 8:return(i=e.sent)&&200===i.code&&t.updateIn(["result","defCategories"],i.data),e.abrupt("return",i&&200===i.code?i.data:null);case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)}),n("a7c7")),l=n("fe21");function s(e){return e&&e.__esModule?e:{default:e}}},e3ca:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li class="main-item" data-id='+c(s(null!=t?d(t,"id"):t,t))+" title="+c(a(n("fcbf")).call(u,null!=t?d(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:70}}}))+'>\n        <a data-id="'+c(s(null!=t?d(t,"id"):t,t))+'"></a>\n            <div class="line line-1">\n                <span class="name">['+c(s(null!=t?d(t,"nodeName"):t,t))+']</span>\n                <span class="title">'+(null!=(l=a(n("fcbf")).call(u,null!=t?d(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:8,column:36},end:{line:8,column:61}}}))?l:"")+'</span>\n            </div>\n            <div class="line line-2">\n                <span class="time">'+c(s(null!=t?d(t,"time"):t,t))+'</span>\n                <span class="location">'+c(s(null!=t?d(t,"locationDesc"):t,t))+"</span>\n            </div>\n        </a>\n    </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<ul class="main-list">\n'+(null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"data"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:4},end:{line:16,column:13}}}))?r:"")+"</ul>"},useData:!0})},e4f9:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=e.lambda,c=e.escapeExpression,u=null!=t?t:e.nullContext||{},d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="detail-list-marker" data-mid="'+c(s(null!=t?d(t,"id"):t,t))+'">\n  <div class="marker-content cp">\n    <div class="normal-marker-icon active"></div>\n    <div class="active-marker-icon node-icon '+c(s(null!=t?d(t,"iconUrl"):t,t))+'">\n    </div>\n    <div class="bottom-text bottomText" title="'+(null!=(l=a(n("691b")).call(u,null!=(l=null!=t?d(t,"data"):t)?d(l,"title"):l,{name:"clean",hash:{},data:o,loc:{start:{line:7,column:47},end:{line:7,column:69}}}))?l:"")+'">\n      '+(null!=(l=a(n("fcbf")).call(u,null!=t?d(t,"title"):t,"title",{name:"xss",hash:{},data:o,loc:{start:{line:8,column:6},end:{line:8,column:29}}}))?l:"")+"\n    </div>\n  </div>\n</div>"},useData:!0})},e842:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=z(n("e1de")),a=z(n("1727")),r=z(n("633f")),o=z(n("8827")),l=z(n("57ba")),s=z(n("158c")),c=z(n("9918")),u=z(n("27f1")),d=z(n("893f")),m=z(n("6378")),h=z(n("a16c"));n("1ad2");var f=n("ffc6"),p=n("feb7"),v=n("cffa"),y=z(n("a316")),g=z(n("b7f5")),k=z(n("a4fc")),b=n("2cc3"),_=n("2cc3"),C=n("97a7"),w=n("a8a7"),M=z(n("2f20")),x=z(n("24d8")),P=z(n("8bb6")),T=z(n("7ac4")),I=z(n("89ec")),S=z(n("fe21")),E=z(n("417f")),A=z(n("1be1")),O=z(n("9491")),L=n("f4f1"),N=z(n("6561")),B=n("27dc"),D=n("0280"),R=n("a7c7"),j=n("df60"),Y=z(n("d355")),F=n("ccd0"),U=z(n("43f0")),H=z(n("e93f")),W=z(n("5393"));function z(e){return e&&e.__esModule?e:{default:e}}var q=function(e){function t(e){(0,o.default)(this,t),e.showComps=["timebar","markersComponent","bottomRightComponent","topRightComponent"];var n=(0,s.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.active=!0,n.$container=$(".pageContainer"),n.mabState=R.MAB_STATE,n.yearArr=n.mabState.get("mapYears"),n.DEFAULT_YEAR=1949,n.currentPage=1,n.totalPages=1,n.pageParams=f.Nav.getParams("map-router"),n.itemId=n.pageParams.id,n.nodeId=n.pageParams.nodeid,n}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onPageMount",value:function(){var e=this;this.comps.timebar.update({showDivision:!1,type:"point",draggable:!1,scalable:!1,markers:[]}),this._getInfo().then((function(t){if(e.nodeInfo=e.info.timeMap.find((function(t){return t.id===e.nodeId})),"iframe"!=(0,C.getUrlQueryMessage)(location.search)._ua_||e.nodeInfo||(e.nodeInfo=e.info.timeMap[0]),e.handleBirthDeath(e.info),e.nodeInfo){e.currentPage=e.nodeInfo.index,e.totalPages=e.info.timeMap.length,e.markers=e._dealMarkerData(e.info.timeMap),e.years=(0,B.getBirthToDead)(e.markers),e.minAndMax=(0,B.getMinAndMax)(e.years),e.lifeLineYears=(0,B.getLifeLineYears)(e.markers,e.info.birth,e.info.death),e.lifeLineBirthDeathInfo={birth:0,death:e.info.showLife?null==e.info.birthYear||null==e.info.deathYear?0:(0,B.getSubtractYear)(e.info.birth,e.info.death):0},null!=e.info.birthYear&&null==e.info.deathYear&&e.info.birthYear>1899?(e.lifeLineBirthDeathInfo.death=(0,B.getSubtractYear)(e.info.birth,(0,_.getCurrentTime)()),e.lifeLineBirthDeathInfo.deathDesc="至今"):e.lifeLineBirthDeathInfo.deathDesc=e.lifeLineBirthDeathInfo.death,e.$container.empty();var n,i=.3*window.innerWidth-48;e.info.timeMap.map((function(e){e.images&&e.images.length&&e.images.forEach((function(e){e.originalUrl.indexOf("?")>-1?e.originalUrl=e.originalUrl+"&w="+i:e.originalUrl=e.originalUrl+"?w="+i}))})),e.$html=$((0,d.default)({info:e.info,nodeInfo:e.nodeInfo,lifeLineBirthDeathInfo:e.lifeLineBirthDeathInfo})),e.$container.append(e.$html),(0,j.handleOpenLinkInNewTab)({$container:e.$html.find(".detailContent .nodeDetail")}),e._bind(),setTimeout((function(){e.$html.find(".detail-content").off("scroll.content-scroll"),e.handleImgWidthAndHeight(),e.$html.find(".detail-content").scrollTop(e.$html.find(".detail-content").scrollTop()+e.$html.find(".node-info-"+e.currentPage).position().top-20),e.update(!0),e.$ps=new g.default(e.$html.find(".detail-content")[0],{wheelPropagation:!0})})),e.recommend=new m.default({$container:e.$html.find(".recom-container"),recommendId:e.pageParams.nodeid,map:e.map,onChangeRecommendState:function(e){},emitChangeRecommendList:function(){setTimeout((function(){e.territoryInfo.updateDescHeight()}),320)}}),setTimeout((function(){e._showRightInfoContainer()}),0),e.comps.timebar.update({showDivision:!1,type:"point",markerOnClick:function(t,n){e.comps.timebar.ruler.setCenterByTime(n.time,.3,!1),e.currentPage=n.index+1,e.$html.find(".detail-content").off("scroll.content-scroll"),e._scrollContent(e.$html.find(".detail-content").scrollTop()+e.$html.find(".node-info-"+e.currentPage).position().top-20),e.update(!0)},draggable:!1,scalable:!1,markers:e.markers}),e.comps.timebar.ruler.setTimeByWidth(e.minAndMax.min-(e.minAndMax.max-e.minAndMax.min)-10,e.minAndMax.max+10),e.markers.forEach((function(t){t.id==e.pageParams.nodeid&&(n=t.time)})),n=n||e.DEFAULT_YEAR,e.comps.timebar.ruler.setCenterByTime(n,.3,!1),setTimeout((function(){e.showComponent()})),e.markersComponent=e.comps.markersComponent,e.markersComponent.update({handleSingleMarkerClick:function(e,t){},handleMarkerClick:function(t,n){var i=e.info.timeMap.findIndex((function(e){return e.id===t.id}));-1!==i&&(e.currentPage=i+1,e.$html.find(".detail-content").off("scroll.content-scroll"),e._scrollContent(e.$html.find(".detail-content").scrollTop()+e.$html.find(".node-info-"+e.currentPage).position().top-20),e.update(!0))},handleMultiMarkerClick:function(){}}),e.territoryInfo=new H.default({$container:e.$html.find(".territoryInfoContainer"),effectDom:e.recommend.getDom(),emitCloseTerritoryInfo:function(){e.territory.handleCloseTerritoryInfo()},onDestroyed:function(){e.territoryInfo=null}}),e.territory=new Y.default({map:e.map,territoryInfo:e.territoryInfo,onDestroyed:function(){e.territory=null}}),e.share=new N.default({$container:e.$html.find(".share-wrapper"),useText:!0})}else f.Nav.go("/map/detail/"+e.itemId,{key:"map-router",replace:!0})})),this.isFrame=(0,h.default)()}},{key:"_getAngle",value:function(e,t,n,i){var a=Math.abs(e-n),r=Math.abs(t-i),o=r/Math.sqrt(Math.pow(a,2)+Math.pow(r,2)),l=Math.acos(o),s=Math.floor(180/(Math.PI/l));return n>e&&i>t&&(s=180-s),n==e&&i>t&&(s=180),n>e&&i==t&&(s=90),n<e&&i>t&&(s=180+s),n<e&&i==t&&(s=270),n<e&&i<t&&(s=360-s),s}},{key:"_showRightInfoContainer",value:function(){this.$html.find(".rightInfoContainer").addClass("active")}},{key:"_drawLineForNodes",value:function(){var e=this.markersComponent.getMarkersByName("nodeDetail");e.sort((function(e,t){return e.order-t.order}));var t=[];e.forEach((function(e){t.push(e.location)})),this.map.gl.getSource("node-line").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:t}}]})}},{key:"removeLineForNodes",value:function(){this.map.gl.getSource("node-line").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[]}}]})}},{key:"_updateNodeDetailMarkers",value:function(e){var t=this.info.timeMap[e];if(t){var n=this.info.timeMap.findIndex((function(e){return e.id===t.id}));if(e>-1){var i,a=e-1;a=a>-1?a:0;var r=n+1;i=this.info.timeMap.slice(a,r+1);var o=this._getNodeMarkersInfo(i,t.id);this.markersComponent.updateNodeDetailMarkers(o,.1);var l=this.markersComponent.getMarkersByName("nodeDetail");this.fitMapBounds(o,l);var s=l.find((function(e){return e.isCluster?!!e.allChild.find((function(e){return e.properties.id===t.id})):e.id===t.id}));if(s&&(s.isCluster?this.markersComponent.updateNodeDetailMultiMarker(s,t.id):this.markersComponent.activeMarker(t.id,!!s.isCluster),this.drawPointLinePolygonForMarker(s,t.id)),this.isFrame){var c=t.node.location.geometry[0];if(c){var u=void 0;"LineString"===c.type||"Polygon"===c.type?u=c.coordinates[0]:"Point"===c.type&&(u=c.coordinates),u&&this.map.gl.panTo(u)}}}}}},{key:"flyToCurrentNode",value:function(e){var t=e.location,n=this.map.gl.getZoom(),i=this.map.gl.project(t),a=this.map.gl.unproject([i.x-$(".components-container").outerWidth()/2,i.y]);this.map.flyToPoint({center:a,zoom:n})}},{key:"drawPointLinePolygonForMarker",value:function(e,t){var n=void 0;if(e.isCluster){var i=e.allChild.find((function(e){return e.properties.id===t}));if(!i)return;n=i.properties.originalNode.data.node}else n=e.originalNode.data.node;if(n){var a=n.location.geometry,r=[],o=[],l=[];a.forEach((function(e){switch(e.type){case"Point":r.push(e.coordinates);break;case"LineString":o.push(e.coordinates);break;case"Polygon":l.push(e.coordinates)}})),this._removePointLinePolygonForMarker(),r.length>1&&this.markersComponent.drawLine(r),o.length>0&&this.markersComponent.drawLineString(o),l.length>0&&((0,F.removeTheSamePointFromPolygon)(l),(0,F.getAClosedPolygon)(l),this.markersComponent.drawPolygon(l));var s=n.sketch;if(s&&s.length>0){var c=this._getNodeSketchPolygons(s);c.length>0&&this.markersComponent.drawSketchPolygon(c);var u=this._getNodeSketchLines(s);u.length>0&&this.markersComponent.drawSketchLines(u);var d=this._getNodeSketchPoints(s);d.length>0&&this.markersComponent.drawSketchPoints(d)}this._addLineAnimation()}}},{key:"_getNodeSketchPoints",value:function(e){var t=e.filter((function(e){return"Point"===e.type||"MultiPoint"===e.type})),n=[];return t.forEach((function(e){if("point"===(e=e.props).type){var t=[e.x,e.y];n.push({data:{fillStyle:e.fillStyle||e.customStyle.fillStyle,strokeStyle:e.strokeStyle||e.customStyle.strokeStyle,lineWidth:e.lineWidth||e.customStyle.lineWidth||3,radius:e.radius||e.customStyle.radius||5,data:e.data||{}},points:t})}else if("multiPoint"===e.type){(e.shapes||[]).forEach((function(t){if("point"===t.type){var i=[t.x,t.y];n.push({data:{fillStyle:e.fillStyle||e.customStyle.fillStyle,strokeStyle:e.strokeStyle||e.customStyle.strokeStyle,lineWidth:e.lineWidth||e.customStyle.lineWidth||3,radius:e.radius||e.customStyle.radius||5,data:e.data||{}},points:i})}}))}})),n}},{key:"_getNodeSketchLines",value:function(e){var t=e.filter((function(e){return"LineString"===e.type||"MultiLineString"===e.type})),n=[];return t.forEach((function(e){if("line"===(e=e.props).type){var t=e.points.map((function(e){return[e.x,e.y]}));n.push({data:{strokeStyle:e.strokeStyle||e.customStyle.strokeStyle,lineWidth:e.lineWidth||e.customStyle.lineWidth||4,data:e.data||{}},points:t})}else if("multiLine"===e.type){(e.shapes||[]).forEach((function(t){if("line"===t.type){var i=t.points.map((function(e){return[e.x,e.y]}));n.push({data:{strokeStyle:e.strokeStyle||e.customStyle.strokeStyle,lineWidth:e.lineWidth||e.customStyle.lineWidth||4,data:e.data||{}},points:i})}}))}})),n}},{key:"_getNodeSketchPolygons",value:function(e){var t=e.filter((function(e){return"Polygon"===e.type||"MultiPolygon"===e.type})),n=[];return t.forEach((function(e){if("polygon"===(e=e.props).type){var t=e.points.map((function(e){return[e.x,e.y]}));(0,F.removeTheSamePointFromPolygon)(t),(0,F.getAClosedPolygon)(t),n.push({data:{fillStyle:e.fillStyle||e.customStyle.fillStyle,strokeStyle:e.strokeStyle||e.customStyle.strokeStyle,data:e.data||{}},points:t})}else if("multiPolygon"===e.type){(e.shapes||[]).forEach((function(t){if("polygon"===t.type){var i=t.points.map((function(e){return[e.x,e.y]}));(0,F.removeTheSamePointFromPolygon)(i),(0,F.getAClosedPolygon)(i),n.push({data:{fillStyle:e.fillStyle||e.customStyle.fillStyle,strokeStyle:e.strokeStyle||e.customStyle.strokeStyle,data:e.data||{}},points:i})}}))}})),n}},{key:"getDashArray",value:function(){for(var e=[],t=0;t<40;t++)if(t<=24)e.push([.25*t,4,6-.25*t]);else{var n=.25*(t-24);e.push([0,n,6,4-n])}return e}},{key:"_addLineAnimation",value:function(){if(!this.lineAnimationInterval){var e,t,n=this,i=Date.now(),a=40,r=0,o=this.getDashArray();!function l(){e=Date.now(),(t=e-i)>a&&(i=e-t%a,r=r+1>=o.length?0:r+1,n.map.gl.setPaintProperty("node-line","line-dasharray",o[r])),n.lineAnimationInterval=requestAnimationFrame(l)}()}}},{key:"_removeLineAnimation",value:function(){cancelAnimationFrame(this.lineAnimationInterval)}},{key:"_removePointLinePolygonForMarker",value:function(){this.markersComponent.removeMapLine(),this.markersComponent.removeLineString(),this.markersComponent.removePolygon(),this.markersComponent.removeSketchPoint(),this.markersComponent.removeSketchLine(),this.markersComponent.removeSketchPolygon()}},{key:"fitMapBounds",value:function(e,t){var n=[],i=[];e.forEach((function(e,t){(!n[0]||n[0]<e.location[0])&&(n[0]=e.location[0]),(!n[1]||n[1]<e.location[1])&&(n[1]=e.location[1]),(!i[0]||i[0]>e.location[0])&&(i[0]=e.location[0]),(!i[1]||i[1]>e.location[1])&&(i[1]=e.location[1])}));var a={top:200,bottom:200,left:$(".components-container.active").outerWidth()+100,right:100},r=t.length>1?22:5;this.map.gl.fitBounds([i,n],{padding:a,maxZoom:r})}},{key:"_getNodeMarkersInfo",value:function(e,t){var n=this,i=[];return e.forEach((function(e){var a=e.id,r=e.itemId,o=e.node,l=o.location,s=o.title,c=n._getMarkerLocation(l),u=(0,D.getMarkerIconNameByTitle)(s,"default-icon");i.push({id:a,itemName:s,location:c,iconClassName:u,active:a===t,data:{itemId:r,node:o}})})),i}},{key:"_getMarkerLocation",value:function(e){var t=void 0,n=e.geometry.find((function(e){return"Point"===e.type}));if(n)t=n.coordinates;else{var i=e.geometry.find((function(e){return"LineString"===e.type}));if(i)t=i.coordinates[0];else{var a=e.geometry.find((function(e){return"Polygon"===e.type}));if(a){a.coordinates.push(a.coordinates[0]);var r=(0,p.polygon)([a.coordinates]);t=(0,y.default)(r).geometry.coordinates}}}return t}},{key:"handleImgWidthAndHeight",value:function(){var e=this,t=$(".node-img-wrapper").outerWidth();this.info.timeMap.forEach((function(n,i){Array.prototype.forEach.call(e.$html.find(".node-info-"+(i+1)).find(".node-img"),(function(e,i){var a=n.images[i].width>t?t:n.images[i].width;$(e).css("height",a*n.images[i].height/n.images[i].width)}))}))}},{key:"handleBirthDeath",value:function(e){if(e.showLife=!0,e.birth&&e.birth.time&&e.birth.time.startTime){var t=(0,_.dateParser)(e.birth.time.startTime);e.birthYear=t.year*t.abdcType,e.birth=e.birth.time.startTime}else e.birth=null,e.birthYear=null;if(e.death&&e.death.time&&e.death.time.startTime){var n=(0,_.dateParser)(e.death.time.startTime);e.deathYear=n.year*n.abdcType,e.death=e.death.time.startTime}else e.death=null,e.deathYear=null;e.birth||e.death||(e.showLife=!1)}},{key:"handleNLPData",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=(0,a.default)(e.timeMap);!(t=(r=o.next()).done);t=!0){var l=r.value;""===l.node.title?l.node.isNLP=!0:l.node.isNLP=!1}}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}return e}},{key:"onPageExit",value:function(){this.markersComponent&&this.markersComponent.removeAllNodeDetailMarkers(),this.removeLineForNodes(),this.hideComponent(),this.territory&&this.territory.destroy()}},{key:"destroy",value:function(){$(window).off("resize.detail"),this.markersComponent&&this.markersComponent.removeAllNodeDetailMarkers(),this._removeLineAnimation(),this.hideComponent(),this.territory&&this.territory.destroy(),this.recommend&&this.recommend.destroy(),this.comps.timebar.update({showDivision:!1,type:"point",markers:[]})}},{key:"hideComponent",value:function(){this.active=!1,this.$html&&this.$html.find(".components-container").removeClass("active")}},{key:"showComponent",value:function(){this.active=!0,this.$html.find(".components-container").addClass("active")}},{key:"_scrollContent",value:function(e){var t=this;v.TweenLite.to(this.$html.find(".detail-content")[0],.3,{scrollTop:e,onUpdate:function(){t.$ps.update()}})}},{key:"_bind",value:function(){var e=this;this.$html.find(".detail-top-nav").on("click",(function(t){location.search,f.Nav.go("/map/detail/"+e.pageParams.id,{key:"map-router",replace:!0})})),this.$html.find(".edit-icon").on("click",(function(t){if((0,L.isAuth)()&&window.userInfo&&window.userInfo.phone){if(!new k.default({type:"编辑节点"}).isBan){var n=e.pageParams.id;E.default.getLock("timemap","",n).then((function(n){200===n.code&&((0,w.setSessionStorageItem)("map","itemNodeEditFrom","detail"),window.location.href="/map/edit/item-node/"+e.pageParams.id+"/"+t.target.dataset.nodeid)})).fail((function(n){401===n.status?new O.default({nextUrl:"/map/edit/item-node/"+e.pageParams.id+"/"+t.target.dataset.nodeid}):2001===n.code?new A.default({$container:$("body"),text:_L_("TheItemIsUnderCheckAndGoUserCenter","timemap"),position:"top-center"}):new A.default({resp:n,duration:3e3})}))}}else new O.default({nextUrl:"/map/edit/item-node/"+e.pageParams.id+"/"+t.target.dataset.nodeid})})),this.$html.find(".previous-btn").on("click",(function(t){e.ptimer&&clearTimeout(e.ptimer),e.ptimer=setTimeout((function(){e.$html.find(".detail-content").off("scroll.content-scroll"),e.currentPage=e.currentPage-1<1?e.totalPages:e.currentPage-1;var t=e.$html.find(".detail-content").scrollTop()+e.$html.find(".node-info-"+e.currentPage).position().top-20;e._scrollContent(t),e.update(!0)}),100)})),this.$html.find(".next-btn").on("click",(function(t){e.ntimer&&clearTimeout(e.ntimer),e.ntimer=setTimeout((function(){e.$html.find(".detail-content").off("scroll.content-scroll"),e.currentPage=e.currentPage+1>e.totalPages?1:e.currentPage+1;var t=e.$html.find(".detail-content").scrollTop()+e.$html.find(".node-info-"+e.currentPage).position().top-20;e._scrollContent(t),e.update(!0)}),100)})),this.$html.find(".node-detail .node-img").on("click",(function(e){new U.default({images:[{url:e.target.dataset.imgurl}]}),e.stopPropagation()})),this.$html.find(".detail-content-wrapper").on("mousewheel",(function(t){t.originalEvent.wheelDelta>0?e.currentPage>1&&(e.currentPage--,e.update()):e.currentPage<e.totalPages&&(e.currentPage++,e.update())})),this.$html.find(".node-info").on("click",(function(t){e.$html.find(".detail-content").off("scroll.content-scroll"),e.currentPage=Number(t.currentTarget.dataset.id),e._scrollContent(e.$html.find(".detail-content").scrollTop()+e.$html.find(".node-info-"+e.currentPage).position().top-20),e.update(!0)})),$(window).on("resize.detail",(function(t){e.handleImgWidthAndHeight(),e.$ps.update(),e.comps.timebar.ruler.setTimeByWidth(e.minAndMax.min-(e.minAndMax.max-e.minAndMax.min)-10,e.minAndMax.max+10),e.comps.timebar.ruler.setCenterByTime(e.markers[e.currentPage-1].time,.3,!1),"number"==typeof e.lifeLineYears[e.currentPage-1]?e.$html.find(".life-line .wrap-circle").css("left",e.lifeLineYears[e.currentPage-1]*(($(".line1").outerWidth()-28)/e.lifeLineBirthDeathInfo.death)):"出生前"==e.lifeLineYears[e.currentPage-1]?e.$html.find(".life-line .wrap-circle").css("left",0):"去世后"==e.lifeLineYears[e.currentPage-1]?e.$html.find(".life-line .wrap-circle").css("left",$(".line1").outerWidth()-28):e.$html.find(".life-line .wrap-circle").css("left",0)})),this.map.gl.off("click","sketch-polygon").on("click","sketch-polygon",(function(t){e._handlerSketchClick(t)})),this.map.gl.off("click","sketch-line").on("click","sketch-line",(function(t){e._handlerSketchClick(t)})),this.map.gl.off("click","sketch-point").on("click","sketch-point",(function(t){e._handlerSketchClick(t)})),this.map.off("click.sketch"),this.map.on("click.sketch",(function(t){e.clickSketchLayer||e._removeDescViewer()})),this.map.off("movestart.sketch"),this.map.on("movestart.sketch",(function(t){e._removeDescViewer()}))}},{key:"_handlerSketchClick",value:function(e){var t=this;if(e.features&&Array.isArray(e.features)){var n=e.features[0],i=n&&n.properties.data||"";if(i){var a=(i=JSON.parse(i)).desc;if(a){this.clickSketchLayer=!0,setTimeout((function(){t.clickSketchLayer=!1}),100);var r=n.geometry,o=[];"Polygon"===r.type?o=r.coordinates[0]:"LineString"===r.type?o=r.coordinates:"Point"===r.type&&(o=[r.coordinates]);var l=void 0;if(o.length>=3){(0,F.getAClosedPolygon)(o);var s=(0,p.polygon)([o]);l=(0,y.default)(s).geometry.coordinates}else 2===o.length?l=[(r.coordinates[0][0]+r.coordinates[1][0])/2,(r.coordinates[0][1]+r.coordinates[1][1])/2]:1===o.length&&(l=o[0]);var c=l?this.map.gl.project(l):"";c&&this._showDescViewer(a,c)}}}}},{key:"_showDescViewer",value:function(e,t){var n=this;this.$descViewer=new W.default({$container:this.$html.find(".descViewerContainer"),emptyBeforeAppend:!0,active:!0,desc:e,position:t,onDestroyed:function(){n.$descViewer=null}})}},{key:"_removeDescViewer",value:function(){this.$descViewer&&this.$descViewer.destroy()}},{key:"update",value:function(e){var t=this;this._removeDescViewer(),this.$html.find(".detail-footer .current-num").text(this.currentPage),this.$html.find(".node-info").removeClass("active"),this.$html.find(".node-info-"+this.currentPage).addClass("active");var n=this.$html.find(".node-info-"+this.currentPage).find(".node-title").text(),i=this.$html.find(".node-info-"+this.currentPage).find(".node-detail").text();if(T.default.setTitle(n,this.info.name,_L_("timemap")),T.default.setDesc(i),"number"==typeof this.markers[this.currentPage-1].time){var a=this.markers[this.currentPage-1].time;a=a||this.DEFAULT_YEAR,this.comps.timebar.ruler.setCenterByTime(a,.3,!1),this.markers[this.currentPage-1].mapTime?this.map.setYear(this.markers[this.currentPage-1].mapTime):this.map.setYear(this.markers[this.currentPage-1].time)}"number"==typeof this.lifeLineYears[this.currentPage-1]?(this.$html.find(".life-line").removeClass("inactive"),this.$html.find(".life-line .birth-year").text("年龄 0"),this.$html.find(".life-line .inner-circle").text(this.lifeLineYears[this.currentPage-1]),this.$html.find(".life-line .wrap-circle").css("left",this.lifeLineYears[this.currentPage-1]*(($(".line1").outerWidth()-28)/this.lifeLineBirthDeathInfo.death))):"出生前"==this.lifeLineYears[this.currentPage-1]?(this.$html.find(".life-line").addClass("inactive"),this.$html.find(".life-line .birth-year").text("出生前"),this.$html.find(".life-line .inner-circle").text(0),this.$html.find(".life-line .wrap-circle").css("left",0)):"去世后"==this.lifeLineYears[this.currentPage-1]?(this.$html.find(".life-line").addClass("inactive"),this.$html.find(".life-line .birth-year").text("去世后"),this.$html.find(".life-line .inner-circle").text(this.lifeLineBirthDeathInfo.death),this.$html.find(".life-line .wrap-circle").css("left",$(".line1").outerWidth()-28)):"不详"==this.lifeLineYears[this.currentPage-1]&&(this.$html.find(".life-line").addClass("inactive"),this.$html.find(".life-line .birth-year").text("不详")),this.recommend.update(this.info.timeMap[this.currentPage-1].id),$(".timebar-marker-item").removeClass("active"),Array.prototype.forEach.call($(".timebar-marker-item"),(function(e){Number(e.dataset.index)+1==t.currentPage&&$(e).addClass("active")})),e&&(this.clickTimer&&clearTimeout(this.clickTimer),this.clickTimer=setTimeout((function(){t.$html.find(".detail-content").off("scroll.content-scroll").on("scroll.content-scroll",(function(e){t._scrollHandler(e)}))}),500)),this.updateMarkerTimer&&clearTimeout(this.updateMarkerTimer),this.updateMarkerTimer=setTimeout((function(){t._updateNodeDetailMarkers(t.currentPage-1),t._drawLineForNodes(),setTimeout((function(){t.territoryInfo.updateDescHeight()}),500)}),500)}},{key:"_scrollHandler",value:function(){var e=this;Array.prototype.forEach.call(this.$html.find(".node-info"),(function(t,n){var i=e.$html.find(".detail-content").outerHeight()/2;if($(t).position().top<i&&$(t).position().top+$(t).outerHeight()+20>i)return e.currentPage=parseInt(t.dataset.id),void e.update()}))}},{key:"_getInfo",value:function(){var e=this,t=this.mabState.get("detail").id;return this.pageParams.id===t?i.default.resolve().then((function(t){return e.info=e.mabState.get("detail").info,e.info})):S.default.getMapDetail(this.pageParams.id).then((function(t){if(t.data)return e.mabState.updateIn(["detail","id"],e.pageParams.id),t.data.summary=P.default.removeReferences(t.data.summary),t.data.timeMap.forEach((function(t,n){t.index=n+1,t.node.subdesc=(0,I.default)(t.node.desc)?M.default.subStr((0,I.default)(t.node.desc).replace(/<a.*>(.*)<\/a>/g,"$1"),94):"",t.node.standardTime=(0,b.timeStantard)(t.node.time),""===t.node.title&&(t.node.isNLP=!0,t.node.title=e._getNlpNodeTitle(t))})),e.handleNLPData(t.data),e.mabState.updateIn(["detail","info"],t.data),e.info=e.mabState.get("detail").info,e.info}))}},{key:"_getNlpNodeTitle",value:function(e){return x.default.subDateForYear(e.node.time.startTime)+" "+e.node.location.desc}},{key:"_dealMarkerData",value:function(e){var t=this,n=[];return e.forEach((function(e){if(e.node.time&&e.node.time.startTime){var i=(0,_.dateParser)(e.node.time.startTime),a=i.year*i.abdcType,r=e.node.time.startTime;0==a&&(a=null,r=null);var o=null;if(e.node.time&&e.node.time.startTime&&e.node.time.endTime){var l=(0,_.dateParser)(e.node.time.startTime),s=(0,_.dateParser)(e.node.time.endTime),c=parseInt(l.yearWithAdbc),u=parseInt(s.yearWithAdbc);o=(o=t.yearArr.filter((function(e){return e>=c&&e<=u}))).length&&0!==o.length?o[parseInt(o.length/2)]:c+parseInt((u-c)/2)}n.push({time:a,timeInfo:r,mapTime:o,id:e.id,title:e.node.title})}})),n}}]),t}(u.default);t.default=q,e.exports=t.default},e896:function(e,t,n){},e93f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("3f6b")),a=h(n("8827")),r=h(n("57ba")),o=h(n("7bc1"));n("566a");var l=h(n("b7f5")),s=n("df60"),c=h(n("b231")),u=h(n("3d58")),d=h(n("e2d7")),m=h(n("8bb6"));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,active:!1,info:null,effectDom:"",top:66,bottom:88,containerPadding:36,wrapPadding:9,emitCloseTerritoryInfo:function(){},onDestroyed:function(){}},t),this._init(),this._render()}return(0,r.default)(e,[{key:"_init",value:function(){this._eventSubscribe()}},{key:"_eventSubscribe",value:function(){var e=this;c.default.subscribe("closeTerritoryInfo",(function(){e.$html&&e.hideComponent()}))}},{key:"_render",value:function(){this.$container&&(this.emptyBeforeAppend&&this.$container.empty(),this.info&&this.info.summary&&(this.info.summary=(0,d.default)(u.default.htmlDecode(this.info.summary),"content"),this.info.summary=m.default.removeReferences(this.info.summary)),this.$html=$((0,o.default)({active:this.active,info:this.info})),this.$container.append(this.$html),(0,s.handleOpenLinkInNewTab)({$container:this.$html.find(".territoryDesc")}),this._bind())}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".closeIcon",(function(){e.hideComponent(),e.emitCloseTerritoryInfo()}))}},{key:"updateInfo",value:function(e){e&&(this.info=e,this.emptyBeforeAppend=!0,this._render(),this.showComponent(),this._setDescHeight())}},{key:"updateDescHeight",value:function(){var e=$("body").height()-this.top-this.bottom;this.effectDom&&(e-=this.effectDom.height());e<this.$html.height()&&this._setComponentHeight(e)}},{key:"_setDescHeight",value:function(){var e=$("body").height()-this.top-this.bottom;this.effectDom&&(e-=this.effectDom.height());var t=this.$html.find(".baseInfo").height(),n=e-t-this.containerPadding-this.wrapPadding;if(this.$html.find(".territoryDesc").height()>n){var i=e,a=e-t-this.containerPadding-this.wrapPadding;this._setComponentHeight(i),this._setDescBoxHeight(a),new l.default(this.$html.find(".territoryDesc")[0]),this.$html.find(".descBox").addClass("scroll")}}},{key:"_setDescBoxHeight",value:function(e){this.$html.find(".descBox").height(e)}},{key:"_setComponentHeight",value:function(e){this.$html.height(e)}},{key:"getActiveState",value:function(){return this.active}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"destroy",value:function(){this.$container&&this.$container.empty(),this.onDestroyed()}}]),e}();t.default=f,e.exports=t.default},ecea:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r,o,l=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li class="link-item linkItem '+(null!=(r=u(n,"if").call(l,null!=t?u(t,"available"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:34},end:{line:3,column:66}}}))?r:"")+'" data-to="'+c("function"==typeof(o=null!=(o=u(n,"type")||(null!=t?u(t,"type"):t))?o:s)?o.call(l,{name:"type",hash:{},data:a,loc:{start:{line:3,column:77},end:{line:3,column:85}}}):o)+'" title="'+c("function"==typeof(o=null!=(o=u(n,"name")||(null!=t?u(t,"name"):t))?o:s)?o.call(l,{name:"name",hash:{},data:a,loc:{start:{line:3,column:94},end:{line:3,column:102}}}):o)+'">\n      '+c("function"==typeof(o=null!=(o=u(n,"name")||(null!=t?u(t,"name"):t))?o:s)?o.call(l,{name:"name",hash:{},data:a,loc:{start:{line:4,column:6},end:{line:4,column:14}}}):o)+"\n    </li>\n"},2:function(e,t,n,i,a){return" active "},compiler:[8,">= 4.3.0"],main:function(e,t,n,i,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<ul class="more-info">\n'+(null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"items"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:2},end:{line:6,column:11}}}))?r:"")+"</ul>"},useData:!0})},ee78:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={width:434,height:240};function a(e){return document.querySelector(e)?document.querySelector(e).getBoundingClientRect():{bottom:0,height:0,left:0,right:0,top:0,width:0,x:0,y:0}}function r(e){var t=a(e.selector),n=t.x,i=t.y,r={x1:n,y1:i,x2:n+t.width,y2:i+t.height};if(e.keyPoint)switch(e.keyPoint){case"p1":r={x1:r.x1,y1:r.y1,x2:1/0,y2:1/0};break;case"p2":r={x1:-1/0,y1:r.y1,x2:r.x2,y2:1/0};break;case"p3":r={x1:-1/0,y1:-1/0,x2:r.x2,y2:r.y2};break;case"p4":r={x1:r.x1,y1:-1/0,x2:1/0,y2:r.y2}}return r}function o(e,t){var n,a={p1:{x:(n=e).x-i.width/2,y:n.y-i.height-60},p2:{x:n.x+i.width/2,y:n.y-i.height-60},p3:{x:n.x+i.width/2,y:n.y-60},p4:{x:n.x-i.width/2,y:n.y-60}},o={x:0,y:0};if(t.forEach((function(e){e.avoidElements.forEach((function(t){var n=r(t);if(function(e,t){return e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2}(a[e.pointName],n)){var i=t.isIncrease?n[t.direction+"2"]:n[t.direction+"1"],l=t.isIncrease?1:-1;o[t.direction]=i-a[e.pointName][t.direction]+8*l}}))})),0===o.x&&0===o.y){var l=r({selector:"body"});a.p1.x<l.x1?o.x=l.x1-a.p1.x+8:a.p2.x>l.x2&&(o.x=l.x2-a.p2.x-8),a.p1.y<l.y1?o.y=l.y1-a.p1.y+8:a.p3.y>l.y2&&(o.y=l.y2-a.p3.y-8)}return o}t.getMoveDataBeforeShowEntryCard=function(e){var t=e.map,n=e.point,r=e.cardHeight,l=e.cardWidth,s=e.rules;i.height=r,i.width=l;var c,u={shouldMove:!1},d=o(n,s);if(0!==d.x||0!==d.y){var m=function(e,t){var n=e.unproject(t),i=n.lat,a=n.lng;return[a-=180*parseInt(a/180),i]}(t,function(e,t){return[e.x-t.x,e.y-t.y]}({x:(c=a("body")).width/2,y:c.height/2},d));return u.shouldMove=!0,u.center=m,u}return u}},ee9f:function(e,t,n){},f0a3:function(e,t,n){var i=n("dcef");function a(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <li class="normal-li cp"><span class="inline">'+o(r(null!=t?l(t,"year"):t,t))+'</span><span class="ad-or-bc">'+o(r(null!=t?l(t,"adbc"):t,t))+"</span></li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,r,o){var l,s=null!=t?t:e.nullContext||{},c=e.escapeExpression,u=e.lambda,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="dls-map-select-year-out">\n  <div class="down-list">\n    <div class="turn-off">\n      <span class="turf-text">'+c(a(n("dfab")).call(s,"display","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:4,column:30},end:{line:4,column:58}}}))+'</span>\n      <input type="checkbox" checked="true" name="show-map" id="show" class="chooseBtn" />\n      <label for="show" class="choose-label"></label>\n    </div>\n    <ul class="down-list-ul">\n'+(null!=(l=d(i,"each").call(s,null!=t?d(t,"useYearArr"):t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:9,column:6},end:{line:11,column:15}}}))?l:"")+'    </ul>\n    <ul class="suggest-down-list-ul"></ul>\n  </div>\n  <div class="select-year cp">\n    <div class="map-icon"></div>\n    <div class="select-title"><span>'+c(a(n("dfab")).call(s,"HistoricalTerritory","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:17,column:36},end:{line:17,column:76}}}))+'</span></div>\n    <div class="selected-year cp">\n      <span class="close-history-map">'+c(a(n("dfab")).call(s,"close","timemap",{name:"lang",hash:{},data:o,loc:{start:{line:19,column:38},end:{line:19,column:64}}}))+'</span>\n      <span class="his-map-year"><span class="his-map-year-num">'+c(u(null!=t?d(t,"currentYear"):t,t))+'</span><span class="year-end">'+c(u(null!=t?d(t,"currentAdbc"):t,t))+'</span></span>\n      <input class="user-select-year" type="text" value="1834">\n    </div>\n    <div class="list-icon cp"></div>\n\n  </div>\n\n</div>'},useData:!0})},f12e:function(e,t,n){},f1d6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("3f6b")),a=s(n("8827")),r=s(n("57ba")),o=s(n("aacd"));n("ddd0");var l=s(n("1931"));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,active:!1,handleSearchResult:function(){},handleSelectSug:function(){},emitEmptySearch:function(){},onDestroyed:function(){}},t),this._render()}return(0,r.default)(e,[{key:"_render",value:function(){var e=this;this.$container&&(this.emptyBeforeAppend&&this.$container.empty(),this.$html=$((0,o.default)({active:this.active})),this.$container.append(this.$html),this.searchBox=new l.default({$container:this.$html.find("#searchBoxComponent"),input:"input",params:{hasGeo:"true",hasTime:"true"},suggestContainer:"#timeMapSearchSuggestions",suggestionUrl:"/api/search/timemapSug",historyName:"",parseResp:function(e){return e.data.timemapSugResultNodeList||[]},emitFocusEvent:function(){0===e.searchBox.getInputEleVal().trim().length&&e._hideCloseBtn()},emitBlurEvent:function(){},emitInput:function(){0===e.searchBox.getInputEleVal().trim().length?e._hideCloseBtn():e._showCloseBtn()},onSelect:function(t){t.id?e.handleSelectSug(t):e.handleSearchResult(t.name)}}),this._bind())}},{key:"_bind",value:function(){var e=this;this.$html.on("click",".iconLogo",(function(){var e=window.location.href.split("/"),t=e[0]+"//"+e[1]+e[2];window.open(t)})),this.$html.on("click",".emptySearch",(function(){e.searchBox.setInputEleVal(""),e._hideCloseBtn(),e.emitEmptySearch()}))}},{key:"setInputValue",value:function(e){e&&e.trim()&&(this.searchBox.setInputEleVal(e),this._showCloseBtn())}},{key:"_showCloseBtn",value:function(){this.$html.find(".emptySearch").removeClass("display-none")}},{key:"_hideCloseBtn",value:function(){this.$html.find(".emptySearch").addClass("display-none")}},{key:"showComponent",value:function(){this.active=!0,this.$html.addClass("active")}},{key:"hideComponent",value:function(){this.active=!1,this.$html.removeClass("active")}},{key:"update",value:function(e){(0,i.default)(this,e),this._render()}},{key:"destroy",value:function(){this.$container&&(this.$container.empty(),this.onDestroyed())}}]),e}();t.default=c,e.exports=t.default},f1f1:function(e,t,n){"use strict";var i=o(n("e1de")),a=o(n("3f6b")),r=n("49dc");function o(e){return e&&e.__esModule?e:{default:e}}var l=o(n("9fdf")).default.getLang({api:!0});e.exports={saveTimeMapSubject:function(e){var t=(0,a.default)({cover:"",desc:"",language:l,name:"",nodes:[],timemapId:"",type:"SPECIAL"},e);return(0,r.postJson)("/api/item/timemap/special/save",t)},deleteTimeMapSubject:function(e){var t=e.id,n=e.language,i=void 0===n?l:n;return(0,r.getJson)("/api/item/timemap/special/delete/"+i+"/"+t)},getTimeMapSubjectById:function(e){var t=e.id,n=e.language,i=void 0===n?l:n;return(0,r.getJson)("/api/item/timemap/special/"+i+"/"+t)},getSubjectClassify:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l;return(0,r.getJson)("/api/item/timemap/special/homepage/detail/"+e)},getSubjectListByClassName:function(e){var t=e.field,n=e.id,i=e.language,a=void 0===i?l:i,o=e.page,s=void 0===o?1:o,c=e.size,u={field:t,id:n,language:a,page:s,size:void 0===c?3:c};return(0,r.postJson)("/api/item/timemap/special/homepage/field",u,{once:!1})},searchTimeLine:function(e){var t=e.h,n=void 0===t?"1":t;return(0,r.getJson)("https://map.allhistory.com/dlsgis/api/timeline?h="+n)},getTimeMapResultByKeyword:function(e){var t=e.keyword,n=e.language,i=void 0===n?l:n,a=e.page,o=void 0===a?"1":a,s=e.size,c=void 0===s?"30":s,u=e.queryType,d={keyword:t,language:i,page:o,size:c,queryType:void 0===u?"3":u};return(0,r.postJson)("/api/search/timemapSearch",d,{once:!1})},getTimeMapNodeRecommend:function(e){var t=e.start,n=e.end,i=e.x1,a=e.y1,o=e.x2,s=e.y2,c=e.type,u=void 0===c?0:c,d=e.language,m={start:t,end:n,x1:i,y1:a,x2:o,y2:s,type:u,language:void 0===d?l:d};return(0,r.postJson)("/api/timemapNode/getTimemapNodeRecom",m,{once:!1})},getMapScriptDetail:function(e){var t=e.id;return(0,r.getJson)("/api/mapscript/v1/draft/script/detail/"+t)},getMapScriptEventDetail:function(e){var t=e.id;return(0,r.getJson)("/api/mapscript/v1/draft/event/detail/"+t)},saveScriptEvent:function(e){return(0,r.postJson)("/api/mapscript/v1/draft/save/event",e)},saveScriptPlays:function(e){return(0,r.postJson)("/api/mapscript/v1/draft/save/script/structure",e)},getEncryptedUrl:function(e){var t={tileUrls:e,language:void 0};return new i.default((function(e){(0,r.postJson)("https://map.allhistory.com/api/map/gateway/encrypt",t).then((function(t){e(t)}))}))}}},f6b6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("e1de")),a=h(n("3f6b")),r=h(n("8827")),o=h(n("57ba")),l=n("ffc6"),s=h(n("8445")),c=h(n("dc97")),u=h(n("591a")),d=h(n("a360")),m=h(n("e842"));function h(e){return e&&e.__esModule?e:{default:e}}(0,s.default)();var f=[{path:"",page:c.default},{path:"/",page:c.default},{path:"/result/:kw",page:u.default},{path:"/detail/:id",page:d.default},{path:"/detail/:id/:nodeid",page:m.default}],p=function(){function e(t){(0,r.default)(this,e),(0,a.default)(this,{map:!1,comps:!1},t),this.setConfig(),new l.Router(f,this.config)}return(0,o.default)(e,[{key:"setConfig",value:function(){var e=this;this.config={key:"map-router",basePath:"/map",onLoad:function(t){var n=i.default.resolve();e.currentPage&&(n=(n=n.then((function(t){e.currentPage._onPageExit()}))).then((function(){e.currentPage.destroy()}))),n=n.then((function(n){e.currentPage=new t.route.page({map:e.map,comps:e.comps}),e.currentPage.onPageMount()}))}}}}]),e}();t.default=p,e.exports=t.default},fac8:function(e,t,n){e.exports=n.p+"view/Map/img/default-list.a8c3.png"},facf:function(e,t,n){var i=n("dcef");e.exports=(i.default||i).template({1:function(e,t,n,i,a){return"active"},3:function(e,t,n,i,a){var r=e.lambda,o=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'          <li class="period-item periodItem period-item-'+o(r(a&&l(a,"index"),t))+'" data-period-id="'+o(r(null!=t?l(t,"id"):t,t))+'">\n            <div class="item-bg">\n              <div class="title">'+o(r(null!=t?l(t,"name"):t,t))+'</div>\n              <div class="sub-title">'+o(r(null!=t?l(t,"descTime"):t,t))+'</div>\n              <div class="desc">'+o(r(null!=t?l(t,"desc"):t,t))+'</div>\n              <div class="sub-item">\n                <div class="title">'+o(r(null!=t?l(t,"name"):t,t))+'</div>\n                <div class="sub-title">'+o(r(null!=t?l(t,"descTime"):t,t))+'</div>\n                <div class="desc">'+o(r(null!=t?l(t,"desc"):t,t))+"</div>\n              </div>\n            </div>\n          </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,a,r){var o,l,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="periods-component '+(null!=(o=c(i,"if").call(s,null!=t?c(t,"active"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:30},end:{line:1,column:57}}}))?o:"")+'">\n  <div class="periods-bg">\n    <div class="periods-block">\n      <div class="icon icon-close closeBtn '+(null!=(o=c(i,"if").call(s,null!=t?c(t,"showCloseBtn"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:4,column:43},end:{line:4,column:76}}}))?o:"")+'"></div>\n      <div class="title">'+e.escapeExpression((l=n("dfab"),l&&(l.__esModule?l.default:l)).call(s,"whatEraDoYouWantToGoTo","timemap",{name:"lang",hash:{},data:r,loc:{start:{line:5,column:25},end:{line:5,column:68}}}))+'</div>\n      <ul class="periods-wrap">\n'+(null!=(o=c(i,"each").call(s,null!=t?c(t,"periods"):t,{name:"each",hash:{},fn:e.program(3,r,0),inverse:e.noop,data:r,loc:{start:{line:7,column:8},end:{line:20,column:17}}}))?o:"")+"      </ul>\n    </div>\n  </div>\n</div>"},useData:!0})},fc67:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("3f6b")),a=u(n("8827")),r=u(n("57ba")),o=u(n("afb7")),l=u(n("34a7")),s=u(n("16bf")),c=n("a7c7");function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{$container:"",emptyBeforeAppend:!1,active:!0,data:{},type:"",onClick:function(){},emitMultiMarker:function(){},map:{}},t),this.maxRadius=0,this.intervalId=0,this.recommendMarkers=[],this._render()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)({itemName:this.data.itemName,id:this.data.id,type:this.type,markerLen:this.data.allChild.length})),this._bind()}},{key:"reSet",value:function(){this.intervalId&&(clearInterval(this.intervalId),c.MAB_STATE.update("multiMarkerIsOpening",!1)),c.MAB_STATE.update("multiMarkerBgOpened",!1),this.$bgHtml&&this.$bgHtml.remove(),this.$html&&this.$html.removeClass("open"),this.recommendMarkers&&this.recommendMarkers.forEach((function(e){e.remove()})),this.recommendMarkers=[]}},{key:"_bind",value:function(){var e=this;this.$html.find(".multiMarkerIcon").on("mousedown",(function(t){var n=$(t.currentTarget).parents(".mapMarker");n.removeClass("active"),e.removeMultiMarkerChildren(),e.onClick(),n.addClass("open"),setTimeout((function(){var t=n.data("mid"),i=n.data("type");e.emitMultiMarker(t,i),e.map.on("movestart.multiMarker",(function(){c.MAB_STATE.get("isMovingMapForEntryCard")||(e.removeMultiMarkerChildren(),e.map.off("movestart.multiMarker"))}))}),300)}))}},{key:"removeMultiMarkerChildren",value:function(){$(".mapBoxGlMap").find(".mapMarker.open").length>0&&(c.MAB_STATE.update("multiMarkerBgOpened",!1),$(".mapBoxGlMap").find(".mapMarker.open").find(".multi-marker-background").remove(),$(".mapBoxGlMap").find(".mapMarker.open").find(".multiMarkerChild").remove(),$(".mapBoxGlMap").find(".mapMarker.open").removeClass("open"))}},{key:"generatePointsSpiral",value:function(e){this._spiralLengthStart=11,this._spiralFootSeparation=28,this._spiralLengthFactor=5;var t=1*this._spiralLengthStart*2,n=1*this._spiralFootSeparation*2,i=1*this._spiralLengthFactor*Math.PI*2*2,a=0,r=[],o=void 0;for(r.length=parseInt(e),o=0;o<e;o++)o<parseInt(e)&&(r[o]=[t*Math.cos(a),t*Math.sin(a)]),t+=i/(a+=n/t+2e-7*o),this.maxRadius=t;return r}},{key:"drawBackground",value:function(e,t){var n=this;c.MAB_STATE.update("multiMarkerBgOpened",!0),this.$bgHtml=$((0,l.default)()),this.$html.find(".multiMarker").append(this.$bgHtml),setTimeout((function(){n.$bgHtml.find(".multi-marker-background-in").css({width:2*n.maxRadius+10+"px",height:2*n.maxRadius+10+"px"})}),100)}},{key:"drawSingleMarker",value:function(e){var t=this,n=[];e.forEach((function(e){var t=(0,s.default)({iconClassName:e.iconClassName,itemName:e.itemName,id:e.id});n.push(t)})),this.$html.find(".multiMarker").append(n.join(""));var i=50;e.forEach((function(e){setTimeout((function(){t.$html.find(".multiMarker .multiMarkerChild[data-mid="+e.id+"]").css({top:e.markerOffset[1]-10+"px",left:e.markerOffset[0]+"px"}).removeClass("display-none"),setTimeout((function(){t.$html.find(".multiMarker .multiMarkerChild[data-mid="+e.id+"]").css({top:e.markerOffset[1]+"px",opacity:1})}),i+200),i+=50}),i)}))}},{key:"drawSingleMarker1",value:function(e){var t=this,n=0;c.MAB_STATE.update("multiMarkerIsOpening",!0),this.intervalId=setInterval((function(){if(n<e.length){var i=e[n];n++;var a=$((0,s.default)({iconClassName:i.iconClassName,itemName:i.itemName,id:i.id}));t.$html.find(".multiMarker").append(a),a.attr("data-mid",i.id).css({top:i.markerOffset[1]-10+"px",left:i.markerOffset[0]+"px"}),setTimeout((function(){a.css({top:i.markerOffset[1]+"px",opacity:1})}),200),t.recommendMarkers.push(a)}else c.MAB_STATE.update("multiMarkerIsOpening",!1),clearInterval(t.intervalId)}),50)}},{key:"getElement",value:function(){return this.$html[0]}},{key:"update",value:function(){}}]),e}();t.default=d,e.exports=t.default},fd4f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("3f6b")),a=l(n("8827")),r=l(n("57ba")),o=l(n("2627"));function l(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),(0,i.default)(this,{timebar:{},startOffset:0,endOffset:0,start:0,end:1},t),this.ruler=this.timebar.ruler,this._render(),this._createSelectArea(),this.updateTime(),this._bind()}return(0,r.default)(e,[{key:"_render",value:function(){this.$html=$((0,o.default)()),this.timebar.$html.append(this.$html),this.$leftInput=this.$html.find(".left-selector input"),this.$rightInput=this.$html.find(".right-selector input"),this.$leftADBC=this.$html.find(".left-selector .adbc"),this.$rightADBC=this.$html.find(".right-selector .adbc"),this.$leftBtn=this.$html.find(" .prev"),this.$rightBtn=this.$html.find(" .next")}},{key:"_createSelectArea",value:function(){this.$selectArea=$('<div class="time-border-selector-area"></div>'),this.$selectArea.css({width:this.startOffset+this.endOffset}),this.ruler.$html.append(this.$selectArea)}},{key:"updateTime",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.ruler.getAreaTime(),a=i.start,r=i.end;e&&(a=e),t&&(r=t),0==(a=Math.round(a))&&(a=1),0==(r=Math.round(r))&&(r=1),this.$leftInput.val(n?a:Math.abs(a)),this.$leftInput.attr("data-value",a),a<0?this.$leftADBC.text("BC"):this.$leftADBC.text(" "),this.$rightInput.val(n?r:Math.abs(r)),this.$rightInput.attr("data-value",r),r<0?this.$rightADBC.text("BC"):this.$rightADBC.text(" "),a<=this.timebar.minYear?this.$leftBtn.addClass("hidden-ele"):this.$leftBtn.removeClass("hidden-ele"),r>=this.timebar.maxYear?this.$rightBtn.addClass("hidden-ele"):this.$rightBtn.removeClass("hidden-ele"),this.start=a,this.end=r}},{key:"_onFocus",value:function(e){var t=this;setTimeout((function(){t.$html.find("input").each((function(){this.value=this.getAttribute("data-value")}))}),0)}},{key:"_onInputBlur",value:function(e){var t=this.getValues(),n=t.start,i=t.end,a=this.getRealValues(),r=a.start,o=a.end-r;n>=i&&("start"==e.target.dataset.name?i=0==(i=n==i?n+1:n+o)?i+1:i:"end"==e.target.dataset.name&&(n=0==(n=n==i?i-1:i-o)?n-1:n)),n<this.timebar.ruler.minYear&&(n=this.timebar.ruler.minYear),n>this.timebar.ruler.maxYear-1&&(n=this.timebar.ruler.maxYear-1),i<this.timebar.ruler.minYear+1&&(i=this.timebar.ruler.minYear+1),i>this.timebar.ruler.maxYear&&(i=this.timebar.ruler.maxYear),this.updateTime(n,i),this.ruler.setTimeByOffset(n,i,.3,(function(){}))}},{key:"_onKeyDown",value:function(e){13==e.keyCode&&e.target.blur()}},{key:"setByDataValue",value:function(){var e=this.getRealValues(),t=e.start,n=e.end;this.updateTime(t,n)}},{key:"getValues",value:function(){var e=this.$leftInput.val(),t=this.$rightInput.val();return{start:parseInt(e),end:parseInt(t)}}},{key:"getRealValues",value:function(){var e=this.$leftInput.attr("data-value"),t=this.$rightInput.attr("data-value");return{start:parseInt(e),end:parseInt(t)}}},{key:"go",value:function(e){var t=this.getRealValues(),n=t.start+e,i=t.end+e;0==n&&(e<0?n=-1:e>0&&(n=1)),0==i&&(e<0?i=-1:e>0&&(i=1)),this.updateTime(n,i),this.ruler.setTimeByOffset(n,i,.3,(function(){}))}},{key:"_bind",value:function(){var e=this;this.ruler.addEvent("change",(function(t,n){n.resize?e.ruler.setTimeByOffset(e.start,e.end,0,(function(){})):e.updateTime()})),this.$leftInput.on("focus",this._onFocus.bind(this)),this.$rightInput.on("focus",this._onFocus.bind(this)),this.$leftInput.blur(this._onInputBlur.bind(this)),this.$rightInput.blur(this._onInputBlur.bind(this)),this.$leftInput.on("keydown",this._onKeyDown.bind(this)),this.$rightInput.on("keydown",this._onKeyDown.bind(this)),this.$leftBtn.click((function(t){return e.go(-1)})),this.$rightBtn.click((function(t){return e.go(1)}))}},{key:"hide",value:function(){this.$html.hide(),this.$selectArea.hide()}},{key:"show",value:function(){this.$html.fadeIn(),this.$selectArea.fadeIn()}}]),e}();t.default=s,e.exports=t.default},ffc6:function(e,t,n){"use strict";var i=n("638f"),a=n("7a49");t.Router=i,t.Nav=a}});